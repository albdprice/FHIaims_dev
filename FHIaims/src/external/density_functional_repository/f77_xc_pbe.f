c:XC_PBEsubrstart

c    Generated: Fri Mar 12 10:09:03 GMT 2004

      subroutine uks_xc_pbe
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     J.P. Perdew, K. Burke, and M. Ernzerhof
c     Generalized gradient approximation made simple
c     Phys. Rev. Lett. 77 (1996) 3865-3868
c
c
c     CITATION:
c
c     Functionals were obtained from the Density Functional Repository 
c     as developed and distributed by the Quantum Chemistry Group, 
c     CCLRC Daresbury Laboratory, Daresbury, Cheshire, WA4 4AD 
c     United Kingdom. Contact Huub van Dam (h.j.j.vandam@dl.ac.uk) or 
c     Paul Sherwood for further information.
c
c     COPYRIGHT:
c
c     Users may incorporate the source code into software packages and
c     redistribute the source code provided the source code is not
c     changed in anyway and is properly cited in any documentation or
c     publication related to its use.
c
c     ACKNOWLEDGEMENT:
c
c     The source code was generated using Maple 8 through a modified
c     version of the dfauto script published in:
c
c        R. Strange, F.R. Manby, P.J. Knowles
c        Automatic code generation in density functional theory
c        Comp. Phys. Comm. 136 (2001) 310-318.
c
      implicit real*8 (a-h,o-z)
      integer ideriv,npt
      real*8 rhoa1(npt),rhob1(npt)
      real*8 sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      real*8 zk(npt),vrhoa(npt),vrhob(npt)
      real*8 vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      real*8 v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      real*8 v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      real*8 v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      real*8 v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      real*8 v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      real*8 v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t31 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t20
     &+0.3844746237447211D1*t17+0.1644733775567609D1*t23
     &+0.2405871291288192D0*t25))
      t32 = (1.D0+0.1274696188700087D0*t17)*t31
      t35 = 1/t2/t4
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t43 = 0.2162211495206379D0/t39*sigmabb*t35
      t45 = t39**2
      t47 = sigmabb**2
      t49 = t4**2
      t60 = dlog(1.D0+0.2162211495206379D0*sigmabb*t35*(1.D0+t43)/
     &(1.D0+t43+0.4675158550002605D-1/t45*t47/t5/t49))
      zk(i) = -0.9305257363491D0*t2*rhob*(0.1804D1-0.804D0/(1.D0
     &+0.449276922095889D-2*sigmabb/t5/t4))+rhob*(-0.310907D-1*t32
     &+0.1554534543482745D-1*t60)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t31 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t20
     &+0.3844746237447211D1*t17+0.1644733775567609D1*t23
     &+0.2405871291288192D0*t25))
      t32 = (1.D0+0.1274696188700087D0*t17)*t31
      t35 = 1/t2/t4
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t43 = 0.2162211495206379D0/t39*sigmaaa*t35
      t45 = t39**2
      t47 = sigmaaa**2
      t49 = t4**2
      t60 = dlog(1.D0+0.2162211495206379D0*sigmaaa*t35*(1.D0+t43)/
     &(1.D0+t43+0.4675158550002605D-1/t45*t47/t5/t49))
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.1804D1-0.804D0/(1.D0
     &+0.449276922095889D-2*sigmaaa/t5/t4))+rhoa*(-0.310907D-1*t32
     &+0.1554534543482745D-1*t60)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t18 = rhob**(1.D0/3.D0)
      t20 = rhob**2
      t21 = t18**2
      t32 = 1/rho
      t33 = t32**(1.D0/3.D0)
      t36 = t32**(1.D0/6.D0)
      t39 = dsqrt(t32)
      t41 = t33**2
      t47 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t36
     &+0.2225569421150687D1*t33+0.8004286349993634D0*t39
     &+0.1897004325747559D0*t41))
      t49 = 0.621814D-1*(1.D0+0.1325688999052018D0*t33)*t47
      t60 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t36
     &+0.2247591863577616D1*t33+0.4300972471276643D0*t39
     &+0.1911512595127338D0*t41))
      t63 = rhoa-1.D0*rhob
      t64 = t63*t32
      t65 = 1.D0+t64
      t66 = t65**(1.D0/3.D0)
      t69 = 1.D0-1.D0*t64
      t70 = t69**(1.D0/3.D0)
      t72 = t66*t65+t70*t69-2.D0
      t73 = t63**2
      t74 = t73**2
      t75 = rho**2
      t76 = t75**2
      t78 = t74/t76
      t83 = 0.37995525D-1*(1.D0+0.6901399211255825D-1*t33)*t60*t72*
     &(1.D0-1.D0*t78)
      t94 = dlog(1.D0+0.3216395899738507D2/(0.1112037486309468D2*t36
     &+0.3844746237447211D1*t33+0.1644733775567609D1*t39
     &+0.2405871291288192D0*t41))
      t100 = 0.1923661050931536D1*(-0.310907D-1*(1.D0
     &+0.1274696188700087D0*t33)*t94+t49)*t72*t78
      t101 = t66**2
      t103 = t70**2
      t105 = 0.5D0*t101+0.5D0*t103
      t106 = t105**2
      t107 = t106*t105
      t108 = 1/t106
      t110 = rho**(1.D0/3.D0)
      t112 = 1/t110/t75
      t117 = dexp(-0.3216396844291482D2*(-t49+t83+t100)/t107)
      t118 = t117-1.D0
      t123 = 0.1362107888567592D0/t118*sigma*t108*t112
      t126 = t118**2
      t128 = sigma**2
      t130 = t106**2
      t132 = t110**2
      t144 = dlog(1.D0+0.1362107888567592D0*sigma*t108*t112*(1.D0+t123
     &)/(1.D0+t123+0.1855337900098064D-1/t126*t128/t130/t132/t76))
      zk(i) = -0.9305257363491D0*t4*rhoa*(0.1804D1-0.804D0/(1.D0
     &+0.449276922095889D-2*sigmaaa/t7/t6))-0.9305257363491D0*t18*rhob
     &*(0.1804D1-0.804D0/(1.D0+0.449276922095889D-2*sigmabb/t21/t20))
     &+rho*(-t49+t83+t100+0.310906908696549D-1*t107*t144)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmabb/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     &+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.310907D-1*t32
      t35 = 1/t2/t4
      t36 = sigmabb*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigmabb
      t43 = 0.2162211495206379D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigmabb**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t52 = t48*t51
      t54 = 1.D0+t43+0.4675158550002605D-1*t52
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.2162211495206379D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.1554534543482745D-1*t60
      zk(i) = -0.9305257363491D0*t3*t13+rhob*(-t33+t61)
      vrhoa(i) = 0.D0
      t66 = t10**2
      t67 = 1/t66
      t73 = 1/t2/t4/rhob
      t79 = 1/t5/t49/rhob
      t81 = t40*t55
      t84 = t54**2
      t86 = t44/t84
      t97 = 1/t59
      t101 = 1/t4
      t102 = 1/t25*t101
      t103 = t102*t31
      t105 = t27**2
      t108 = t20**2
      t109 = t108**2
      t124 = t19/t105*(-0.1853395810515781D1/t109/t20*t101
     &-0.128158207914907D1*t102-0.8223668877838045D0/t23*t101
     &-0.1603914194192128D0/t17*t101)/t30
      t128 = -0.8497977086918237D-1*t103-0.6432793688582964D2*t124
      t133 = t46*sigmabb
      vrhob(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2*t35
     &*t67*sigmabb-t33+t61+0.1554534543482745D-1*rhob*(
     &-0.5045160155481551D0*sigmabb*t73*t56-0.1090870328333941D0*t47
     &*t79*t81-0.2162211495206379D0*t36*t86*(-0.5045160155481551D0*t41
     &*t73-0.2181740656667882D0*t48*t79))*t97+rhob*
     &(0.1321039893133927D-2*t103+0.1D1*t124+0.1554534543482745D-1*(
     &-0.4675158550002605D-1*t52*t128*t38*t55-0.2162211495206379D0*t36
     &*t86*(-0.2162211495206379D0*t133*t35*t128*t38
     &-0.935031710000521D-1/t45/t39*t47*t51*t128*t38))*t97)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      vsigmabb(i) = -0.3361232459613792D-2/t3*t67
     &+0.1554534543482745D-1*rhob*(0.2162211495206379D0*t35*t44*t55
     &+0.4675158550002605D-1*sigmabb*t51*t81-0.2162211495206379D0*t36
     &*t86*(0.2162211495206379D0*t40*t35+0.935031710000521D-1*t133*t51
     &))*t97
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmaaa/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     &+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.310907D-1*t32
      t35 = 1/t2/t4
      t36 = sigmaaa*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigmaaa
      t43 = 0.2162211495206379D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigmaaa**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t52 = t48*t51
      t54 = 1.D0+t43+0.4675158550002605D-1*t52
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.2162211495206379D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.1554534543482745D-1*t60
      zk(i) = -0.9305257363491D0*t3*t13+rhoa*(-t33+t61)
      t66 = t10**2
      t67 = 1/t66
      t73 = 1/t2/t4/rhoa
      t79 = 1/t5/t49/rhoa
      t81 = t40*t55
      t84 = t54**2
      t86 = t44/t84
      t97 = 1/t59
      t101 = 1/t4
      t102 = 1/t25*t101
      t103 = t102*t31
      t105 = t27**2
      t108 = t20**2
      t109 = t108**2
      t124 = t19/t105*(-0.1853395810515781D1/t109/t20*t101
     &-0.128158207914907D1*t102-0.8223668877838045D0/t23*t101
     &-0.1603914194192128D0/t17*t101)/t30
      t128 = -0.8497977086918237D-1*t103-0.6432793688582964D2*t124
      t133 = t46*sigmaaa
      vrhoa(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2*t35
     &*t67*sigmaaa-t33+t61+0.1554534543482745D-1*rhoa*(
     &-0.5045160155481551D0*sigmaaa*t73*t56-0.1090870328333941D0*t47
     &*t79*t81-0.2162211495206379D0*t36*t86*(-0.5045160155481551D0*t41
     &*t73-0.2181740656667882D0*t48*t79))*t97+rhoa*
     &(0.1321039893133927D-2*t103+0.1D1*t124+0.1554534543482745D-1*(
     &-0.4675158550002605D-1*t52*t128*t38*t55-0.2162211495206379D0*t36
     &*t86*(-0.2162211495206379D0*t133*t35*t128*t38
     &-0.935031710000521D-1/t45/t39*t47*t51*t128*t38))*t97)
      vrhob(i) = 0.D0
      vsigmaaa(i) = -0.3361232459613792D-2/t3*t67
     &+0.1554534543482745D-1*rhoa*(0.2162211495206379D0*t35*t44*t55
     &+0.4675158550002605D-1*sigmaaa*t51*t81-0.2162211495206379D0*t36
     &*t86*(0.2162211495206379D0*t40*t35+0.935031710000521D-1*t133*t51
     &))*t97
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t12 = 1.D0+0.449276922095889D-2*sigmaaa/t7/t6
      t15 = 0.1804D1-0.804D0/t12
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t20 = rhob**2
      t21 = t18**2
      t26 = 1.D0+0.449276922095889D-2*sigmabb/t21/t20
      t29 = 0.1804D1-0.804D0/t26
      t32 = 1/rho
      t33 = t32**(1.D0/3.D0)
      t35 = 1.D0+0.1325688999052018D0*t33
      t36 = t32**(1.D0/6.D0)
      t39 = dsqrt(t32)
      t41 = t33**2
      t43 = 0.598255043577108D1*t36+0.2225569421150687D1*t33
     &+0.8004286349993634D0*t39+0.1897004325747559D0*t41
      t46 = 1.D0+0.1608197949869254D2/t43
      t47 = dlog(t46)
      t49 = 0.621814D-1*t35*t47
      t51 = 1.D0+0.6901399211255825D-1*t33
      t56 = 0.8157414703487641D1*t36+0.2247591863577616D1*t33
     &+0.4300972471276643D0*t39+0.1911512595127338D0*t41
      t59 = 1.D0+0.2960874997779344D2/t56
      t60 = dlog(t59)
      t61 = t51*t60
      t63 = rhoa-1.D0*rhob
      t64 = t63*t32
      t65 = 1.D0+t64
      t66 = t65**(1.D0/3.D0)
      t69 = 1.D0-1.D0*t64
      t70 = t69**(1.D0/3.D0)
      t72 = t66*t65+t70*t69-2.D0
      t73 = t63**2
      t74 = t73**2
      t75 = rho**2
      t76 = t75**2
      t77 = 1/t76
      t78 = t74*t77
      t80 = 1.D0-1.D0*t78
      t83 = 0.37995525D-1*t61*t72*t80
      t85 = 1.D0+0.1274696188700087D0*t33
      t90 = 0.1112037486309468D2*t36+0.3844746237447211D1*t33
     &+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t93 = 1.D0+0.3216395899738507D2/t90
      t94 = dlog(t93)
      t97 = -0.310907D-1*t85*t94+t49
      t98 = t97*t72
      t100 = 0.1923661050931536D1*t98*t78
      t101 = t66**2
      t103 = t70**2
      t105 = 0.5D0*t101+0.5D0*t103
      t106 = t105**2
      t107 = t106*t105
      t108 = 1/t106
      t109 = sigma*t108
      t110 = rho**(1.D0/3.D0)
      t112 = 1/t110/t75
      t113 = -t49+t83+t100
      t114 = 1/t107
      t117 = dexp(-0.3216396844291482D2*t113*t114)
      t118 = t117-1.D0
      t119 = 1/t118
      t120 = t119*sigma
      t121 = t108*t112
      t123 = 0.1362107888567592D0*t120*t121
      t124 = 1.D0+t123
      t126 = t118**2
      t127 = 1/t126
      t128 = sigma**2
      t129 = t127*t128
      t130 = t106**2
      t131 = 1/t130
      t132 = t110**2
      t134 = 1/t132/t76
      t135 = t131*t134
      t138 = 1.D0+t123+0.1855337900098064D-1*t129*t135
      t139 = 1/t138
      t143 = 1.D0+0.1362107888567592D0*t109*t112*t124*t139
      t144 = dlog(t143)
      t146 = 0.310906908696549D-1*t107*t144
      zk(i) = -0.9305257363491D0*t5*t15-0.9305257363491D0*t19*t29+rho*
     &(-t49+t83+t100+t146)
      t153 = t12**2
      t154 = 1/t153
      t162 = 0.1333333333333333D1*t66*t32-0.1333333333333333D1*t70*t32
      t165 = 0.37995525D-1*t61*t162*t80
      t166 = t73*t63
      t169 = t61*t72*t166*t77
      t170 = 0.1519821D0*t169
      t173 = 0.1923661050931536D1*t97*t162*t78
      t175 = t98*t166*t77
      t176 = 0.7694644203726145D1*t175
      t177 = t106*t144
      t178 = 1/t66
      t181 = 1/t70
      t184 = 0.3333333333333333D0*t178*t32-0.3333333333333333D0*t181*t32
      t188 = sigma*t114*t112
      t189 = t124*t139
      t193 = t127*sigma
      t194 = t193*t108
      t198 = t113*t131
      t201 = -0.3216396844291482D2*(t165-t170+t173+t176)*t114
     &+0.9649190532874446D2*t198*t184
      t205 = 0.1362107888567592D0*t194*t112*t201*t117
      t206 = t114*t112
      t209 = 0.2724215777135184D0*t120*t206*t184
      t215 = t109*t112
      t216 = t138**2
      t218 = t124/t216
      t222 = 1/t126/t118*t128*t131
      t229 = 1/t130/t105*t134
      t239 = 1/t143
      t245 = 1/t75
      t246 = 1/t41*t245
      t247 = t246*t47
      t248 = 0.2747773264188438D-2*t247
      t249 = t43**2
      t252 = t36**2
      t253 = t252**2
      t256 = 1/t253/t36*t245
      t260 = 1/t39*t245
      t263 = 1/t33*t245
      t268 = t35/t249*(-0.99709173929518D0*t256-0.7418564737168958D0
     &*t246-0.4002143174996817D0*t260-0.1264669550498372D0*t263)/t46
      t269 = 0.1D1*t268
      t273 = 0.87407428755417D-3*t246*t60*t72*t80
      t274 = t56**2
      t287 = 0.1125D1*t51/t274*(-0.135956911724794D1*t256
     &-0.7491972878592054D0*t246-0.2150486235638321D0*t260
     &-0.1274341730084892D0*t263)/t59*t72*t80
      t294 = -0.1333333333333333D1*t66*t63*t245+0.1333333333333333D1
     &*t70*t63*t245
      t297 = 0.37995525D-1*t61*t294*t80
      t299 = t76*rho
      t300 = 1/t299
      t303 = 0.1519821D0*t61*t72*t74*t300
      t306 = t90**2
      t323 = 0.1923661050931536D1*(0.1321039893133927D-2*t246*t94
     &+0.1D1*t85/t306*(-0.1853395810515781D1*t256-0.128158207914907D1
     &*t246-0.8223668877838045D0*t260-0.1603914194192128D0*t263)/t93
     &-0.2747773264188438D-2*t247-0.1D1*t268)*t72*t78
      t326 = 0.1923661050931536D1*t97*t294*t78
      t329 = 0.7694644203726145D1*t98*t74*t300
      t336 = -0.3333333333333333D0*t178*t63*t245+0.3333333333333333D0
     &*t181*t63*t245
      t344 = 1/t110/t75/rho
      t354 = -0.3216396844291482D2*(t248+t269-t273-t287+t297+t303+t323
     &+t326-t329)*t114+0.9649190532874446D2*t198*t336
      t358 = 0.1362107888567592D0*t194*t112*t354*t117
      t361 = 0.2724215777135184D0*t120*t206*t336
      t364 = 0.3178251739991049D0*t120*t108*t344
      t390 = t248+t269-t273-t287+t297+t303+t323+t326-t329
     &+0.9327207260896469D-1*t177*t336+0.310906908696549D-1*t107*(
     &-0.2724215777135184D0*t188*t189*t336-0.3178251739991049D0*t109
     &*t344*t124*t139+0.1362107888567592D0*t109*t112*(-t358-t361-t364)
     &*t139-0.1362107888567592D0*t215*t218*(-t358-t361-t364
     &-0.3710675800196129D-1*t222*t134*t354*t117-0.7421351600392257D-1
     &*t129*t229*t336-0.8658243533790967D-1*t129*t131/t132/t299))*t239
      t391 = rho*t390
      vrhoa(i) = -0.12407009817988D1*t4*t15+0.8963286558970112D-2/t4
     &/t6*t154*sigmaaa+rho*(t165-t170+t173+t176+0.9327207260896469D-1
     &*t177*t184+0.310906908696549D-1*t107*(-0.2724215777135184D0*t188
     &*t189*t184+0.1362107888567592D0*t109*t112*(-t205-t209)*t139
     &-0.1362107888567592D0*t215*t218*(-t205-t209
     &-0.3710675800196129D-1*t222*t134*t201*t117-0.7421351600392257D-1
     &*t129*t229*t184))*t239)-t49+t83+t100+t146+t391
      t396 = t26**2
      t397 = 1/t396
      t401 = -t162
      t404 = 0.37995525D-1*t61*t401*t80
      t405 = 0.1519821D0*t169
      t408 = 0.1923661050931536D1*t97*t401*t78
      t409 = 0.7694644203726145D1*t175
      t410 = -t184
      t421 = -0.3216396844291482D2*(t404+t405+t408-t409)*t114
     &+0.9649190532874446D2*t198*t410
      t425 = 0.1362107888567592D0*t194*t112*t421*t117
      t428 = 0.2724215777135184D0*t120*t206*t410
      vrhob(i) = -0.12407009817988D1*t18*t29+0.8963286558970112D-2/t18
     &/t20*t397*sigmabb+rho*(t404+t405+t408-t409+0.9327207260896469D-1
     &*t177*t410+0.310906908696549D-1*t107*(-0.2724215777135184D0*t188
     &*t189*t410+0.1362107888567592D0*t109*t112*(-t425-t428)*t139
     &-0.1362107888567592D0*t215*t218*(-t425-t428
     &-0.3710675800196129D-1*t222*t134*t421*t117-0.7421351600392257D-1
     &*t129*t229*t410))*t239)-t49+t83+t100+t146+t391
      t473 = rho*t107*(0.1362107888567592D0*t121*t189
     &+0.1855337900098064D-1*sigma*t131*t134*t119*t139
     &-0.1362107888567592D0*t215*t218*(0.1362107888567592D0*t119*t108
     &*t112+0.3710675800196129D-1*t193*t135))*t239
      t474 = 0.310906908696549D-1*t473
      vsigmaaa(i) = -0.3361232459613792D-2/t5*t154+t474
      vsigmaab(i) = 0.6218138173930979D-1*t473
      vsigmabb(i) = -0.3361232459613792D-2/t19*t397+t474
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmabb/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      t16 = 1/rhob
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     &+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.310907D-1*t32
      t35 = 1/t2/t4
      t36 = sigmabb*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigmabb
      t43 = 0.2162211495206379D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigmabb**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t52 = t48*t51
      t54 = 1.D0+t43+0.4675158550002605D-1*t52
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.2162211495206379D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.1554534543482745D-1*t60
      zk(i) = -0.9305257363491D0*t3*t13+rhob*(-t33+t61)
      vrhoa(i) = 0.D0
      t66 = t10**2
      t67 = 1/t66
      t71 = t4*rhob
      t73 = 1/t2/t71
      t74 = sigmabb*t73
      t79 = 1/t5/t49/rhob
      t80 = t47*t79
      t81 = t40*t55
      t84 = t54**2
      t85 = 1/t84
      t86 = t44*t85
      t89 = t48*t79
      t91 = -0.5045160155481551D0*t41*t73-0.2181740656667882D0*t89
      t92 = t86*t91
      t95 = -0.5045160155481551D0*t74*t56-0.1090870328333941D0*t80*t81
     &-0.2162211495206379D0*t36*t92
      t96 = rhob*t95
      t97 = 1/t59
      t100 = 1/t25
      t101 = 1/t4
      t102 = t100*t101
      t103 = t102*t31
      t105 = t27**2
      t106 = 1/t105
      t107 = t19*t106
      t108 = t20**2
      t109 = t108**2
      t110 = t109*t20
      t111 = 1/t110
      t115 = 1/t23
      t118 = 1/t17
      t121 = -0.1853395810515781D1*t111*t101-0.128158207914907D1*t102
     &-0.8223668877838045D0*t115*t101-0.1603914194192128D0*t118*t101
      t122 = 1/t30
      t124 = t107*t121*t122
      t128 = -0.8497977086918237D-1*t103-0.6432793688582964D2*t124
      t129 = t128*t38
      t130 = t129*t55
      t133 = t46*sigmabb
      t139 = 1/t45/t39
      t140 = t139*t47
      t145 = -0.2162211495206379D0*t133*t35*t128*t38
     &-0.935031710000521D-1*t140*t51*t128*t38
      t146 = t86*t145
      t149 = -0.4675158550002605D-1*t52*t130-0.2162211495206379D0*t36
     &*t146
      t150 = t149*t97
      vrhob(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2*t35
     &*t67*sigmabb-t33+t61+0.1554534543482745D-1*t96*t97+rhob*
     &(0.1321039893133927D-2*t103+0.1D1*t124+0.1554534543482745D-1*t150)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t157 = t35*t44
      t160 = sigmabb*t51
      t167 = 0.2162211495206379D0*t40*t35+0.935031710000521D-1*t133*t51
      t171 = 0.2162211495206379D0*t157*t55+0.4675158550002605D-1*t160
     &*t81-0.2162211495206379D0*t36*t86*t167
      vsigmabb(i) = -0.3361232459613792D-2/t3*t67
     &+0.1554534543482745D-1*rhob*t171*t97
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t181 = t49*t4
      t184 = 1/t66/t10
      t191 = 1/t2/t49
      t196 = 1/t5/t181
      t202 = t40*t85
      t207 = 1/t84/t54
      t208 = t44*t207
      t209 = t91**2
      t225 = t95**2
      t227 = t59**2
      t228 = 1/t227
      t234 = t89*t130
      t239 = 0.4675158550002605D-1*t52*t129*t85*t91
      t241 = 0.5045160155481551D0*t74*t146
      t244 = 0.1090870328333941D0*t80*t202*t145
      t249 = 0.4324422990412758D0*t36*t44*t207*t145*t91
      t261 = 0.2162211495206379D0*t36*t86*(0.5045160155481551D0*t133
     &*t73*t128*t38+0.4363481313335765D0*t140*t79*t128*t38)
      t265 = t149*t228
      t279 = 1/t49
      t280 = 1/t25/t16*t279
      t281 = t280*t31
      t283 = 1/t71
      t284 = t100*t283
      t285 = t284*t31
      t289 = t102*t106*t121*t122
      t294 = t121**2
      t296 = t19/t105/t27*t294*t122
      t320 = t107*(-0.1544496508763151D1/t110/t16*t279
     &+0.3706791621031562D1*t111*t283-0.854388052766047D0*t280
     &+0.2563164158298141D1*t284-0.4111834438919023D0/t23/t16*t279
     &+0.1644733775567609D1*t115*t283-0.5346380647307093D-1/t17/t16
     &*t279+0.3207828388384256D0*t118*t283)*t122
      t322 = t105**2
      t325 = t30**2
      t328 = t19/t322*t294/t325
      t332 = t128**2
      t334 = dexp(0.4000001174672527D1*t32)
      t345 = -0.5665318057945491D-1*t281+0.1699595417383647D0*t285
     &+0.546657173168712D1*t289+0.1286558737716593D3*t296
     &-0.6432793688582964D2*t320-0.2069041124382199D4*t328
      t358 = t145**2
      t363 = t35*t332
      t374 = t45**2
      t377 = t51*t332
      t395 = t149**2
      s1 = -0.4135669939329333D0/t5*t13-0.8963286558970112D-2*t73*t67
     &*sigmabb+0.2147732158441357D-3/t181*t184*t47
     &+0.310906908696549D-1*t95*t97+0.1554534543482745D-1*rhob*
     &(0.1681720051827184D1*sigmabb*t191*t56+0.8726962626671529D0*t47
     &*t196*t81+0.100903203109631D1*t74*t92+0.2181740656667882D0*t80
     &*t202*t91+0.4324422990412758D0*t36*t208*t209
     &-0.2162211495206379D0*t36*t86*(0.1681720051827184D1*t41*t191
     &+0.1236319705445133D1*t48*t196))*t97-0.1554534543482745D-1*rhob
     &*t225*t228
      s2 = s1+0.2642079786267853D-2*t103+0.2D1*t124
     &+0.310906908696549D-1*t150
      s3 = s2+rhob*(0.1554534543482745D-1*(0.2181740656667882D0*t234
     &+t239+t241+t244+t249-t261)*t97-0.1554534543482745D-1*t265*t95)
      s4 = s3+0.1554534543482745D-1*rhob*(0.2181740656667882D0*t234
     &+t241+t244+t239+t249-t261)*t97
      v2rhob2(i) = s4-0.1554534543482745D-1*t96*t265+rhob*
     &(0.8806932620892844D-3*t281-0.2642079786267853D-2*t285
     &-0.8497974591333914D-1*t289-0.2D1*t296+0.1D1*t320
     &+0.3216395899738507D2*t328+0.1554534543482745D-1*
     &(0.935031710000521D-1*t47*t51*t139*t332*t334*t55
     &-0.4675158550002605D-1*t52*t345*t38*t55-0.4675158550002605D-1
     &*t52*t332*t38*t55+0.935031710000521D-1*t52*t129*t85*t145
     &+0.4324422990412758D0*t36*t208*t358-0.2162211495206379D0*t36*t86
     &*(0.4324422990412758D0*t139*sigmabb*t363*t334
     &-0.2162211495206379D0*t133*t35*t345*t38-0.2162211495206379D0
     &*t133*t363*t38+0.2805095130001563D0/t374*t47*t377*t334
     &-0.935031710000521D-1*t140*t51*t345*t38-0.935031710000521D-1
     &*t140*t377*t38))*t97-0.1554534543482745D-1*t395*t228)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t411 = t167**2
      t425 = t171**2
      v2sigmabb2(i) = 0.3020248347808158D-4*t279*t184
     &+0.1554534543482745D-1*rhob*(0.935031710000521D-1*t51*t40*t55
     &-0.4324422990412758D0*t157*t85*t167-0.935031710000521D-1*t160
     &*t202*t167+0.4324422990412758D0*t36*t208*t411
     &-0.2021736311745604D-1*sigmabb/t49/t71*t86*t46)*t97
     &-0.1554534543482745D-1*rhob*t425*t228
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t10 = 1.D0+0.449276922095889D-2*sigmaaa/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      t16 = 1/rhoa
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1274696188700087D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.1112037486309468D2*t20+0.3844746237447211D1*t17
     &+0.1644733775567609D1*t23+0.2405871291288192D0*t25
      t30 = 1.D0+0.3216395899738507D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.310907D-1*t32
      t35 = 1/t2/t4
      t36 = sigmaaa*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigmaaa
      t43 = 0.2162211495206379D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigmaaa**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t52 = t48*t51
      t54 = 1.D0+t43+0.4675158550002605D-1*t52
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.2162211495206379D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.1554534543482745D-1*t60
      zk(i) = -0.9305257363491D0*t3*t13+rhoa*(-t33+t61)
      t66 = t10**2
      t67 = 1/t66
      t71 = t4*rhoa
      t73 = 1/t2/t71
      t74 = sigmaaa*t73
      t79 = 1/t5/t49/rhoa
      t80 = t47*t79
      t81 = t40*t55
      t84 = t54**2
      t85 = 1/t84
      t86 = t44*t85
      t89 = t48*t79
      t91 = -0.5045160155481551D0*t41*t73-0.2181740656667882D0*t89
      t92 = t86*t91
      t95 = -0.5045160155481551D0*t74*t56-0.1090870328333941D0*t80*t81
     &-0.2162211495206379D0*t36*t92
      t96 = rhoa*t95
      t97 = 1/t59
      t100 = 1/t25
      t101 = 1/t4
      t102 = t100*t101
      t103 = t102*t31
      t105 = t27**2
      t106 = 1/t105
      t107 = t19*t106
      t108 = t20**2
      t109 = t108**2
      t110 = t109*t20
      t111 = 1/t110
      t115 = 1/t23
      t118 = 1/t17
      t121 = -0.1853395810515781D1*t111*t101-0.128158207914907D1*t102
     &-0.8223668877838045D0*t115*t101-0.1603914194192128D0*t118*t101
      t122 = 1/t30
      t124 = t107*t121*t122
      t128 = -0.8497977086918237D-1*t103-0.6432793688582964D2*t124
      t129 = t128*t38
      t130 = t129*t55
      t133 = t46*sigmaaa
      t139 = 1/t45/t39
      t140 = t139*t47
      t145 = -0.2162211495206379D0*t133*t35*t128*t38
     &-0.935031710000521D-1*t140*t51*t128*t38
      t146 = t86*t145
      t149 = -0.4675158550002605D-1*t52*t130-0.2162211495206379D0*t36
     &*t146
      t150 = t149*t97
      vrhoa(i) = -0.12407009817988D1*t2*t13+0.8963286558970112D-2*t35
     &*t67*sigmaaa-t33+t61+0.1554534543482745D-1*t96*t97+rhoa*
     &(0.1321039893133927D-2*t103+0.1D1*t124+0.1554534543482745D-1*t150)
      vrhob(i) = 0.D0
      t157 = t35*t44
      t160 = sigmaaa*t51
      t167 = 0.2162211495206379D0*t40*t35+0.935031710000521D-1*t133*t51
      t171 = 0.2162211495206379D0*t157*t55+0.4675158550002605D-1*t160
     &*t81-0.2162211495206379D0*t36*t86*t167
      vsigmaaa(i) = -0.3361232459613792D-2/t3*t67
     &+0.1554534543482745D-1*rhoa*t171*t97
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t181 = t49*t4
      t184 = 1/t66/t10
      t191 = 1/t2/t49
      t196 = 1/t5/t181
      t202 = t40*t85
      t207 = 1/t84/t54
      t208 = t44*t207
      t209 = t91**2
      t225 = t95**2
      t227 = t59**2
      t228 = 1/t227
      t234 = t89*t130
      t239 = 0.4675158550002605D-1*t52*t129*t85*t91
      t241 = 0.5045160155481551D0*t74*t146
      t244 = 0.1090870328333941D0*t80*t202*t145
      t249 = 0.4324422990412758D0*t36*t44*t207*t145*t91
      t261 = 0.2162211495206379D0*t36*t86*(0.5045160155481551D0*t133
     &*t73*t128*t38+0.4363481313335765D0*t140*t79*t128*t38)
      t265 = t149*t228
      t279 = 1/t49
      t280 = 1/t25/t16*t279
      t281 = t280*t31
      t283 = 1/t71
      t284 = t100*t283
      t285 = t284*t31
      t289 = t102*t106*t121*t122
      t294 = t121**2
      t296 = t19/t105/t27*t294*t122
      t320 = t107*(-0.1544496508763151D1/t110/t16*t279
     &+0.3706791621031562D1*t111*t283-0.854388052766047D0*t280
     &+0.2563164158298141D1*t284-0.4111834438919023D0/t23/t16*t279
     &+0.1644733775567609D1*t115*t283-0.5346380647307093D-1/t17/t16
     &*t279+0.3207828388384256D0*t118*t283)*t122
      t322 = t105**2
      t325 = t30**2
      t328 = t19/t322*t294/t325
      t332 = t128**2
      t334 = dexp(0.4000001174672527D1*t32)
      t345 = -0.5665318057945491D-1*t281+0.1699595417383647D0*t285
     &+0.546657173168712D1*t289+0.1286558737716593D3*t296
     &-0.6432793688582964D2*t320-0.2069041124382199D4*t328
      t358 = t145**2
      t363 = t35*t332
      t374 = t45**2
      t377 = t51*t332
      t395 = t149**2
      s1 = -0.4135669939329333D0/t5*t13-0.8963286558970112D-2*t73*t67
     &*sigmaaa+0.2147732158441357D-3/t181*t184*t47
     &+0.310906908696549D-1*t95*t97+0.1554534543482745D-1*rhoa*
     &(0.1681720051827184D1*sigmaaa*t191*t56+0.8726962626671529D0*t47
     &*t196*t81+0.100903203109631D1*t74*t92+0.2181740656667882D0*t80
     &*t202*t91+0.4324422990412758D0*t36*t208*t209
     &-0.2162211495206379D0*t36*t86*(0.1681720051827184D1*t41*t191
     &+0.1236319705445133D1*t48*t196))*t97-0.1554534543482745D-1*rhoa
     &*t225*t228
      s2 = s1+0.2642079786267853D-2*t103+0.2D1*t124
     &+0.310906908696549D-1*t150
      s3 = s2+rhoa*(0.1554534543482745D-1*(0.2181740656667882D0*t234
     &+t239+t241+t244+t249-t261)*t97-0.1554534543482745D-1*t265*t95)
      s4 = s3+0.1554534543482745D-1*rhoa*(0.2181740656667882D0*t234
     &+t241+t244+t239+t249-t261)*t97
      v2rhoa2(i) = s4-0.1554534543482745D-1*t96*t265+rhoa*
     &(0.8806932620892844D-3*t281-0.2642079786267853D-2*t285
     &-0.8497974591333914D-1*t289-0.2D1*t296+0.1D1*t320
     &+0.3216395899738507D2*t328+0.1554534543482745D-1*
     &(0.935031710000521D-1*t47*t51*t139*t332*t334*t55
     &-0.4675158550002605D-1*t52*t345*t38*t55-0.4675158550002605D-1
     &*t52*t332*t38*t55+0.935031710000521D-1*t52*t129*t85*t145
     &+0.4324422990412758D0*t36*t208*t358-0.2162211495206379D0*t36*t86
     &*(0.4324422990412758D0*t139*sigmaaa*t363*t334
     &-0.2162211495206379D0*t133*t35*t345*t38-0.2162211495206379D0
     &*t133*t363*t38+0.2805095130001563D0/t374*t47*t377*t334
     &-0.935031710000521D-1*t140*t51*t345*t38-0.935031710000521D-1
     &*t140*t377*t38))*t97-0.1554534543482745D-1*t395*t228)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t411 = t167**2
      t425 = t171**2
      v2sigmaaa2(i) = 0.3020248347808158D-4*t279*t184
     &+0.1554534543482745D-1*rhoa*(0.935031710000521D-1*t51*t40*t55
     &-0.4324422990412758D0*t157*t85*t167-0.935031710000521D-1*t160
     &*t202*t167+0.4324422990412758D0*t36*t208*t411
     &-0.2021736311745604D-1*sigmaaa/t49/t71*t86*t46)*t97
     &-0.1554534543482745D-1*rhoa*t425*t228
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t12 = 1.D0+0.449276922095889D-2*sigmaaa/t7/t6
      t15 = 0.1804D1-0.804D0/t12
      t18 = rhob**(1.D0/3.D0)
      t19 = t18*rhob
      t20 = rhob**2
      t21 = t18**2
      t26 = 1.D0+0.449276922095889D-2*sigmabb/t21/t20
      t29 = 0.1804D1-0.804D0/t26
      t32 = 1/rho
      t33 = t32**(1.D0/3.D0)
      t35 = 1.D0+0.1325688999052018D0*t33
      t36 = t32**(1.D0/6.D0)
      t39 = dsqrt(t32)
      t41 = t33**2
      t43 = 0.598255043577108D1*t36+0.2225569421150687D1*t33
     &+0.8004286349993634D0*t39+0.1897004325747559D0*t41
      t46 = 1.D0+0.1608197949869254D2/t43
      t47 = dlog(t46)
      t49 = 0.621814D-1*t35*t47
      t51 = 1.D0+0.6901399211255825D-1*t33
      t56 = 0.8157414703487641D1*t36+0.2247591863577616D1*t33
     &+0.4300972471276643D0*t39+0.1911512595127338D0*t41
      t59 = 1.D0+0.2960874997779344D2/t56
      t60 = dlog(t59)
      t61 = t51*t60
      t63 = rhoa-1.D0*rhob
      t64 = t63*t32
      t65 = 1.D0+t64
      t66 = t65**(1.D0/3.D0)
      t67 = t66*t65
      t69 = 1.D0-1.D0*t64
      t70 = t69**(1.D0/3.D0)
      t71 = t70*t69
      t72 = t67+t71-2.D0
      t73 = t63**2
      t74 = t73**2
      t75 = rho**2
      t76 = t75**2
      t77 = 1/t76
      t78 = t74*t77
      t80 = 1.D0-1.D0*t78
      t81 = t72*t80
      t83 = 0.37995525D-1*t61*t81
      t85 = 1.D0+0.1274696188700087D0*t33
      t90 = 0.1112037486309468D2*t36+0.3844746237447211D1*t33
     &+0.1644733775567609D1*t39+0.2405871291288192D0*t41
      t93 = 1.D0+0.3216395899738507D2/t90
      t94 = dlog(t93)
      t97 = -0.310907D-1*t85*t94+t49
      t98 = t97*t72
      t100 = 0.1923661050931536D1*t98*t78
      t101 = t66**2
      t103 = t70**2
      t105 = 0.5D0*t101+0.5D0*t103
      t106 = t105**2
      t107 = t106*t105
      t108 = 1/t106
      t109 = sigma*t108
      t110 = rho**(1.D0/3.D0)
      t112 = 1/t110/t75
      t113 = -t49+t83+t100
      t114 = 1/t107
      t115 = t113*t114
      t117 = dexp(-0.3216396844291482D2*t115)
      t118 = t117-1.D0
      t119 = 1/t118
      t120 = t119*sigma
      t121 = t108*t112
      t123 = 0.1362107888567592D0*t120*t121
      t124 = 1.D0+t123
      t126 = t118**2
      t127 = 1/t126
      t128 = sigma**2
      t129 = t127*t128
      t130 = t106**2
      t131 = 1/t130
      t132 = t110**2
      t134 = 1/t132/t76
      t135 = t131*t134
      t138 = 1.D0+t123+0.1855337900098064D-1*t129*t135
      t139 = 1/t138
      t143 = 1.D0+0.1362107888567592D0*t109*t112*t124*t139
      t144 = dlog(t143)
      t146 = 0.310906908696549D-1*t107*t144
      zk(i) = -0.9305257363491D0*t5*t15-0.9305257363491D0*t19*t29+rho*
     &(-t49+t83+t100+t146)
      t153 = t12**2
      t154 = 1/t153
      t155 = 1/t4/t6*t154
      t162 = 0.1333333333333333D1*t66*t32-0.1333333333333333D1*t70*t32
      t164 = t61*t162*t80
      t165 = 0.37995525D-1*t164
      t166 = t73*t63
      t167 = t72*t166
      t169 = t61*t167*t77
      t170 = 0.1519821D0*t169
      t171 = t97*t162
      t172 = t171*t78
      t173 = 0.1923661050931536D1*t172
      t174 = t166*t77
      t175 = t98*t174
      t176 = 0.7694644203726145D1*t175
      t177 = t106*t144
      t178 = 1/t66
      t181 = 1/t70
      t184 = 0.3333333333333333D0*t178*t32-0.3333333333333333D0*t181*t32
      t185 = t177*t184
      t186 = 0.9327207260896469D-1*t185
      t187 = sigma*t114
      t188 = t187*t112
      t189 = t124*t139
      t190 = t189*t184
      t193 = t127*sigma
      t194 = t193*t108
      t195 = t165-t170+t173+t176
      t198 = t113*t131
      t201 = -0.3216396844291482D2*t195*t114+0.9649190532874446D2*t198
     &*t184
      t202 = t112*t201
      t203 = t202*t117
      t205 = 0.1362107888567592D0*t194*t203
      t206 = t114*t112
      t209 = 0.2724215777135184D0*t120*t206*t184
      t210 = -t205-t209
      t215 = t109*t112
      t216 = t138**2
      t217 = 1/t216
      t218 = t124*t217
      t220 = 1/t126/t118
      t221 = t220*t128
      t222 = t221*t131
      t223 = t134*t201
      t224 = t223*t117
      t228 = 1/t130/t105
      t229 = t228*t134
      t230 = t229*t184
      t233 = -t205-t209-0.3710675800196129D-1*t222*t224
     &-0.7421351600392257D-1*t129*t230
      t234 = t218*t233
      t237 = -0.2724215777135184D0*t188*t190+0.1362107888567592D0*t109
     &*t112*t210*t139-0.1362107888567592D0*t215*t234
      t238 = t107*t237
      t239 = 1/t143
      t240 = t238*t239
      t241 = 0.310906908696549D-1*t240
      t244 = 1/t41
      t245 = 1/t75
      t246 = t244*t245
      t247 = t246*t47
      t248 = 0.2747773264188438D-2*t247
      t249 = t43**2
      t250 = 1/t249
      t251 = t35*t250
      t252 = t36**2
      t253 = t252**2
      t254 = t253*t36
      t255 = 1/t254
      t256 = t255*t245
      t259 = 1/t39
      t260 = t259*t245
      t262 = 1/t33
      t263 = t262*t245
      t265 = -0.99709173929518D0*t256-0.7418564737168958D0*t246
     &-0.4002143174996817D0*t260-0.1264669550498372D0*t263
      t266 = 1/t46
      t268 = t251*t265*t266
      t269 = 0.1D1*t268
      t270 = t60*t72
      t271 = t270*t80
      t272 = t246*t271
      t273 = 0.87407428755417D-3*t272
      t274 = t56**2
      t275 = 1/t274
      t276 = t51*t275
      t281 = -0.135956911724794D1*t256-0.7491972878592054D0*t246
     &-0.2150486235638321D0*t260-0.1274341730084892D0*t263
      t282 = t276*t281
      t283 = 1/t59
      t284 = t283*t72
      t285 = t284*t80
      t286 = t282*t285
      t287 = 0.1125D1*t286
      t288 = t66*t63
      t291 = t70*t63
      t294 = -0.1333333333333333D1*t288*t245+0.1333333333333333D1*t291
     &*t245
      t296 = t61*t294*t80
      t297 = 0.37995525D-1*t296
      t298 = t72*t74
      t299 = t76*rho
      t300 = 1/t299
      t302 = t61*t298*t300
      t303 = 0.1519821D0*t302
      t306 = t90**2
      t307 = 1/t306
      t308 = t85*t307
      t313 = -0.1853395810515781D1*t256-0.128158207914907D1*t246
     &-0.8223668877838045D0*t260-0.1603914194192128D0*t263
      t314 = 1/t93
      t320 = 0.1321039893133927D-2*t246*t94+0.1D1*t308*t313*t314
     &-0.2747773264188438D-2*t247-0.1D1*t268
      t321 = t320*t72
      t322 = t321*t78
      t323 = 0.1923661050931536D1*t322
      t324 = t97*t294
      t325 = t324*t78
      t326 = 0.1923661050931536D1*t325
      t327 = t74*t300
      t328 = t98*t327
      t329 = 0.7694644203726145D1*t328
      t330 = t178*t63
      t333 = t181*t63
      t336 = -0.3333333333333333D0*t330*t245+0.3333333333333333D0*t333
     &*t245
      t337 = t177*t336
      t339 = t189*t336
      t342 = t75*rho
      t344 = 1/t110/t342
      t349 = t248+t269-t273-t287+t297+t303+t323+t326-t329
      t354 = -0.3216396844291482D2*t349*t114+0.9649190532874446D2*t198
     &*t336
      t355 = t112*t354
      t356 = t355*t117
      t358 = 0.1362107888567592D0*t194*t356
      t361 = 0.2724215777135184D0*t120*t206*t336
      t362 = t108*t344
      t364 = 0.3178251739991049D0*t120*t362
      t365 = -t358-t361-t364
      t370 = t134*t354
      t371 = t370*t117
      t374 = t229*t336
      t378 = 1/t132/t299
      t379 = t131*t378
      t382 = -t358-t361-t364-0.3710675800196129D-1*t222*t371
     &-0.7421351600392257D-1*t129*t374-0.8658243533790967D-1*t129*t379
      t383 = t218*t382
      t386 = -0.2724215777135184D0*t188*t339-0.3178251739991049D0*t109
     &*t344*t124*t139+0.1362107888567592D0*t109*t112*t365*t139
     &-0.1362107888567592D0*t215*t383
      t387 = t107*t386
      t388 = t387*t239
      t390 = t248+t269-t273-t287+t297+t303+t323+t326-t329
     &+0.9327207260896469D-1*t337+0.310906908696549D-1*t388
      t391 = rho*t390
      vrhoa(i) = -0.12407009817988D1*t4*t15+0.8963286558970112D-2*t155
     &*sigmaaa+rho*(t165-t170+t173+t176+t186+t241)-t49+t83+t100+t146
     &+t391
      t396 = t26**2
      t397 = 1/t396
      t398 = 1/t18/t20*t397
      t401 = -t162
      t403 = t61*t401*t80
      t404 = 0.37995525D-1*t403
      t405 = 0.1519821D0*t169
      t406 = t97*t401
      t407 = t406*t78
      t408 = 0.1923661050931536D1*t407
      t409 = 0.7694644203726145D1*t175
      t410 = -t184
      t411 = t177*t410
      t412 = 0.9327207260896469D-1*t411
      t413 = t189*t410
      t416 = t404+t405+t408-t409
      t421 = -0.3216396844291482D2*t416*t114+0.9649190532874446D2*t198
     &*t410
      t422 = t112*t421
      t423 = t422*t117
      t425 = 0.1362107888567592D0*t194*t423
      t428 = 0.2724215777135184D0*t120*t206*t410
      t429 = -t425-t428
      t434 = t134*t421
      t435 = t434*t117
      t438 = t229*t410
      t441 = -t425-t428-0.3710675800196129D-1*t222*t435
     &-0.7421351600392257D-1*t129*t438
      t442 = t218*t441
      t445 = -0.2724215777135184D0*t188*t413+0.1362107888567592D0*t109
     &*t112*t429*t139-0.1362107888567592D0*t215*t442
      t446 = t107*t445
      t447 = t446*t239
      t448 = 0.310906908696549D-1*t447
      vrhob(i) = -0.12407009817988D1*t18*t29+0.8963286558970112D-2
     &*t398*sigmabb+rho*(t404+t405+t408-t409+t412+t448)-t49+t83+t100
     &+t146+t391
      t454 = rho*t107
      t457 = sigma*t131
      t462 = t119*t108
      t467 = 0.1362107888567592D0*t462*t112+0.3710675800196129D-1*t193
     &*t135
      t468 = t218*t467
      t471 = 0.1362107888567592D0*t121*t189+0.1855337900098064D-1*t457
     &*t134*t119*t139-0.1362107888567592D0*t215*t468
      t473 = t454*t471*t239
      t474 = 0.310906908696549D-1*t473
      vsigmaaa(i) = -0.3361232459613792D-2/t5*t154+t474
      vsigmaab(i) = 0.6218138173930979D-1*t473
      vsigmabb(i) = -0.3361232459613792D-2/t19*t397+t474
      t484 = 0.5495546528376876D-2*t247
      t485 = 0.2D1*t268
      t486 = 0.7599105D-1*t296
      t487 = 0.225D1*t286
      t488 = 0.174814857510834D-2*t272
      t489 = 0.3039642D0*t302
      t490 = 0.7599105D-1*t164-0.3039642D0*t169+0.3847322101863073D1
     &*t172+0.1538928840745229D2*t175+0.6218138173930979D-1*t240
     &+0.1865441452179294D0*t185+t484+t485+t486-t487-t488+t489
      t491 = 0.3847322101863073D1*t322
      t492 = 0.1538928840745229D2*t328
      t493 = 0.3847322101863073D1*t325
      t494 = 0.1865441452179294D0*t337
      t495 = 0.6218138173930979D-1*t388
      t496 = 1/t101
      t499 = 1/t103
      t502 = 0.4444444444444444D0*t496*t245+0.4444444444444444D0*t499
     &*t245
      t505 = 0.37995525D-1*t61*t502*t80
      t508 = t61*t162*t166*t77
      t509 = 0.3039642D0*t508
      t512 = t61*t72*t73*t77
      t513 = 0.4559463D0*t512
      t516 = 0.1923661050931536D1*t97*t502*t78
      t517 = t171*t174
      t518 = 0.1538928840745229D2*t517
      t520 = t98*t73*t77
      t521 = 0.2308393261117844D2*t520
      t522 = t105*t144
      t523 = t184**2
      t526 = t106*t237
      t527 = t239*t184
      t530 = 1/t67
      t533 = 1/t71
      t536 = -0.1111111111111111D0*t530*t245-0.1111111111111111D0*t533
     &*t245
      t538 = 0.9327207260896469D-1*t177*t536
      t539 = t457*t112
      t543 = t210*t139
      t553 = 0.2724215777135184D0*t188*t189*t536
      t554 = t220*sigma
      t555 = t554*t108
      t556 = t201**2
      t557 = t112*t556
      t559 = dexp(-0.6432793688582964D2*t115)
      t562 = 0.2724215777135184D0*t555*t557*t559
      t563 = t193*t114
      t564 = t117*t184
      t567 = 0.5448431554270369D0*t563*t202*t564
      t571 = t195*t131
      t574 = t113*t228
      t578 = 0.9649190532874446D2*t198*t536
      t579 = -0.3216396844291482D2*(t505-t509-t513+t516+t518+t521)
     &*t114+0.1929838106574889D3*t571*t184-0.3859676213149779D3*t574
     &*t523+t578
      t583 = 0.1362107888567592D0*t194*t112*t579*t117
      t586 = 0.1362107888567592D0*t194*t557*t117
      t587 = t131*t112
      t590 = 0.8172647331405553D0*t120*t587*t523
      t593 = 0.2724215777135184D0*t120*t206*t536
      t599 = t210*t217
      t605 = t124/t216/t138
      t606 = t233**2
      t610 = t126**2
      t613 = 1/t610*t128*t131
      t614 = t134*t556
      t618 = t221*t228
      t630 = 1/t130/t106
      t631 = t630*t134
      t637 = 0.7421351600392257D-1*t129*t229*t536
      t638 = t562+t567-t583-t586+t590-t593+0.1113202740058839D0*t613
     &*t614*t559+0.2968540640156903D0*t618*t223*t564
     &-0.3710675800196129D-1*t222*t134*t579*t117-0.3710675800196129D-1
     &*t222*t614*t117+0.3710675800196129D0*t129*t631*t523-t637
      t646 = t237**2
      t648 = t143**2
      t649 = 1/t648
      t652 = t505-t509-t513+t516+t518+t521+0.1865441452179294D0*t522
     &*t523+0.1865441452179294D0*t526*t527+t538+0.310906908696549D-1
     &*t107*(0.8172647331405553D0*t539*t189*t523-0.5448431554270369D0
     &*t188*t543*t184+0.5448431554270369D0*t188*t218*t184*t233-t553
     &+0.1362107888567592D0*t109*t112*(t562+t567-t583-t586+t590-t593)
     &*t139-0.2724215777135184D0*t215*t599*t233+0.2724215777135184D0
     &*t215*t605*t606-0.1362107888567592D0*t215*t218*t638)*t239
     &-0.310906908696549D-1*t107*t646*t649
      t663 = t265**2
      t665 = t35/t249/t43*t663*t266
      t666 = 0.2D1*t665
      t669 = 1/t254/t32*t77
      t671 = 1/t342
      t672 = t255*t671
      t676 = 1/t41/t32*t77
      t678 = t244*t671
      t682 = 1/t39/t32*t77
      t684 = t259*t671
      t688 = 1/t33/t32*t77
      t690 = t262*t671
      t694 = t251*(-0.8309097827459833D0*t669+0.199418347859036D1*t672
     &-0.4945709824779306D0*t676+0.1483712947433792D1*t678
     &-0.2001071587498409D0*t682+0.8004286349993634D0*t684
     &-0.4215565168327908D-1*t688+0.2529339100996745D0*t690)*t266
      t695 = 0.1D1*t694
      t696 = t249**2
      t699 = t46**2
      t702 = t35/t696*t663/t699
      t703 = 0.1608197949869254D2*t702
      t715 = t313**2
      t731 = t306**2
      t734 = t93**2
      t739 = t676*t47
      t741 = t678*t47
      t745 = t246*t250*t265*t266
      t750 = 0.8806932620892844D-3*t676*t94-0.2642079786267853D-2*t678
     &*t94-0.8497974591333914D-1*t246*t307*t313*t314-0.2D1*t85/t306
     &/t90*t715*t314+0.1D1*t308*(-0.1544496508763151D1*t669
     &+0.3706791621031562D1*t672-0.854388052766047D0*t676
     &+0.2563164158298141D1*t678-0.4111834438919023D0*t682
     &+0.1644733775567609D1*t684-0.5346380647307093D-1*t688
     &+0.3207828388384256D0*t690)*t314+0.3216395899738507D2*t85/t731
     &*t715/t734-0.1831848842792292D-2*t739+0.5495546528376876D-2*t741
     &+0.8837926660346786D-1*t745+0.2D1*t665-0.1D1*t694
     &-0.1608197949869254D2*t702
      t753 = 0.1923661050931536D1*t750*t72*t78
      t754 = t76*t75
      t755 = 1/t754
      t758 = 0.3847322101863073D2*t98*t74*t755
      t759 = t336**2
      t772 = -0.1111111111111111D0*t530*t73*t77+0.6666666666666667D0
     &*t330*t671-0.1111111111111111D0*t533*t73*t77
     &-0.6666666666666667D0*t333*t671
      t775 = 0.1831848842792292D-2*t739
      t776 = 0.5495546528376876D-2*t741
      t780 = 0.174814857510834D-2*t246*t60*t294*t80
      t784 = 0.3039642D0*t61*t294*t74*t300
      t787 = 0.7599105D0*t61*t298*t755
      t799 = 0.1125D1*t276*(-0.1132974264373283D1*t669
     &+0.271913823449588D1*t672-0.4994648585728036D0*t676
     &+0.1498394575718411D1*t678-0.1075243117819161D0*t682
     &+0.4300972471276643D0*t684-0.4247805766949639D-1*t688
     &+0.2548683460169784D0*t690)*t285
      t800 = 0.8837926660346786D-1*t745
      t805 = 0.5176049408441869D-1*t246*t275*t281*t283*t81
      t806 = -t666+t695+t703+t753+t758+0.1865441452179294D0*t522*t759
     &+0.9327207260896469D-1*t177*t772+t775-t776-t780+t784-t787-t799
     &-t800+t805
      t808 = 1/t76/t342
      t812 = 0.699259430043336D-2*t244*t808*t270*t74
      t814 = 0.58271619170278D-3*t676*t271
      t816 = 0.174814857510834D-2*t678*t271
      t820 = 0.225D1*t282*t283*t294*t80
      t831 = 0.4444444444444444D0*t496*t73*t77+0.2666666666666667D1
     &*t288*t671+0.4444444444444444D0*t499*t73*t77
     &-0.2666666666666667D1*t291*t671
      t834 = 0.37995525D-1*t61*t831*t80
      t836 = 0.1538928840745229D2*t324*t327
      t839 = 0.1923661050931536D1*t97*t831*t78
      t842 = 0.3847322101863073D1*t320*t294*t78
      t844 = 0.1538928840745229D2*t321*t327
      t848 = t281**2
      t851 = 0.225D1*t51/t274/t56*t848*t285
      t854 = 0.9D1*t282*t284*t327
      t855 = t274**2
      t859 = t59**2
      t864 = 0.3330984372501762D2*t51/t855*t848/t859*t72*t80
      t865 = t106*t386
      t866 = t239*t336
      t869 = t386**2
      t874 = 1/t110/t76
      t886 = t187*t344
      t889 = t365*t139
      t900 = t109*t344
      t903 = t354**2
      t904 = t112*t903
      t907 = 0.2724215777135184D0*t555*t904*t559
      t908 = t117*t336
      t911 = 0.5448431554270369D0*t563*t355*t908
      t915 = 0.6356503479982097D0*t194*t344*t354*t117
      t916 = -t666+t695+t703+t753+t758+t775-t776-t780+t784-t787-t799
     &-t800
      t917 = t805-t812-t814+t816-t820+t834-t836+t839+t842-t844+t851
     &-t854-t864
      t921 = t349*t131
      t928 = -0.3216396844291482D2*(t916+t917)*t114
     &+0.1929838106574889D3*t921*t336-0.3859676213149779D3*t574*t759
     &+0.9649190532874446D2*t198*t772
      t932 = 0.1362107888567592D0*t194*t112*t928*t117
      t935 = 0.1362107888567592D0*t194*t904*t117
      t938 = 0.8172647331405553D0*t120*t587*t759
      t939 = t114*t344
      t942 = 0.1271300695996419D1*t120*t939*t336
      t945 = 0.2724215777135184D0*t120*t206*t772
      t948 = 0.1059417246663683D1*t120*t108*t874
      t954 = t365*t217
      t958 = t382**2
      t974 = t134*t903
      t981 = t228*t378
      t995 = 0.3710675800196129D0*t129*t631*t759+t907+t911+t915
     &+0.3463297413516387D0*t222*t378*t354*t117-t932-t935+t938+t942
     &-t945+t948+0.4906338002481548D0*t129*t131/t132/t754
     &-0.3710675800196129D-1*t222*t974*t117+0.2968540640156903D0*t618
     &*t370*t908+0.6926594827032773D0*t129*t981*t336
     &-0.3710675800196129D-1*t222*t134*t928*t117-0.7421351600392257D-1
     &*t129*t229*t772+0.1113202740058839D0*t613*t974*t559
      t999 = 0.1059417246663683D1*t109*t874*t124*t139
     &+0.5448431554270369D0*t188*t218*t336*t382+0.8172647331405553D0
     &*t539*t189*t759+0.1271300695996419D1*t886*t339
     &-0.5448431554270369D0*t188*t889*t336-0.6356503479982097D0*t109
     &*t344*t365*t139-0.2724215777135184D0*t188*t189*t772
     &+0.6356503479982097D0*t900*t383+0.1362107888567592D0*t109*t112*
     &(t907+t911+t915-t932-t935+t938+t942-t945+t948)*t139
     &-0.2724215777135184D0*t215*t954*t382+0.2724215777135184D0*t215
     &*t605*t958-0.1362107888567592D0*t215*t218*t995
      t1003 = -t812-t814+t816-t820+t834-t836+t839+t842-t844+t851-t854
     &-t864+0.1865441452179294D0*t865*t866-0.310906908696549D-1*t107
     &*t869*t649+0.310906908696549D-1*t107*t999*t239
      t1005 = rho*(t806+t1003)
      t1009 = t6**2
      t1013 = 1/t153/t12
      t1015 = sigmaaa**2
      t1021 = 0.87407428755417D-3*t246*t60*t162*t80
      t1024 = t244*t755*t270*t166
      t1025 = 0.349629715021668D-2*t1024
      t1029 = 0.1125D1*t282*t283*t162*t80
      t1031 = t282*t284*t174
      t1032 = 0.45D1*t1031
      t1043 = -0.4444444444444444D0*t496*t63*t671-0.1333333333333333D1
     &*t66*t245-0.4444444444444444D0*t499*t63*t671
     &+0.1333333333333333D1*t70*t245
      t1046 = 0.37995525D-1*t61*t1043*t80
      t1049 = t61*t294*t166*t77
      t1050 = 0.1519821D0*t1049
      t1054 = 0.1519821D0*t61*t162*t74*t300
      t1056 = t61*t167*t300
      t1057 = 0.6079284D0*t1056
      t1060 = 0.1923661050931536D1*t320*t162*t78
      t1061 = t321*t174
      t1062 = 0.7694644203726145D1*t1061
      t1065 = 0.1923661050931536D1*t97*t1043*t78
      t1066 = t324*t174
      t1067 = 0.7694644203726145D1*t1066
      t1069 = 0.7694644203726145D1*t171*t327
      t1071 = t98*t166*t300
      t1072 = 0.3077857681490458D2*t1071
      t1073 = t336*t184
      t1075 = 0.1865441452179294D0*t522*t1073
      t1077 = 0.9327207260896469D-1*t526*t866
      t1088 = 0.1111111111111111D0*t530*t63*t671-0.3333333333333333D0
     &*t178*t245+0.1111111111111111D0*t533*t63*t671
     &+0.3333333333333333D0*t181*t245
      t1090 = 0.9327207260896469D-1*t177*t1088
      t1092 = 0.9327207260896469D-1*t865*t527
      t1095 = 0.8172647331405553D0*t539*t189*t1073
      t1098 = 0.2724215777135184D0*t188*t543*t336
      t1102 = 0.2724215777135184D0*t188*t218*t336*t233
      t1105 = 0.2724215777135184D0*t188*t189*t1088
      t1107 = 0.6356503479982097D0*t886*t190
      t1111 = 0.3178251739991049D0*t109*t344*t210*t139
      t1113 = 0.3178251739991049D0*t900*t234
      t1116 = 0.2724215777135184D0*t188*t889*t184
      t1117 = t559*t201
      t1120 = 0.2724215777135184D0*t555*t355*t1117
      t1123 = 0.2724215777135184D0*t563*t355*t564
      t1124 = -t1021+t1025-t1029+t1032+t1046-t1050+t1054+t1057+t1060
     &+t1062+t1065+t1067-t1069-t1072
      t1128 = 0.9649190532874446D2*t921*t184
      t1130 = 0.9649190532874446D2*t571*t336
      t1132 = 0.3859676213149779D3*t574*t1073
      t1134 = 0.9649190532874446D2*t198*t1088
      t1135 = -0.3216396844291482D2*t1124*t114+t1128+t1130-t1132+t1134
      t1139 = 0.1362107888567592D0*t194*t112*t1135*t117
      t1140 = t201*t117
      t1143 = 0.1362107888567592D0*t194*t355*t1140
      t1144 = t112*t336
      t1147 = 0.2724215777135184D0*t563*t1144*t1140
      t1148 = t120*t131
      t1151 = 0.8172647331405553D0*t1148*t1144*t184
      t1154 = 0.2724215777135184D0*t120*t206*t1088
      t1158 = 0.3178251739991049D0*t194*t344*t201*t117
      t1161 = 0.6356503479982097D0*t120*t939*t184
      t1169 = 0.1362107888567592D0*t215*t954*t233
      t1173 = 0.2724215777135184D0*t188*t218*t382*t184
      t1176 = 0.1362107888567592D0*t215*t599*t382
      t1180 = 0.2724215777135184D0*t215*t605*t382*t233
      t1183 = 0.1113202740058839D0*t613*t370*t1117
      t1186 = 0.1484270320078451D0*t618*t370*t564
      t1193 = 0.3710675800196129D-1*t222*t370*t1140
      t1194 = t134*t336
      t1197 = 0.1484270320078451D0*t618*t1194*t1140
      t1198 = t129*t630
      t1201 = 0.3710675800196129D0*t1198*t1194*t184
      t1204 = 0.7421351600392257D-1*t129*t229*t1088
      t1208 = 0.1731648706758193D0*t222*t378*t201*t117
      t1211 = 0.3463297413516387D0*t129*t981*t184
      t1212 = t1120+t1123-t1139-t1143+t1147+t1151-t1154+t1158+t1161
     &+t1183+t1186-0.3710675800196129D-1*t222*t134*t1135*t117-t1193
     &+t1197+t1201-t1204+t1208+t1211
      t1216 = t1095-t1098+t1102-t1105+t1107-t1111+t1113-t1116
     &+0.1362107888567592D0*t109*t112*(t1120+t1123-t1139-t1143+t1147
     &+t1151-t1154+t1158+t1161)*t139-t1169+t1173-t1176+t1180
     &-0.1362107888567592D0*t215*t218*t1212
      t1222 = 0.310906908696549D-1*t387*t649*t237
      t1223 = -t1021+t1025-t1029+t1032+t1046-t1050+t1054+t1057+t1060
     &+t1062+t1065+t1067-t1069-t1072+t1075+t1077+t1090+t1092
     &+0.310906908696549D-1*t107*t1216*t239-t1222
      t1224 = rho*t1223
      t1225 = 0.45D1*t1031
      t1226 = -t1021-t1029+t1046+t1054+t1025+t1225-t1050+t1057+t1060
     &+t1065-t1069+t1062+t1067-t1072
      t1229 = -0.3216396844291482D2*t1226*t114+t1130+t1128-t1132+t1134
      t1233 = 0.1362107888567592D0*t194*t112*t1229*t117
      t1243 = t1120+t1147+t1158-t1233-t1143+t1123+t1151+t1161-t1154
     &+t1183+t1197+t1208-0.3710675800196129D-1*t222*t134*t1229*t117
     &-t1193+t1186+t1201+t1211-t1204
      t1247 = t1095+t1107-t1116+t1173-t1105-t1098-t1111
     &+0.1362107888567592D0*t109*t112*(t1120+t1147+t1158-t1233-t1143
     &+t1123+t1151+t1161-t1154)*t139-t1176+t1102+t1113-t1169+t1180
     &-0.1362107888567592D0*t215*t218*t1243
      t1251 = -t1021-t1029+t1046+t1054+t1025+t1225-t1050+t1057+t1060
     &+t1065-t1069+t1062+t1067-t1072+t1075+t1092+t1090+t1077
     &+0.310906908696549D-1*t107*t1247*t239-t1222
      t1252 = rho*t1251
      t1253 = t491-t492+t493+t494+t495+rho*t652-0.8963286558970112D-2
     &/t4/t6/rhoa*t154*sigmaaa+t1005-0.4135669939329333D0/t7*t15
     &+0.2147732158441357D-3/t1009/t6*t1013*t1015+t1224+t1252
      v2rhoa2(i) = t490+t1253
      t1257 = 0.3039642D0*t169-0.1538928840745229D2*t175
     &+0.6218138173930979D-1*t447+t484+t485+t486-t487-t488+t489+t491
     &-t492+t493
      t1264 = t20**2
      t1268 = 1/t396/t26
      t1270 = sigmabb**2
      t1281 = t61*t401*t166*t77
      t1282 = 0.3039642D0*t1281
      t1283 = t406*t174
      t1284 = 0.1538928840745229D2*t1283
      t1285 = t410**2
      t1288 = t106*t445
      t1289 = t239*t410
      t1295 = t429*t139
      t1303 = t421**2
      t1304 = t112*t1303
      t1307 = 0.2724215777135184D0*t555*t1304*t559
      t1308 = t117*t410
      t1311 = 0.5448431554270369D0*t563*t422*t1308
      t1315 = t416*t131
      t1320 = -0.3216396844291482D2*(t505+t1282-t513+t516-t1284+t521)
     &*t114+0.1929838106574889D3*t1315*t410-0.3859676213149779D3*t574
     &*t1285+t578
      t1324 = 0.1362107888567592D0*t194*t112*t1320*t117
      t1327 = 0.1362107888567592D0*t194*t1304*t117
      t1330 = 0.8172647331405553D0*t120*t587*t1285
      t1336 = t429*t217
      t1340 = t441**2
      t1344 = t134*t1303
      t1361 = t1307+t1311-t1324-t1327+t1330-t593+0.1113202740058839D0
     &*t613*t1344*t559+0.2968540640156903D0*t618*t434*t1308
     &-0.3710675800196129D-1*t222*t134*t1320*t117
     &-0.3710675800196129D-1*t222*t1344*t117+0.3710675800196129D0*t129
     &*t631*t1285-t637
      t1369 = t445**2
      t1373 = t505+t1282-t513+t516-t1284+t521+0.1865441452179294D0
     &*t522*t1285+0.1865441452179294D0*t1288*t1289+t538
     &+0.310906908696549D-1*t107*(0.8172647331405553D0*t539*t189*t1285
     &-0.5448431554270369D0*t188*t1295*t410+0.5448431554270369D0*t188
     &*t218*t410*t441-t553+0.1362107888567592D0*t109*t112*(t1307+t1311
     &-t1324-t1327+t1330-t593)*t139-0.2724215777135184D0*t215*t1336
     &*t441+0.2724215777135184D0*t215*t605*t1340-0.1362107888567592D0
     &*t215*t218*t1361)*t239-0.310906908696549D-1*t107*t1369*t649
      t1378 = 0.87407428755417D-3*t246*t60*t401*t80
      t1379 = 0.349629715021668D-2*t1024
      t1383 = 0.1125D1*t282*t283*t401*t80
      t1384 = 0.45D1*t1031
      t1385 = -t1043
      t1388 = 0.37995525D-1*t61*t1385*t80
      t1389 = 0.1519821D0*t1049
      t1393 = 0.1519821D0*t61*t401*t74*t300
      t1394 = 0.6079284D0*t1056
      t1397 = 0.1923661050931536D1*t320*t401*t78
      t1398 = 0.7694644203726145D1*t1061
      t1401 = 0.1923661050931536D1*t97*t1385*t78
      t1402 = 0.7694644203726145D1*t1066
      t1404 = 0.7694644203726145D1*t406*t327
      t1405 = 0.3077857681490458D2*t1071
      t1406 = t336*t410
      t1411 = -t1088
      t1440 = t559*t421
      t1443 = 0.2724215777135184D0*t555*t355*t1440
      t1446 = 0.2724215777135184D0*t563*t355*t1308
      t1447 = -t1378-t1379-t1383-t1384+t1388+t1389+t1393-t1394+t1397
     &-t1398+t1401-t1402-t1404+t1405
      t1458 = -0.3216396844291482D2*t1447*t114+0.9649190532874446D2
     &*t921*t410+0.9649190532874446D2*t1315*t336-0.3859676213149779D3
     &*t574*t1406+0.9649190532874446D2*t198*t1411
      t1462 = 0.1362107888567592D0*t194*t112*t1458*t117
      t1463 = t421*t117
      t1466 = 0.1362107888567592D0*t194*t355*t1463
      t1469 = 0.2724215777135184D0*t563*t1144*t1463
      t1472 = 0.8172647331405553D0*t1148*t1144*t410
      t1475 = 0.2724215777135184D0*t120*t206*t1411
      t1479 = 0.3178251739991049D0*t194*t344*t421*t117
      t1482 = 0.6356503479982097D0*t120*t939*t410
      t1531 = t1443+t1446-t1462-t1466+t1469+t1472-t1475+t1479+t1482
     &+0.1113202740058839D0*t613*t370*t1440+0.1484270320078451D0*t618
     &*t370*t1308-0.3710675800196129D-1*t222*t134*t1458*t117
     &-0.3710675800196129D-1*t222*t370*t1463+0.1484270320078451D0*t618
     &*t1194*t1463+0.3710675800196129D0*t1198*t1194*t410
     &-0.7421351600392257D-1*t129*t229*t1411+0.1731648706758193D0*t222
     &*t378*t421*t117+0.3463297413516387D0*t129*t981*t410
      t1535 = 0.8172647331405553D0*t539*t189*t1406
     &-0.2724215777135184D0*t188*t1295*t336+0.2724215777135184D0*t188
     &*t218*t336*t441-0.2724215777135184D0*t188*t189*t1411
     &+0.6356503479982097D0*t886*t413-0.3178251739991049D0*t109*t344
     &*t429*t139+0.3178251739991049D0*t900*t442-0.2724215777135184D0
     &*t188*t889*t410+0.1362107888567592D0*t109*t112*(t1443+t1446
     &-t1462-t1466+t1469+t1472-t1475+t1479+t1482)*t139
     &-0.1362107888567592D0*t215*t954*t441+0.2724215777135184D0*t188
     &*t218*t382*t410-0.1362107888567592D0*t215*t1336*t382
     &+0.2724215777135184D0*t215*t605*t382*t441-0.1362107888567592D0
     &*t215*t218*t1531
      t1539 = t649*t445
      t1542 = -t1378-t1379-t1383-t1384+t1388+t1389+t1393-t1394+t1397
     &-t1398+t1401-t1402-t1404+t1405+0.1865441452179294D0*t522*t1406
     &+0.9327207260896469D-1*t1288*t866+0.9327207260896469D-1*t177
     &*t1411+0.9327207260896469D-1*t865*t1289+0.310906908696549D-1
     &*t107*t1535*t239-0.310906908696549D-1*t387*t1539
      t1543 = rho*t1542
      t1544 = t494+t495+0.7599105D-1*t403+0.3847322101863073D1*t407
     &+0.1865441452179294D0*t411-0.4135669939329333D0/t21*t29
     &+0.2147732158441357D-3/t1264/t20*t1268*t1270
     &-0.8963286558970112D-2/t18/t20/rhob*t397*sigmabb+t1005+rho*t1373
     &+2*t1543
      v2rhob2(i) = t1257+t1544
      t1545 = 0.5D0*t1543
      t1546 = t485+t486+t491+t493-t492+t173+t186+t165+t241+t484+t494
     &+t1545
      t1547 = -t502
      t1550 = 0.37995525D-1*t61*t1547*t80
      t1551 = 0.1519821D0*t508
      t1552 = 0.1519821D0*t1281
      t1553 = 0.4559463D0*t512
      t1556 = 0.1923661050931536D1*t97*t1547*t78
      t1557 = 0.7694644203726145D1*t517
      t1558 = 0.7694644203726145D1*t1283
      t1559 = 0.2308393261117844D2*t520
      t1560 = t184*t410
      t1565 = -t536
      t1588 = 0.2724215777135184D0*t555*t202*t1440
      t1591 = 0.2724215777135184D0*t563*t202*t1308
      t1603 = -0.3216396844291482D2*(t1550+t1551-t1552+t1553+t1556
     &-t1557+t1558-t1559)*t114+0.9649190532874446D2*t571*t410
     &+0.9649190532874446D2*t1315*t184-0.3859676213149779D3*t574*t1560
     &+0.9649190532874446D2*t198*t1565
      t1607 = 0.1362107888567592D0*t194*t112*t1603*t117
      t1610 = 0.1362107888567592D0*t194*t202*t1463
      t1611 = t112*t184
      t1614 = 0.2724215777135184D0*t563*t1611*t1463
      t1617 = 0.8172647331405553D0*t1148*t1611*t410
      t1620 = 0.2724215777135184D0*t120*t206*t1565
      t1653 = t134*t184
      t1663 = t1588+t1591-t1607-t1610+t1614+t1617-t1620
     &+0.1113202740058839D0*t613*t223*t1440+0.1484270320078451D0*t618
     &*t223*t1308-0.3710675800196129D-1*t222*t134*t1603*t117
     &-0.3710675800196129D-1*t222*t223*t1463+0.1484270320078451D0*t618
     &*t1653*t1463+0.3710675800196129D0*t1198*t1653*t410
     &-0.7421351600392257D-1*t129*t229*t1565
      t1667 = 0.8172647331405553D0*t539*t189*t1560
     &-0.2724215777135184D0*t188*t1295*t184+0.2724215777135184D0*t188
     &*t218*t184*t441-0.2724215777135184D0*t188*t189*t1565
     &-0.2724215777135184D0*t188*t543*t410+0.1362107888567592D0*t109
     &*t112*(t1588+t1591-t1607-t1610+t1614+t1617-t1620)*t139
     &-0.1362107888567592D0*t215*t599*t441+0.2724215777135184D0*t188
     &*t218*t233*t410-0.1362107888567592D0*t215*t1336*t233
     &+0.2724215777135184D0*t215*t605*t233*t441-0.1362107888567592D0
     &*t215*t218*t1663
      t1673 = t1550+t1551-t1552+t1553+t1556-t1557+t1558-t1559
     &+0.1865441452179294D0*t522*t1560+0.9327207260896469D-1*t1288
     &*t527+0.9327207260896469D-1*t177*t1565+0.9327207260896469D-1
     &*t526*t1289+0.310906908696549D-1*t107*t1667*t239
     &-0.310906908696549D-1*t238*t1539
      t1677 = -t488-t487+t489+rho*t1673+t495+t412+t404+t408+t1005+t448
     &+0.5D0*t1252+0.5D0*t1224+t1545
      v2rhoab(i) = t1546+t1677
      t1684 = t106*t471
      t1690 = sigma*t228*t134
      t1691 = t119*t139
      t1701 = t127*t108
      t1703 = 0.1362107888567592D0*t1701*t203
      t1704 = t119*t114
      t1706 = 0.2724215777135184D0*t1704*t1611
      t1717 = t457*t134
      t1718 = t119*t217
      t1726 = t554*t131
      t1739 = t649*t471
      t1743 = rho*(0.9327207260896469D-1*t1684*t527
     &+0.310906908696549D-1*t107*(-0.2724215777135184D0*t206*t190
     &-0.3710675800196129D-1*t1690*t1691*t184+0.2724215777135184D0
     &*t188*t218*t184*t467+0.1362107888567592D0*t121*t543
     &+0.1362107888567592D0*t109*t112*(-t1703-t1706)*t139
     &-0.1362107888567592D0*t215*t599*t467-0.1362107888567592D0*t121
     &*t234-0.1855337900098064D-1*t1717*t1718*t233
     &+0.2724215777135184D0*t215*t605*t233*t467-0.1362107888567592D0
     &*t215*t218*(-t1703-t1706-0.7421351600392257D-1*t1726*t224
     &-0.1484270320078451D0*t193*t230))*t239-0.310906908696549D-1*t238
     &*t1739)
      t1745 = t107*t471*t239
      t1746 = 0.310906908696549D-1*t1745
      t1769 = 0.1362107888567592D0*t1701*t356
      t1771 = 0.2724215777135184D0*t1704*t1144
      t1773 = 0.3178251739991049D0*t462*t344
      t1801 = -0.2724215777135184D0*t206*t339-0.3710675800196129D-1
     &*t1690*t1691*t336+0.2724215777135184D0*t188*t218*t336*t467
     &-0.3178251739991049D0*t362*t189-0.4329121766895483D-1*t457*t378
     &*t119*t139+0.3178251739991049D0*t900*t468+0.1362107888567592D0
     &*t121*t889+0.1362107888567592D0*t109*t112*(-t1769-t1771-t1773)
     &*t139-0.1362107888567592D0*t215*t954*t467-0.1362107888567592D0
     &*t121*t383-0.1855337900098064D-1*t1717*t1718*t382
     &+0.2724215777135184D0*t215*t605*t382*t467-0.1362107888567592D0
     &*t215*t218*(-t1769-t1771-t1773-0.7421351600392257D-1*t1726*t371
     &-0.1484270320078451D0*t193*t374-0.1731648706758193D0*t193*t379)
      t1808 = rho*(0.9327207260896469D-1*t1684*t866
     &+0.310906908696549D-1*t107*t1801*t239-0.310906908696549D-1*t387
     &*t1739)
      v2rhoasigmaaa(i) = 0.4481643279485056D-2*t155
     &-0.8053995594155087D-4/t1009/rhoa*t1013*sigmaaa+t1743+t1746+t1808
      t1810 = 0.6218138173930979D-1*t1745
      t1811 = 2.D0*t1808
      v2rhoasigmaab(i) = 2.D0*t1743+t1810+t1811
      v2rhoasigmabb(i) = t1743+t1746+t1808
      t1826 = 0.1362107888567592D0*t1701*t423
      t1829 = 0.2724215777135184D0*t1704*t112*t410
      t1862 = rho*(0.9327207260896469D-1*t1684*t1289
     &+0.310906908696549D-1*t107*(-0.2724215777135184D0*t206*t413
     &-0.3710675800196129D-1*t1690*t1691*t410+0.2724215777135184D0
     &*t188*t218*t410*t467+0.1362107888567592D0*t121*t1295
     &+0.1362107888567592D0*t109*t112*(-t1826-t1829)*t139
     &-0.1362107888567592D0*t215*t1336*t467-0.1362107888567592D0*t121
     &*t442-0.1855337900098064D-1*t1717*t1718*t441
     &+0.2724215777135184D0*t215*t605*t441*t467-0.1362107888567592D0
     &*t215*t218*(-t1826-t1829-0.7421351600392257D-1*t1726*t435
     &-0.1484270320078451D0*t193*t438))*t239-0.310906908696549D-1*t446
     &*t1739)
      v2rhobsigmaaa(i) = t1862+t1746+t1808
      v2rhobsigmaab(i) = 2.D0*t1862+t1810+t1811
      v2rhobsigmabb(i) = 0.4481643279485056D-2*t398
     &-0.8053995594155087D-4/t1264/rhob*t1268*sigmabb+t1862+t1746+t1808
      t1880 = t467**2
      t1891 = t454*(0.3710675800196129D-1*t135*t1691
     &-0.2724215777135184D0*t121*t468-0.3710675800196129D-1*t1717
     &*t1718*t467+0.2724215777135184D0*t215*t605*t1880
     &-0.5054340779364009D-2*sigma*t630*t808*t218*t127)*t239
      t1892 = 0.310906908696549D-1*t1891
      t1893 = t471**2
      t1895 = t454*t1893*t649
      t1896 = 0.310906908696549D-1*t1895
      v2sigmaaa2(i) = 0.3020248347808158D-4/t1009*t1013+t1892-t1896
      v2sigmaaaab(i) = 0.6218138173930979D-1*t1891
     &-0.6218138173930979D-1*t1895
      v2sigmaaabb(i) = t1892-t1896
      v2sigmaab2(i) = 0.1243627634786196D0*t1891-0.1243627634786196D0
     &*t1895
      v2sigmaabbb(i) = v2sigmaaaab(i)
      v2sigmabb2(i) = 0.3020248347808158D-4/t1264*t1268+t1892-t1896
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_pbe
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     J.P. Perdew, K. Burke, and M. Ernzerhof
c     Generalized gradient approximation made simple
c     Phys. Rev. Lett. 77 (1996) 3865-3868
c
c
c     CITATION:
c
c     Functionals were obtained from the Density Functional Repository 
c     as developed and distributed by the Quantum Chemistry Group, 
c     CCLRC Daresbury Laboratory, Daresbury, Cheshire, WA4 4AD 
c     United Kingdom. Contact Huub van Dam (h.j.j.vandam@dl.ac.uk) or 
c     Paul Sherwood for further information.
c
c     COPYRIGHT:
c
c     Users may incorporate the source code into software packages and
c     redistribute the source code provided the source code is not
c     changed in anyway and is properly cited in any documentation or
c     publication related to its use.
c
c     ACKNOWLEDGEMENT:
c
c     The source code was generated using Maple 8 through a modified
c     version of the dfauto script published in:
c
c        R. Strange, F.R. Manby, P.J. Knowles
c        Automatic code generation in density functional theory
c        Comp. Phys. Comm. 136 (2001) 310-318.
c
      implicit real*8 (a-h,o-z)
      integer ideriv,npt
      real*8 rhoa1(npt)
      real*8 sigmaaa1(npt)
      real*8 zk(npt),vrhoa(npt),vsigmaaa(npt)
      real*8 v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t16 = 1/rho
      t17 = t16**(1.D0/3.D0)
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t31 = dlog(1.D0+0.1608197949869254D2/(0.598255043577108D1*t20
     &+0.2225569421150687D1*t17+0.8004286349993634D0*t23
     &+0.1897004325747559D0*t25))
      t32 = (1.D0+0.1325688999052018D0*t17)*t31
      t35 = 1/t2/t4
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t43 = 0.1362107888567592D0/t39*sigma*t35
      t45 = t39**2
      t47 = sigma**2
      t49 = t4**2
      t60 = dlog(1.D0+0.1362107888567592D0*sigma*t35*(1.D0+t43)/(1.D0
     &+t43+0.1855337900098064D-1/t45*t47/t5/t49))
      zk(i) = -0.7385587663820224D0*t2*rho*(0.1804D1-0.804D0/(1.D0
     &+0.7131826587600489D-2*sigma/t5/t4))+rho*(-0.621814D-1*t32
     &+0.310906908696549D-1*t60)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t10 = 1.D0+0.7131826587600489D-2*sigma/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      t16 = 1/rho
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1325688999052018D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.598255043577108D1*t20+0.2225569421150687D1*t17
     &+0.8004286349993634D0*t23+0.1897004325747559D0*t25
      t30 = 1.D0+0.1608197949869254D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.621814D-1*t32
      t35 = 1/t2/t4
      t36 = sigma*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigma
      t43 = 0.1362107888567592D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigma**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t54 = 1.D0+t43+0.1855337900098064D-1*t48*t51
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.1362107888567592D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.310906908696549D-1*t60
      zk(i) = -0.7385587663820224D0*t3*t13+rho*(-t33+t61)
      t66 = t10**2
      t67 = 1/t66
      t72 = 1/t4
      t73 = 1/t25*t72
      t74 = t73*t31
      t76 = t27**2
      t79 = t20**2
      t80 = t79**2
      t95 = t19/t76*(-0.99709173929518D0/t80/t20*t72
     &-0.7418564737168958D0*t73-0.4002143174996817D0/t23*t72
     &-0.1264669550498372D0/t17*t72)/t30
      t99 = 1/t2/t4/rho
      t103 = t46*sigma
      t106 = -0.8837929255764197D-1*t74-0.3216396844291482D2*t95
      t110 = 0.1362107888567592D0*t103*t35*t106*t38
      t112 = 0.3178251739991049D0*t41*t99
      t117 = t54**2
      t119 = t44/t117
      t137 = 1/t59
      vrhoa(i) = -0.9847450218426965D0*t2*t13+0.1129303341188623D-1
     &*t35*t67*sigma-t33+t61+rho*(0.2747773264188438D-2*t74+0.1D1*t95
     &+0.310906908696549D-1*(-0.3178251739991049D0*sigma*t99*t56
     &+0.1362107888567592D0*t36*(-t110-t112)*t55-0.1362107888567592D0
     &*t36*t119*(-t110-t112-0.3710675800196129D-1/t45/t39*t47*t51*t106
     &*t38-0.8658243533790967D-1*t48/t5/t49/rho))*t137)
      vsigmaaa(i) = -0.1693955011782934D-1/t3*t67+0.1243627634786196D0
     &*rho*(0.1362107888567592D0*t35*t44*t55+0.1855337900098064D-1
     &*sigma*t51*t40*t55-0.1362107888567592D0*t36*t119*
     &(0.1362107888567592D0*t40*t35+0.3710675800196129D-1*t103*t51))
     &*t137
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t10 = 1.D0+0.7131826587600489D-2*sigma/t5/t4
      t13 = 0.1804D1-0.804D0/t10
      t16 = 1/rho
      t17 = t16**(1.D0/3.D0)
      t19 = 1.D0+0.1325688999052018D0*t17
      t20 = t16**(1.D0/6.D0)
      t23 = dsqrt(t16)
      t25 = t17**2
      t27 = 0.598255043577108D1*t20+0.2225569421150687D1*t17
     &+0.8004286349993634D0*t23+0.1897004325747559D0*t25
      t30 = 1.D0+0.1608197949869254D2/t27
      t31 = dlog(t30)
      t32 = t19*t31
      t33 = 0.621814D-1*t32
      t35 = 1/t2/t4
      t36 = sigma*t35
      t38 = dexp(0.2000000587336264D1*t32)
      t39 = t38-1.D0
      t40 = 1/t39
      t41 = t40*sigma
      t43 = 0.1362107888567592D0*t41*t35
      t44 = 1.D0+t43
      t45 = t39**2
      t46 = 1/t45
      t47 = sigma**2
      t48 = t46*t47
      t49 = t4**2
      t51 = 1/t5/t49
      t54 = 1.D0+t43+0.1855337900098064D-1*t48*t51
      t55 = 1/t54
      t56 = t44*t55
      t59 = 1.D0+0.1362107888567592D0*t36*t56
      t60 = dlog(t59)
      t61 = 0.310906908696549D-1*t60
      zk(i) = -0.7385587663820224D0*t3*t13+rho*(-t33+t61)
      t66 = t10**2
      t67 = 1/t66
      t68 = t35*t67
      t71 = 1/t25
      t72 = 1/t4
      t73 = t71*t72
      t74 = t73*t31
      t76 = t27**2
      t77 = 1/t76
      t78 = t19*t77
      t79 = t20**2
      t80 = t79**2
      t81 = t80*t20
      t82 = 1/t81
      t86 = 1/t23
      t89 = 1/t17
      t92 = -0.99709173929518D0*t82*t72-0.7418564737168958D0*t73
     &-0.4002143174996817D0*t86*t72-0.1264669550498372D0*t89*t72
      t93 = 1/t30
      t95 = t78*t92*t93
      t97 = t4*rho
      t99 = 1/t2/t97
      t100 = sigma*t99
      t103 = t46*sigma
      t106 = -0.8837929255764197D-1*t74-0.3216396844291482D2*t95
      t110 = 0.1362107888567592D0*t103*t35*t106*t38
      t112 = 0.3178251739991049D0*t41*t99
      t113 = -t110-t112
      t114 = t113*t55
      t117 = t54**2
      t118 = 1/t117
      t119 = t44*t118
      t121 = 1/t45/t39
      t122 = t121*t47
      t124 = t51*t106*t38
      t127 = t49*rho
      t129 = 1/t5/t127
      t132 = -t110-t112-0.3710675800196129D-1*t122*t124
     &-0.8658243533790967D-1*t48*t129
      t133 = t119*t132
      t136 = -0.3178251739991049D0*t100*t56+0.1362107888567592D0*t36
     &*t114-0.1362107888567592D0*t36*t133
      t137 = 1/t59
      t138 = t136*t137
      vrhoa(i) = -0.9847450218426965D0*t2*t13+0.1129303341188623D-1
     &*t68*sigma-t33+t61+rho*(0.2747773264188438D-2*t74+0.1D1*t95
     &+0.310906908696549D-1*t138)
      t145 = t35*t44
      t148 = sigma*t51
      t149 = t40*t55
      t156 = 0.1362107888567592D0*t40*t35+0.3710675800196129D-1*t103*t51
      t157 = t119*t156
      t160 = 0.1362107888567592D0*t145*t55+0.1855337900098064D-1*t148
     &*t149-0.1362107888567592D0*t36*t157
      vsigmaaa(i) = -0.1693955011782934D-1/t3*t67+0.1243627634786196D0
     &*rho*t160*t137
      t170 = t49*t4
      t173 = 1/t66/t10
      t190 = dlog(1.D0+0.2960874997779344D2/(0.8157414703487641D1*t20
     &+0.2247591863577616D1*t17+0.4300972471276643D0*t23
     &+0.1911512595127338D0*t25))
      t192 = (1.D0+0.6901399211255825D-1*t17)*t190*t72
      t194 = t60*t72
      t197 = 1/t2/t49
      t199 = sigma*t197*t56
      t204 = 0.1086299437397317D1*t192-0.1333333724890842D1*t32*t72
      t208 = 0.1362107888567592D0*t103*t35*t204*t38
      t209 = t41*t197
      t210 = 0.6053812838078188D-1*t209
      t221 = t48/t5/t170
      t232 = t76**2
      t235 = t92**2
      t236 = t30**2
      t239 = t19/t232*t235/t236
      t243 = 1/t49
      t244 = 1/t25/t16*t243
      t245 = t244*t31
      t251 = t19/t76/t27*t235*t93
      t257 = 1/t97
      t261 = t71*t257
      t277 = t78*(-0.8309097827459833D0/t81/t16*t243
     &+0.199418347859036D1*t82*t257-0.4945709824779306D0*t244
     &+0.1483712947433792D1*t261-0.2001071587498409D0/t23/t16*t243
     &+0.8004286349993634D0*t86*t257-0.4215565168327908D-1/t17/t16
     &*t243+0.2529339100996745D0*t89*t257)*t93
      t281 = t73*t77*t92*t93
      t283 = t261*t31
      t285 = t136**2
      t286 = t59**2
      t287 = 1/t286
      t295 = t121*sigma
      t296 = t106**2
      t297 = t35*t296
      t299 = dexp(0.4000001174672527D1*t32)
      t302 = 0.2724215777135184D0*t295*t297*t299
      t306 = 0.6356503479982097D0*t103*t99*t106*t38
      t313 = -0.5172602810955498D3*t239-0.5891952837176131D-1*t245
     &+0.6432793688582964D2*t251-0.3216396844291482D2*t277
     &+0.2842627942041896D1*t281+0.1767585851152839D0*t283
      t317 = 0.1362107888567592D0*t103*t35*t313*t38
      t320 = 0.1362107888567592D0*t103*t297*t38
      t321 = 0.1059417246663683D1*t209
      t326 = t113*t118
      t331 = 1/t117/t54
      t332 = t44*t331
      t333 = t132**2
      t341 = t45**2
      t344 = t51*t296
      t369 = -t204
      t373 = 0.1362107888567592D0*t103*t35*t369*t38
      t374 = 0.6053812838078188D-1*t209
      s1 = 0.4D1*t95+0.1099109305675375D-1*t74+0.1243627634786196D0
     &*t138-0.6564966812284644D0/t5*t13
      s2 = s1+0.8590928633765426D-3/t170*t173*t47
     &-0.2258606682377246D-1*t99*t67*sigma
      s3 = s2+rho*(-0.337738D-1*t192+0.207271272464366D-1*t194
     &+0.310906908696549D-1*(-0.6053812838078188D-1*t199
     &+0.1362107888567592D0*t36*(-t208-t210)*t55-0.1362107888567592D0
     &*t36*t119*(-t208-t210-0.3710675800196129D-1*t122*t51*t204*t38
     &-0.1649189244531613D-1*t221))*t137)
      s4 = s3
      s6 = 2.D0*rho*(0.1608197949869254D2*t239+0.1831848842792292D-2
     &*t245-0.2D1*t251+0.1D1*t277-0.8837926660346786D-1*t281
     &-0.5495546528376876D-2*t283-0.310906908696549D-1*t285*t287
     &+0.310906908696549D-1*(0.6356503479982097D0*t100*t133
     &+0.1059417246663683D1*t199-0.6356503479982097D0*t100*t114
     &+0.1362107888567592D0*t36*(t302+t306-t317-t320+t321)*t55
     &-0.2724215777135184D0*t36*t326*t132+0.2724215777135184D0*t36
     &*t332*t333-0.1362107888567592D0*t36*t119*(t302+t306-t317-t320
     &+t321+0.3463297413516387D0*t122*t129*t106*t38
     &+0.1113202740058839D0/t341*t47*t344*t299-0.3710675800196129D-1
     &*t122*t51*t313*t38-0.3710675800196129D-1*t122*t344*t38
     &+0.4906338002481548D0*t221))*t137)
      s7 = rho*(0.337738D-1*t192-0.207271272464366D-1*t194
     &+0.310906908696549D-1*(0.6053812838078188D-1*t199
     &+0.1362107888567592D0*t36*(-t373+t374)*t55-0.1362107888567592D0
     &*t36*t119*(-t373+t374-0.3710675800196129D-1*t122*t51*t369*t38
     &+0.1649189244531613D-1*t221))*t137)
      s5 = s6+s7
      v2rhoa2(i) = s4+s5
      t414 = 0.1362107888567592D0*t46*t35*t106*t38
      t416 = 0.3178251739991049D0*t40*t99
      t427 = t40*t118
      v2rhoasigmaaa(i) = 0.2258606682377246D-1*t68
     &-0.644319647532407D-3/t127*t173*sigma+0.1243627634786196D0*t160
     &*t137+4.D0*rho*(0.310906908696549D-1*(-0.3178251739991049D0*t99
     &*t44*t55-0.4329121766895483D-1*sigma*t129*t149
     &+0.3178251739991049D0*t100*t157+0.1362107888567592D0*t35*t113
     &*t55+0.1362107888567592D0*t36*(-t414-t416)*t55
     &-0.1362107888567592D0*t36*t326*t156-0.1362107888567592D0*t145
     &*t118*t132-0.1855337900098064D-1*t148*t427*t132
     &+0.2724215777135184D0*t36*t44*t331*t132*t156
     &-0.1362107888567592D0*t36*t119*(-t414-t416-0.7421351600392257D-1
     &*t295*t124-0.1731648706758193D0*t103*t129))*t137
     &-0.310906908696549D-1*t136*t287*t160)
      t464 = t156**2
      t478 = t160**2
      v2sigmaaa2(i) = 0.9664794712986105D-3*t243*t173
     &+0.4974510539144783D0*rho*(0.3710675800196129D-1*t51*t40*t55
     &-0.2724215777135184D0*t145*t118*t156-0.3710675800196129D-1*t148
     &*t427*t156+0.2724215777135184D0*t36*t332*t464
     &-0.5054340779364009D-2*sigma/t49/t97*t119*t46)*t137
     &-0.4974510539144783D0*rho*t478*t287
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_PBEsubrend
