c:XC_HCTH147subrstart

c    Generated: Sat May  8 19:27:08 GMT 2004

      subroutine uks_xc_hcth147
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     A.D. Boese, N.L. Doltsinis, N.C. Handy, M. Sprik
c     New generalized gradient approximation functionals
c     J. Chem. Phys. 112 (2000) 1670-1678.
c
c
c     CITATION:
c
c     Functionals were obtained from the Density Functional Repository 
c     as developed and distributed by the Quantum Chemistry Group, 
c     CCLRC Daresbury Laboratory, Daresbury, Cheshire, WA4 4AD 
c     United Kingdom. Contact Huub van Dam (h.j.j.vandam@dl.ac.uk) or 
c     Paul Sherwood for further information.
c
c     COPYRIGHT:
c
c     Users may incorporate the source code into software packages and
c     redistribute the source code provided the source code is not
c     changed in anyway and is properly cited in any documentation or
c     publication related to its use.
c
c     ACKNOWLEDGEMENT:
c
c     The source code was generated using Maple 8 through a modified
c     version of the dfauto script published in:
c
c        R. Strange, F.R. Manby, P.J. Knowles
c        Automatic code generation in density functional theory
c        Comp. Phys. Comm. 136 (2001) 310-318.
c
      implicit real*8 (a-h,o-z)
      integer ideriv,npt
      real*8 rhoa1(npt),rhob1(npt)
      real*8 sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      real*8 zk(npt),vrhoa(npt),vrhob(npt)
      real*8 vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      real*8 v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      real*8 v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      real*8 v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      real*8 v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      real*8 v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      real*8 v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t8 = sigmabb/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmabb**2
      t15 = t4**2
      t19 = t14/t2/t15/rhob
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigmabb/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t49
     &+0.3844746237447211D1*t45+0.1644733775567609D1*t52
     &+0.2405871291288192D0*t54))
      t62 = 1.D0+0.2D0*t8
      t66 = t62**2
      t74 = t66**2
      zk(i) = -0.9305257363491D0*t2*rhob*(0.109025D1-0.3196776D-2*t8
     &/t10+0.8915392D-4*t19/t20-0.3755264D-6*t27/t20/t10+0.77963264D-9
     &*t36/t37)-0.3109D-1*rhob*(1.D0+0.1274696188700087D0*t45)*t60*
     &(0.562576D0+0.342872D-2*t8/t62-0.522544D-1*t19/t66+0.845976D-2
     &*t27/t66/t62+0.14166864D-2*t36/t74)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t8 = sigmaaa/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmaaa**2
      t15 = t4**2
      t19 = t14/t2/t15/rhoa
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigmaaa/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t49
     &+0.3844746237447211D1*t45+0.1644733775567609D1*t52
     &+0.2405871291288192D0*t54))
      t62 = 1.D0+0.2D0*t8
      t66 = t62**2
      t74 = t66**2
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.109025D1-0.3196776D-2*t8
     &/t10+0.8915392D-4*t19/t20-0.3755264D-6*t27/t20/t10+0.77963264D-9
     &*t36/t37)-0.3109D-1*rhoa*(1.D0+0.1274696188700087D0*t45)*t60*
     &(0.562576D0+0.342872D-2*t8/t62-0.522544D-1*t19/t66+0.845976D-2
     &*t27/t66/t62+0.14166864D-2*t36/t74)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t10 = sigmaaa/t7/t6
      t12 = 1.D0+0.4D-2*t10
      t16 = sigmaaa**2
      t17 = t6**2
      t21 = t16/t4/t17/rhoa
      t22 = t12**2
      t27 = t17**2
      t29 = t16*sigmaaa/t27
      t34 = t16**2
      t38 = t34/t7/t27/t6
      t39 = t22**2
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t50 = rhoa*(1.D0+0.1274696188700087D0*t47)
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t62 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t51
     &+0.3844746237447211D1*t47+0.1644733775567609D1*t54
     &+0.2405871291288192D0*t56))
      t64 = 1.D0+0.2D0*t10
      t68 = t64**2
      t76 = t68**2
      t84 = rhob**(1.D0/3.D0)
      t86 = rhob**2
      t87 = t84**2
      t90 = sigmabb/t87/t86
      t92 = 1.D0+0.4D-2*t90
      t96 = sigmabb**2
      t97 = t86**2
      t101 = t96/t84/t97/rhob
      t102 = t92**2
      t107 = t97**2
      t109 = t96*sigmabb/t107
      t114 = t96**2
      t118 = t114/t87/t107/t86
      t119 = t102**2
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t130 = rhob*(1.D0+0.1274696188700087D0*t127)
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t142 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t131
     &+0.3844746237447211D1*t127+0.1644733775567609D1*t134
     &+0.2405871291288192D0*t136))
      t144 = 1.D0+0.2D0*t90
      t148 = t144**2
      t156 = t148**2
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t180 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t169
     &+0.2225569421150687D1*t166+0.8004286349993634D0*t172
     &+0.1897004325747559D0*t174))
      t182 = 0.62182D-1*(1.D0+0.1325688999052018D0*t166)*t180
      t193 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t169
     &+0.2247591863577616D1*t166+0.4300972471276643D0*t172
     &+0.1911512595127338D0*t174))
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t211 = t207/t209
      t227 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t169
     &+0.3844746237447211D1*t166+0.1644733775567609D1*t172
     &+0.2405871291288192D0*t174))
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t250 = t243**2
      t251 = t246**2
      t260 = t250**2
      t261 = t251**2
      s1 = -0.9305257363491D0*t4*rhoa*(0.109025D1-0.3196776D-2*t10/t12
     &+0.8915392D-4*t21/t22-0.3755264D-6*t29/t22/t12+0.77963264D-9*t38
     &/t39)-0.3109D-1*t50*t62*(0.562576D0+0.342872D-2*t10/t64
     &-0.522544D-1*t21/t68+0.845976D-2*t29/t68/t64+0.14166864D-2*t38
     &/t76)
      s2 = s1-0.9305257363491D0*t84*rhob*(0.109025D1-0.3196776D-2*t90
     &/t92+0.8915392D-4*t101/t102-0.3755264D-6*t109/t102/t92
     &+0.77963264D-9*t118/t119)
      zk(i) = s2-0.3109D-1*t130*t142*(0.562576D0+0.342872D-2*t90/t144
     &-0.522544D-1*t101/t148+0.845976D-2*t109/t148/t144+0.14166864D-2
     &*t118/t156)+(t164*(-t182+0.3799574853701528D-1*(1.D0
     &+0.6901399211255825D-1*t166)*t193*t205*(1.D0-1.D0*t211)
     &+0.1923661050931536D1*(-0.3109D-1*(1.D0+0.1274696188700087D0
     &*t166)*t227+t182)*t205*t211)+0.3109D-1*t50*t62+0.3109D-1*t130
     &*t142)*(0.542352D0+0.4208784D-1*t243/t246-0.10217592D-2*t250
     &/t251+0.75671064D-5*t250*t243/t251/t246-0.264752064D-7*t260/t261)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t16 = t15*rhob
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmabb
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109025D1-0.3196776D-2*t8*t11+0.8915392D-4*t19*t21
     &-0.3755264D-6*t27*t29+0.77963264D-9*t36*t38
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhob*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     &+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.562576D0+0.342872D-2*t8*t63-0.522544D-1*t19*t67
     &+0.845976D-2*t27*t71+0.14166864D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      vrhoa(i) = 0.D0
      t84 = t4*rhob
      t87 = sigmabb/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhob
      t104 = t32/t5/t25/t84
      t111 = t32*sigmabb/t2/t25/t90
      t113 = 1/t37/t10
      t122 = 1/t54
      t126 = t56**2
      t129 = t49**2
      t130 = t129**2
      t133 = 1/t4
      t159 = 1/t74/t62
      vrhob(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*
     &(0.8524736D-2*t87*t11-0.5095865173333333D-3*t93*t21
     &+0.4906161493333333D-5*t98*t29-0.2033292629333333D-7*t104*t38
     &+0.3326432597333333D-10*t111*t113)-0.3109D-1*t47*t60*t78
     &+0.1321010150222857D-2*t44*t122*t79+0.1D1*t48/t126*(
     &-0.1853395810515781D1/t130/t49*t133-0.128158207914907D1*t122
     &*t133-0.8223668877838045D0/t52*t133-0.1603914194192128D0/t45
     &*t133)/t59*t78-0.3109D-1*t48*t60*(-0.9143253333333333D-2*t87*t63
     &+0.280518784D0*t93*t67-0.1234161066666667D0*t98*t71
     &-0.15757056D-2*t104*t75+0.302226432D-2*t111*t159)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t168 = sigmabb*t18
      t171 = t14*t26
      t174 = t24*t35
      t180 = t32/t2/t25/t16
      vsigmabb(i) = -0.9305257363491D0*t3*(-0.3196776D-2*t7*t11
     &+0.191094944D-3*t168*t21-0.183981056D-5*t171*t29+0.762484736D-8
     &*t174*t38-0.1247412224D-10*t180*t113)-0.3109D-1*t48*t60*
     &(0.342872D-2*t7*t63-0.105194544D0*t168*t67+0.4628104D-1*t171*t71
     &+0.5908896D-3*t174*t75-0.113334912D-2*t180*t159)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t16 = t15*rhoa
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmaaa
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109025D1-0.3196776D-2*t8*t11+0.8915392D-4*t19*t21
     &-0.3755264D-6*t27*t29+0.77963264D-9*t36*t38
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhoa*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     &+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.562576D0+0.342872D-2*t8*t63-0.522544D-1*t19*t67
     &+0.845976D-2*t27*t71+0.14166864D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      t84 = t4*rhoa
      t87 = sigmaaa/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhoa
      t104 = t32/t5/t25/t84
      t111 = t32*sigmaaa/t2/t25/t90
      t113 = 1/t37/t10
      t122 = 1/t54
      t126 = t56**2
      t129 = t49**2
      t130 = t129**2
      t133 = 1/t4
      t159 = 1/t74/t62
      vrhoa(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*
     &(0.8524736D-2*t87*t11-0.5095865173333333D-3*t93*t21
     &+0.4906161493333333D-5*t98*t29-0.2033292629333333D-7*t104*t38
     &+0.3326432597333333D-10*t111*t113)-0.3109D-1*t47*t60*t78
     &+0.1321010150222857D-2*t44*t122*t79+0.1D1*t48/t126*(
     &-0.1853395810515781D1/t130/t49*t133-0.128158207914907D1*t122
     &*t133-0.8223668877838045D0/t52*t133-0.1603914194192128D0/t45
     &*t133)/t59*t78-0.3109D-1*t48*t60*(-0.9143253333333333D-2*t87*t63
     &+0.280518784D0*t93*t67-0.1234161066666667D0*t98*t71
     &-0.15757056D-2*t104*t75+0.302226432D-2*t111*t159)
      vrhob(i) = 0.D0
      t168 = sigmaaa*t18
      t171 = t14*t26
      t174 = t24*t35
      t180 = t32/t2/t25/t16
      vsigmaaa(i) = -0.9305257363491D0*t3*(-0.3196776D-2*t7*t11
     &+0.191094944D-3*t168*t21-0.183981056D-5*t171*t29+0.762484736D-8
     &*t174*t38-0.1247412224D-10*t180*t113)-0.3109D-1*t48*t60*
     &(0.342872D-2*t7*t63-0.105194544D0*t168*t67+0.4628104D-1*t171*t71
     &+0.5908896D-3*t174*t75-0.113334912D-2*t180*t159)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t18 = t17*rhoa
      t20 = 1/t4/t18
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = t16*sigmaaa
      t27 = t17**2
      t28 = 1/t27
      t29 = t26*t28
      t31 = 1/t22/t12
      t34 = t16**2
      t37 = 1/t7/t27/t6
      t38 = t34*t37
      t39 = t22**2
      t40 = 1/t39
      t43 = 0.109025D1-0.3196776D-2*t10*t13+0.8915392D-4*t21*t23
     &-0.3755264D-6*t29*t31+0.77963264D-9*t38*t40
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t49 = 1.D0+0.1274696188700087D0*t47
      t50 = rhoa*t49
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t58 = 0.1112037486309468D2*t51+0.3844746237447211D1*t47
     &+0.1644733775567609D1*t54+0.2405871291288192D0*t56
      t61 = 1.D0+0.321646831778707D2/t58
      t62 = dlog(t61)
      t64 = 1.D0+0.2D0*t10
      t65 = 1/t64
      t68 = t64**2
      t69 = 1/t68
      t73 = 1/t68/t64
      t76 = t68**2
      t77 = 1/t76
      t80 = 0.562576D0+0.342872D-2*t10*t65-0.522544D-1*t21*t69
     &+0.845976D-2*t29*t73+0.14166864D-2*t38*t77
      t81 = t62*t80
      t84 = rhob**(1.D0/3.D0)
      t85 = t84*rhob
      t86 = rhob**2
      t87 = t84**2
      t89 = 1/t87/t86
      t90 = sigmabb*t89
      t92 = 1.D0+0.4D-2*t90
      t93 = 1/t92
      t96 = sigmabb**2
      t97 = t86**2
      t98 = t97*rhob
      t100 = 1/t84/t98
      t101 = t96*t100
      t102 = t92**2
      t103 = 1/t102
      t106 = t96*sigmabb
      t107 = t97**2
      t108 = 1/t107
      t109 = t106*t108
      t111 = 1/t102/t92
      t114 = t96**2
      t117 = 1/t87/t107/t86
      t118 = t114*t117
      t119 = t102**2
      t120 = 1/t119
      t123 = 0.109025D1-0.3196776D-2*t90*t93+0.8915392D-4*t101*t103
     &-0.3755264D-6*t109*t111+0.77963264D-9*t118*t120
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t129 = 1.D0+0.1274696188700087D0*t127
      t130 = rhob*t129
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t138 = 0.1112037486309468D2*t131+0.3844746237447211D1*t127
     &+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t141 = 1.D0+0.321646831778707D2/t138
      t142 = dlog(t141)
      t144 = 1.D0+0.2D0*t90
      t145 = 1/t144
      t148 = t144**2
      t149 = 1/t148
      t153 = 1/t148/t144
      t156 = t148**2
      t157 = 1/t156
      t160 = 0.562576D0+0.342872D-2*t90*t145-0.522544D-1*t101*t149
     &+0.845976D-2*t109*t153+0.14166864D-2*t118*t157
      t161 = t142*t160
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t168 = 1.D0+0.1325688999052018D0*t166
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t176 = 0.598255043577108D1*t169+0.2225569421150687D1*t166
     &+0.8004286349993634D0*t172+0.1897004325747559D0*t174
      t179 = 1.D0+0.160818243221511D2/t176
      t180 = dlog(t179)
      t182 = 0.62182D-1*t168*t180
      t184 = 1.D0+0.6901399211255825D-1*t166
      t189 = 0.8157414703487641D1*t169+0.2247591863577616D1*t166
     &+0.4300972471276643D0*t172+0.1911512595127338D0*t174
      t192 = 1.D0+0.2960857464321668D2/t189
      t193 = dlog(t192)
      t194 = t184*t193
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t210 = 1/t209
      t211 = t207*t210
      t213 = 1.D0-1.D0*t211
      t216 = 0.3799574853701528D-1*t194*t205*t213
      t218 = 1.D0+0.1274696188700087D0*t166
      t223 = 0.1112037486309468D2*t169+0.3844746237447211D1*t166
     &+0.1644733775567609D1*t172+0.2405871291288192D0*t174
      t226 = 1.D0+0.321646831778707D2/t223
      t227 = dlog(t226)
      t230 = -0.3109D-1*t218*t227+t182
      t231 = t230*t205
      t233 = 0.1923661050931536D1*t231*t211
      t240 = t164*(-t182+t216+t233)+0.3109D-1*t50*t62+0.3109D-1*t130
     &*t142
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t247 = 1/t246
      t250 = t243**2
      t251 = t246**2
      t252 = 1/t251
      t255 = t250*t243
      t257 = 1/t251/t246
      t260 = t250**2
      t261 = t251**2
      t262 = 1/t261
      t265 = 0.542352D0+0.4208784D-1*t243*t247-0.10217592D-2*t250*t252
     &+0.75671064D-5*t255*t257-0.264752064D-7*t260*t262
      zk(i) = -0.9305257363491D0*t5*t43-0.3109D-1*t50*t81
     &-0.9305257363491D0*t85*t123-0.3109D-1*t130*t161+t240*t265
      t269 = t6*rhoa
      t272 = sigmaaa/t7/t269
      t275 = t17*t6
      t278 = t16/t4/t275
      t283 = t26/t27/rhoa
      t289 = t34/t7/t27/t269
      t296 = t34*sigmaaa/t4/t27/t275
      t298 = 1/t39/t12
      t304 = t49*t62
      t307 = 1/t56
      t308 = t46*t307
      t311 = t58**2
      t312 = 1/t311
      t314 = t51**2
      t315 = t314**2
      t318 = 1/t6
      t329 = -0.1853395810515781D1/t315/t51*t318-0.128158207914907D1
     &*t307*t318-0.8223668877838045D0/t54*t318-0.1603914194192128D0
     &/t47*t318
      t330 = 1/t61
      t344 = 1/t76/t64
      t352 = 1/t208
      t353 = 1/t174*t352
      t354 = t353*t180
      t355 = 0.2747799777968419D-2*t354
      t356 = t176**2
      t359 = t169**2
      t360 = t359**2
      t363 = 1/t360/t169*t352
      t367 = 1/t172*t352
      t370 = 1/t166*t352
      t375 = t168/t356*(-0.99709173929518D0*t363-0.7418564737168958D0
     &*t353-0.4002143174996817D0*t367-0.1264669550498372D0*t370)/t179
      t376 = 0.1D1*t375
      t380 = 0.8740794299481065D-3*t353*t193*t205*t213
      t381 = t189**2
      t394 = 0.1124999956683108D1*t184/t381*(-0.135956911724794D1*t363
     &-0.7491972878592054D0*t353-0.2150486235638321D0*t367
     &-0.1274341730084892D0*t370)/t192*t205*t213
      t395 = t196*t352
      t396 = 1.D0*t395
      t400 = 1.D0*t165
      t404 = 0.1333333333333333D1*t199*(t165-t396)
     &+0.1333333333333333D1*t203*(-t400+t395)
      t409 = t206*t196*t210
      t410 = 4.D0*t409
      t413 = t207/t209/t164
      t414 = 4.D0*t413
      t421 = t223**2
      t438 = 0.1923661050931536D1*(0.1321010150222857D-2*t353*t227
     &+0.1D1*t218/t421*(-0.1853395810515781D1*t363-0.128158207914907D1
     &*t353-0.8223668877838045D0*t367-0.1603914194192128D0*t370)/t226
     &-0.2747799777968419D-2*t354-0.1D1*t375)*t205*t211
      t442 = t231*t409
      t445 = 0.7694644203726145D1*t231*t413
      t459 = t243*t252
      t462 = t250*t257
      t465 = t255*t262
      t470 = t260/t261/t246
      s1 = -0.12407009817988D1*t4*t43-0.9305257363491D0*t5*
     &(0.8524736D-2*t272*t13-0.5095865173333333D-3*t278*t23
     &+0.4906161493333333D-5*t283*t31-0.2033292629333333D-7*t289*t40
     &+0.3326432597333333D-10*t296*t298)-0.3109D-1*t304*t80
     &+0.1321010150222857D-2*t308*t81
      vrhoa(i) = s1+0.1D1*t50*t312*t329*t330*t80-0.3109D-1*t50*t62*(
     &-0.9143253333333333D-2*t272*t65+0.280518784D0*t278*t69
     &-0.1234161066666667D0*t283*t73-0.15757056D-2*t289*t77
     &+0.302226432D-2*t296*t344)+(-t182+t216+t233+t164*(t355+t376-t380
     &-t394+0.3799574853701528D-1*t194*t404*t213+0.3799574853701528D-1
     &*t194*t205*(-t410+t414)+t438+0.1923661050931536D1*t230*t404*t211
     &+0.7694644203726145D1*t442-t445)+0.3109D-1*t304
     &-0.1321010150222857D-2*t308*t62-0.1D1*t50*t312*t329*t330)*t265
     &+t240*(-0.5611712D-1*t272*t247+0.306139392D-2*t459*t272
     &-0.466165728D-4*t462*t272+0.3228116544D-6*t465*t272
     &-0.8472066048D-9*t470*t272)
      t477 = t86*rhob
      t480 = sigmabb/t87/t477
      t483 = t97*t86
      t486 = t96/t84/t483
      t491 = t106/t107/rhob
      t497 = t114/t87/t107/t477
      t504 = t114*sigmabb/t84/t107/t483
      t506 = 1/t119/t92
      t512 = t129*t142
      t515 = 1/t136
      t516 = t126*t515
      t519 = t138**2
      t520 = 1/t519
      t522 = t131**2
      t523 = t522**2
      t526 = 1/t86
      t537 = -0.1853395810515781D1/t523/t131*t526-0.128158207914907D1
     &*t515*t526-0.8223668877838045D0/t134*t526-0.1603914194192128D0
     &/t127*t526
      t538 = 1/t141
      t552 = 1/t156/t144
      t565 = 0.1333333333333333D1*t199*(-t400-t396)
     &+0.1333333333333333D1*t203*(t165+t395)
      s1 = -0.12407009817988D1*t84*t123-0.9305257363491D0*t85*
     &(0.8524736D-2*t480*t93-0.5095865173333333D-3*t486*t103
     &+0.4906161493333333D-5*t491*t111-0.2033292629333333D-7*t497*t120
     &+0.3326432597333333D-10*t504*t506)-0.3109D-1*t512*t160
     &+0.1321010150222857D-2*t516*t161
      vrhob(i) = s1+0.1D1*t130*t520*t537*t538*t160-0.3109D-1*t130*t142
     &*(-0.9143253333333333D-2*t480*t145+0.280518784D0*t486*t149
     &-0.1234161066666667D0*t491*t153-0.15757056D-2*t497*t157
     &+0.302226432D-2*t504*t552)+(-t182+t216+t233+t164*(t355+t376-t380
     &-t394+0.3799574853701528D-1*t194*t565*t213+0.3799574853701528D-1
     &*t194*t205*(t410+t414)+t438+0.1923661050931536D1*t230*t565*t211
     &-0.7694644203726145D1*t442-t445)+0.3109D-1*t512
     &-0.1321010150222857D-2*t516*t142-0.1D1*t130*t520*t537*t538)*t265
     &+t240*(-0.5611712D-1*t480*t247+0.306139392D-2*t459*t480
     &-0.466165728D-4*t462*t480+0.3228116544D-6*t465*t480
     &-0.8472066048D-9*t470*t480)
      t602 = sigmaaa*t20
      t605 = t16*t28
      t608 = t26*t37
      t614 = t34/t4/t27/t18
      vsigmaaa(i) = -0.9305257363491D0*t5*(-0.3196776D-2*t9*t13
     &+0.191094944D-3*t602*t23-0.183981056D-5*t605*t31+0.762484736D-8
     &*t608*t40-0.1247412224D-10*t614*t298)-0.3109D-1*t50*t62*
     &(0.342872D-2*t9*t65-0.105194544D0*t602*t69+0.4628104D-1*t605*t73
     &+0.5908896D-3*t608*t77-0.113334912D-2*t614*t344)+t240*
     &(0.2104392D-1*t9*t247-0.114802272D-2*t459*t9+0.174812148D-4*t462
     &*t9-0.1210543704D-6*t465*t9+0.3177024768D-9*t470*t9)
      vsigmaab(i) = 0.D0
      t648 = sigmabb*t100
      t651 = t96*t108
      t654 = t106*t117
      t660 = t114/t84/t107/t98
      vsigmabb(i) = -0.9305257363491D0*t85*(-0.3196776D-2*t89*t93
     &+0.191094944D-3*t648*t103-0.183981056D-5*t651*t111
     &+0.762484736D-8*t654*t120-0.1247412224D-10*t660*t506)-0.3109D-1
     &*t130*t142*(0.342872D-2*t89*t145-0.105194544D0*t648*t149
     &+0.4628104D-1*t651*t153+0.5908896D-3*t654*t157-0.113334912D-2
     &*t660*t552)+t240*(0.2104392D-1*t89*t247-0.114802272D-2*t459*t89
     &+0.174812148D-4*t462*t89-0.1210543704D-6*t465*t89
     &+0.3177024768D-9*t470*t89)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t16 = t15*rhob
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmabb
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109025D1-0.3196776D-2*t8*t11+0.8915392D-4*t19*t21
     &-0.3755264D-6*t27*t29+0.77963264D-9*t36*t38
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhob*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     &+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.562576D0+0.342872D-2*t8*t63-0.522544D-1*t19*t67
     &+0.845976D-2*t27*t71+0.14166864D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      vrhoa(i) = 0.D0
      t84 = t4*rhob
      t87 = sigmabb/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhob
      t104 = t32/t5/t25/t84
      t107 = t32*sigmabb
      t111 = t107/t2/t25/t90
      t113 = 1/t37/t10
      t116 = 0.8524736D-2*t87*t11-0.5095865173333333D-3*t93*t21
     &+0.4906161493333333D-5*t98*t29-0.2033292629333333D-7*t104*t38
     &+0.3326432597333333D-10*t111*t113
      t119 = t47*t60
      t122 = 1/t54
      t123 = t44*t122
      t126 = t56**2
      t127 = 1/t126
      t128 = t48*t127
      t129 = t49**2
      t130 = t129**2
      t131 = t130*t49
      t132 = 1/t131
      t133 = 1/t4
      t138 = 1/t52
      t141 = 1/t45
      t144 = -0.1853395810515781D1*t132*t133-0.128158207914907D1*t122
     &*t133-0.8223668877838045D0*t138*t133-0.1603914194192128D0*t141
     &*t133
      t145 = 1/t59
      t146 = t144*t145
      t147 = t146*t78
      t159 = 1/t74/t62
      t162 = -0.9143253333333333D-2*t87*t63+0.280518784D0*t93*t67
     &-0.1234161066666667D0*t98*t71-0.15757056D-2*t104*t75
     &+0.302226432D-2*t111*t159
      t163 = t60*t162
      vrhob(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*t116
     &-0.3109D-1*t119*t78+0.1321010150222857D-2*t123*t79+0.1D1*t128
     &*t147-0.3109D-1*t48*t163
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t168 = sigmabb*t18
      t171 = t14*t26
      t174 = t24*t35
      t179 = 1/t2/t25/t16
      t180 = t32*t179
      vsigmabb(i) = -0.9305257363491D0*t3*(-0.3196776D-2*t7*t11
     &+0.191094944D-3*t168*t21-0.183981056D-5*t171*t29+0.762484736D-8
     &*t174*t38-0.1247412224D-10*t180*t113)-0.3109D-1*t48*t60*
     &(0.342872D-2*t7*t63-0.105194544D0*t168*t67+0.4628104D-1*t171*t71
     &+0.5908896D-3*t174*t75-0.113334912D-2*t180*t159)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t207 = sigmabb/t5/t15
      t210 = t15*t84
      t213 = t14/t2/t210
      t217 = t24/t33
      t223 = t32/t5/t25/t15
      t229 = t107/t2/t25/t210
      t233 = t25**2
      t236 = t32*t14/t233/t4
      t238 = 1/t37/t20
      t249 = 1/t84
      t251 = 1/t54/t44
      t263 = t144**2
      t270 = 1/t15
      t296 = t126**2
      t299 = t59**2
      t319 = 1/t74/t66
      s1 = -0.4135669939329333D0/t5*t41-0.24814019635976D1*t2*t116
     &-0.9305257363491D0*t3*(-0.3125736533333333D-1*t207*t11
     &+0.3318311793777778D-2*t213*t21-0.5502663247644444D-4*t217*t29
     &+0.3942146412088889D-6*t223*t38-0.13443268608D-8*t229*t113
     &+0.1774097385244444D-11*t236*t238)+0.2D1*t47*t127*t147-0.6218D-1
     &*t119*t162+0.8806734334819047D-3*t249*t251*t79
      v2rhob2(i) = s1-0.8497974591333914D-1*t123*t127*t147
     &+0.2642020300445714D-2*t123*t163-0.2D1*t48/t126/t56*t263*t145
     &*t78+0.1D1*t128*(-0.1544496508763151D1/t131/t44*t270
     &+0.3706791621031562D1*t132*t249-0.854388052766047D0*t251*t270
     &+0.2563164158298141D1*t122*t249-0.4111834438919023D0/t52/t44
     &*t270+0.1644733775567609D1*t138*t249-0.5346380647307093D-1/t45
     &/t44*t270+0.3207828388384256D0*t141*t249)*t145*t78
     &+0.321646831778707D2*t48/t296*t263/t299*t78+0.2D1*t128*t146*t162
     &-0.3109D-1*t48*t60*(0.3352526222222222D-1*t207*t63
     &-0.1781495367111111D1*t213*t67+0.1409964996266667D1*t217*t71
     &-0.1790825386666667D0*t223*t75-0.466806272D-1*t229*t159
     &+0.805937152D-2*t236*t319)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t328 = sigmabb*t26
      t331 = t14*t35
      t334 = t24*t179
      t338 = t32/t233
      v2sigmabb2(i) = -0.9305257363491D0*t3*(0.203882048D-3*t18*t21
     &-0.5208380672D-5*t328*t29+0.449522688D-7*t331*t38
     &-0.17189404672D-9*t334*t113+0.2494824448D-12*t338*t238)
     &-0.3109D-1*t48*t60*(-0.105880288D0*t18*t67+0.1346398976D0*t328
     &*t71-0.259959552D-1*t331*t75-0.500610816D-2*t334*t159
     &+0.113334912D-2*t338*t319)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t16 = t15*rhoa
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmaaa
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109025D1-0.3196776D-2*t8*t11+0.8915392D-4*t19*t21
     &-0.3755264D-6*t27*t29+0.77963264D-9*t36*t38
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhoa*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     &+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.562576D0+0.342872D-2*t8*t63-0.522544D-1*t19*t67
     &+0.845976D-2*t27*t71+0.14166864D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      t84 = t4*rhoa
      t87 = sigmaaa/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhoa
      t104 = t32/t5/t25/t84
      t107 = t32*sigmaaa
      t111 = t107/t2/t25/t90
      t113 = 1/t37/t10
      t116 = 0.8524736D-2*t87*t11-0.5095865173333333D-3*t93*t21
     &+0.4906161493333333D-5*t98*t29-0.2033292629333333D-7*t104*t38
     &+0.3326432597333333D-10*t111*t113
      t119 = t47*t60
      t122 = 1/t54
      t123 = t44*t122
      t126 = t56**2
      t127 = 1/t126
      t128 = t48*t127
      t129 = t49**2
      t130 = t129**2
      t131 = t130*t49
      t132 = 1/t131
      t133 = 1/t4
      t138 = 1/t52
      t141 = 1/t45
      t144 = -0.1853395810515781D1*t132*t133-0.128158207914907D1*t122
     &*t133-0.8223668877838045D0*t138*t133-0.1603914194192128D0*t141
     &*t133
      t145 = 1/t59
      t146 = t144*t145
      t147 = t146*t78
      t159 = 1/t74/t62
      t162 = -0.9143253333333333D-2*t87*t63+0.280518784D0*t93*t67
     &-0.1234161066666667D0*t98*t71-0.15757056D-2*t104*t75
     &+0.302226432D-2*t111*t159
      t163 = t60*t162
      vrhoa(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*t116
     &-0.3109D-1*t119*t78+0.1321010150222857D-2*t123*t79+0.1D1*t128
     &*t147-0.3109D-1*t48*t163
      vrhob(i) = 0.D0
      t168 = sigmaaa*t18
      t171 = t14*t26
      t174 = t24*t35
      t179 = 1/t2/t25/t16
      t180 = t32*t179
      vsigmaaa(i) = -0.9305257363491D0*t3*(-0.3196776D-2*t7*t11
     &+0.191094944D-3*t168*t21-0.183981056D-5*t171*t29+0.762484736D-8
     &*t174*t38-0.1247412224D-10*t180*t113)-0.3109D-1*t48*t60*
     &(0.342872D-2*t7*t63-0.105194544D0*t168*t67+0.4628104D-1*t171*t71
     &+0.5908896D-3*t174*t75-0.113334912D-2*t180*t159)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t207 = sigmaaa/t5/t15
      t210 = t15*t84
      t213 = t14/t2/t210
      t217 = t24/t33
      t223 = t32/t5/t25/t15
      t229 = t107/t2/t25/t210
      t233 = t25**2
      t236 = t32*t14/t233/t4
      t238 = 1/t37/t20
      t249 = 1/t84
      t251 = 1/t54/t44
      t263 = t144**2
      t270 = 1/t15
      t296 = t126**2
      t299 = t59**2
      t319 = 1/t74/t66
      s1 = -0.4135669939329333D0/t5*t41-0.24814019635976D1*t2*t116
     &-0.9305257363491D0*t3*(-0.3125736533333333D-1*t207*t11
     &+0.3318311793777778D-2*t213*t21-0.5502663247644444D-4*t217*t29
     &+0.3942146412088889D-6*t223*t38-0.13443268608D-8*t229*t113
     &+0.1774097385244444D-11*t236*t238)+0.2D1*t47*t127*t147-0.6218D-1
     &*t119*t162+0.8806734334819047D-3*t249*t251*t79
      v2rhoa2(i) = s1-0.8497974591333914D-1*t123*t127*t147
     &+0.2642020300445714D-2*t123*t163-0.2D1*t48/t126/t56*t263*t145
     &*t78+0.1D1*t128*(-0.1544496508763151D1/t131/t44*t270
     &+0.3706791621031562D1*t132*t249-0.854388052766047D0*t251*t270
     &+0.2563164158298141D1*t122*t249-0.4111834438919023D0/t52/t44
     &*t270+0.1644733775567609D1*t138*t249-0.5346380647307093D-1/t45
     &/t44*t270+0.3207828388384256D0*t141*t249)*t145*t78
     &+0.321646831778707D2*t48/t296*t263/t299*t78+0.2D1*t128*t146*t162
     &-0.3109D-1*t48*t60*(0.3352526222222222D-1*t207*t63
     &-0.1781495367111111D1*t213*t67+0.1409964996266667D1*t217*t71
     &-0.1790825386666667D0*t223*t75-0.466806272D-1*t229*t159
     &+0.805937152D-2*t236*t319)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t328 = sigmaaa*t26
      t331 = t14*t35
      t334 = t24*t179
      t338 = t32/t233
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(0.203882048D-3*t18*t21
     &-0.5208380672D-5*t328*t29+0.449522688D-7*t331*t38
     &-0.17189404672D-9*t334*t113+0.2494824448D-12*t338*t238)
     &-0.3109D-1*t48*t60*(-0.105880288D0*t18*t67+0.1346398976D0*t328
     &*t71-0.259959552D-1*t331*t75-0.500610816D-2*t334*t159
     &+0.113334912D-2*t338*t319)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t18 = t17*rhoa
      t20 = 1/t4/t18
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = t16*sigmaaa
      t27 = t17**2
      t28 = 1/t27
      t29 = t26*t28
      t31 = 1/t22/t12
      t34 = t16**2
      t35 = t27*t6
      t37 = 1/t7/t35
      t38 = t34*t37
      t39 = t22**2
      t40 = 1/t39
      t43 = 0.109025D1-0.3196776D-2*t10*t13+0.8915392D-4*t21*t23
     &-0.3755264D-6*t29*t31+0.77963264D-9*t38*t40
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t49 = 1.D0+0.1274696188700087D0*t47
      t50 = rhoa*t49
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t58 = 0.1112037486309468D2*t51+0.3844746237447211D1*t47
     &+0.1644733775567609D1*t54+0.2405871291288192D0*t56
      t61 = 1.D0+0.321646831778707D2/t58
      t62 = dlog(t61)
      t64 = 1.D0+0.2D0*t10
      t65 = 1/t64
      t68 = t64**2
      t69 = 1/t68
      t73 = 1/t68/t64
      t76 = t68**2
      t77 = 1/t76
      t80 = 0.562576D0+0.342872D-2*t10*t65-0.522544D-1*t21*t69
     &+0.845976D-2*t29*t73+0.14166864D-2*t38*t77
      t81 = t62*t80
      t84 = rhob**(1.D0/3.D0)
      t85 = t84*rhob
      t86 = rhob**2
      t87 = t84**2
      t89 = 1/t87/t86
      t90 = sigmabb*t89
      t92 = 1.D0+0.4D-2*t90
      t93 = 1/t92
      t96 = sigmabb**2
      t97 = t86**2
      t98 = t97*rhob
      t100 = 1/t84/t98
      t101 = t96*t100
      t102 = t92**2
      t103 = 1/t102
      t106 = t96*sigmabb
      t107 = t97**2
      t108 = 1/t107
      t109 = t106*t108
      t111 = 1/t102/t92
      t114 = t96**2
      t115 = t107*t86
      t117 = 1/t87/t115
      t118 = t114*t117
      t119 = t102**2
      t120 = 1/t119
      t123 = 0.109025D1-0.3196776D-2*t90*t93+0.8915392D-4*t101*t103
     &-0.3755264D-6*t109*t111+0.77963264D-9*t118*t120
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t129 = 1.D0+0.1274696188700087D0*t127
      t130 = rhob*t129
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t138 = 0.1112037486309468D2*t131+0.3844746237447211D1*t127
     &+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t141 = 1.D0+0.321646831778707D2/t138
      t142 = dlog(t141)
      t144 = 1.D0+0.2D0*t90
      t145 = 1/t144
      t148 = t144**2
      t149 = 1/t148
      t153 = 1/t148/t144
      t156 = t148**2
      t157 = 1/t156
      t160 = 0.562576D0+0.342872D-2*t90*t145-0.522544D-1*t101*t149
     &+0.845976D-2*t109*t153+0.14166864D-2*t118*t157
      t161 = t142*t160
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t168 = 1.D0+0.1325688999052018D0*t166
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t176 = 0.598255043577108D1*t169+0.2225569421150687D1*t166
     &+0.8004286349993634D0*t172+0.1897004325747559D0*t174
      t179 = 1.D0+0.160818243221511D2/t176
      t180 = dlog(t179)
      t182 = 0.62182D-1*t168*t180
      t184 = 1.D0+0.6901399211255825D-1*t166
      t189 = 0.8157414703487641D1*t169+0.2247591863577616D1*t166
     &+0.4300972471276643D0*t172+0.1911512595127338D0*t174
      t192 = 1.D0+0.2960857464321668D2/t189
      t193 = dlog(t192)
      t194 = t184*t193
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t210 = 1/t209
      t211 = t207*t210
      t213 = 1.D0-1.D0*t211
      t214 = t205*t213
      t216 = 0.3799574853701528D-1*t194*t214
      t218 = 1.D0+0.1274696188700087D0*t166
      t223 = 0.1112037486309468D2*t169+0.3844746237447211D1*t166
     &+0.1644733775567609D1*t172+0.2405871291288192D0*t174
      t226 = 1.D0+0.321646831778707D2/t223
      t227 = dlog(t226)
      t230 = -0.3109D-1*t218*t227+t182
      t231 = t230*t205
      t233 = 0.1923661050931536D1*t231*t211
      t240 = t164*(-t182+t216+t233)+0.3109D-1*t50*t62+0.3109D-1*t130
     &*t142
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t247 = 1/t246
      t250 = t243**2
      t251 = t246**2
      t252 = 1/t251
      t255 = t250*t243
      t257 = 1/t251/t246
      t260 = t250**2
      t261 = t251**2
      t262 = 1/t261
      t265 = 0.542352D0+0.4208784D-1*t243*t247-0.10217592D-2*t250*t252
     &+0.75671064D-5*t255*t257-0.264752064D-7*t260*t262
      zk(i) = -0.9305257363491D0*t5*t43-0.3109D-1*t50*t81
     &-0.9305257363491D0*t85*t123-0.3109D-1*t130*t161+t240*t265
      t269 = t6*rhoa
      t271 = 1/t7/t269
      t272 = sigmaaa*t271
      t275 = t17*t6
      t277 = 1/t4/t275
      t278 = t16*t277
      t282 = 1/t27/rhoa
      t283 = t26*t282
      t288 = 1/t7/t27/t269
      t289 = t34*t288
      t292 = t34*sigmaaa
      t295 = 1/t4/t27/t275
      t296 = t292*t295
      t298 = 1/t39/t12
      t301 = 0.8524736D-2*t272*t13-0.5095865173333333D-3*t278*t23
     &+0.4906161493333333D-5*t283*t31-0.2033292629333333D-7*t289*t40
     &+0.3326432597333333D-10*t296*t298
      t304 = t49*t62
      t307 = 1/t56
      t308 = t46*t307
      t311 = t58**2
      t312 = 1/t311
      t313 = t50*t312
      t314 = t51**2
      t315 = t314**2
      t316 = t315*t51
      t317 = 1/t316
      t318 = 1/t6
      t323 = 1/t54
      t326 = 1/t47
      t329 = -0.1853395810515781D1*t317*t318-0.128158207914907D1*t307
     &*t318-0.8223668877838045D0*t323*t318-0.1603914194192128D0*t326
     &*t318
      t330 = 1/t61
      t331 = t329*t330
      t332 = t331*t80
      t344 = 1/t76/t64
      t347 = -0.9143253333333333D-2*t272*t65+0.280518784D0*t278*t69
     &-0.1234161066666667D0*t283*t73-0.15757056D-2*t289*t77
     &+0.302226432D-2*t296*t344
      t348 = t62*t347
      t351 = 1/t174
      t352 = 1/t208
      t353 = t351*t352
      t354 = t353*t180
      t355 = 0.2747799777968419D-2*t354
      t356 = t176**2
      t357 = 1/t356
      t358 = t168*t357
      t359 = t169**2
      t360 = t359**2
      t361 = t360*t169
      t362 = 1/t361
      t363 = t362*t352
      t366 = 1/t172
      t367 = t366*t352
      t369 = 1/t166
      t370 = t369*t352
      t372 = -0.99709173929518D0*t363-0.7418564737168958D0*t353
     &-0.4002143174996817D0*t367-0.1264669550498372D0*t370
      t373 = 1/t179
      t375 = t358*t372*t373
      t376 = 0.1D1*t375
      t377 = t193*t205
      t378 = t377*t213
      t379 = t353*t378
      t380 = 0.8740794299481065D-3*t379
      t381 = t189**2
      t382 = 1/t381
      t383 = t184*t382
      t388 = -0.135956911724794D1*t363-0.7491972878592054D0*t353
     &-0.2150486235638321D0*t367-0.1274341730084892D0*t370
      t389 = t383*t388
      t390 = 1/t192
      t391 = t390*t205
      t392 = t391*t213
      t393 = t389*t392
      t394 = 0.1124999956683108D1*t393
      t395 = t196*t352
      t396 = 1.D0*t395
      t397 = t165-t396
      t400 = 1.D0*t165
      t401 = -t400+t395
      t404 = 0.1333333333333333D1*t199*t397+0.1333333333333333D1*t203
     &*t401
      t406 = t194*t404*t213
      t407 = 0.3799574853701528D-1*t406
      t408 = t206*t196
      t409 = t408*t210
      t410 = 4.D0*t409
      t412 = 1/t209/t164
      t413 = t207*t412
      t414 = 4.D0*t413
      t415 = -t410+t414
      t417 = t194*t205*t415
      t418 = 0.3799574853701528D-1*t417
      t421 = t223**2
      t422 = 1/t421
      t423 = t218*t422
      t428 = -0.1853395810515781D1*t363-0.128158207914907D1*t353
     &-0.8223668877838045D0*t367-0.1603914194192128D0*t370
      t429 = 1/t226
      t435 = 0.1321010150222857D-2*t353*t227+0.1D1*t423*t428*t429
     &-0.2747799777968419D-2*t354-0.1D1*t375
      t436 = t435*t205
      t437 = t436*t211
      t438 = 0.1923661050931536D1*t437
      t439 = t230*t404
      t440 = t439*t211
      t441 = 0.1923661050931536D1*t440
      t442 = t231*t409
      t444 = t231*t413
      t445 = 0.7694644203726145D1*t444
      t452 = t312*t329*t330
      t455 = -t182+t216+t233+t164*(t355+t376-t380-t394+t407+t418+t438
     &+t441+0.7694644203726145D1*t442-t445)+0.3109D-1*t304
     &-0.1321010150222857D-2*t308*t62-0.1D1*t50*t452
      t459 = t243*t252
      t462 = t250*t257
      t465 = t255*t262
      t469 = 1/t261/t246
      t470 = t260*t469
      t473 = -0.5611712D-1*t272*t247+0.306139392D-2*t459*t272
     &-0.466165728D-4*t462*t272+0.3228116544D-6*t465*t272
     &-0.8472066048D-9*t470*t272
      vrhoa(i) = -0.12407009817988D1*t4*t43-0.9305257363491D0*t5*t301
     &-0.3109D-1*t304*t80+0.1321010150222857D-2*t308*t81+0.1D1*t313
     &*t332-0.3109D-1*t50*t348+t455*t265+t240*t473
      t477 = t86*rhob
      t479 = 1/t87/t477
      t480 = sigmabb*t479
      t483 = t97*t86
      t485 = 1/t84/t483
      t486 = t96*t485
      t490 = 1/t107/rhob
      t491 = t106*t490
      t496 = 1/t87/t107/t477
      t497 = t114*t496
      t500 = t114*sigmabb
      t503 = 1/t84/t107/t483
      t504 = t500*t503
      t506 = 1/t119/t92
      t509 = 0.8524736D-2*t480*t93-0.5095865173333333D-3*t486*t103
     &+0.4906161493333333D-5*t491*t111-0.2033292629333333D-7*t497*t120
     &+0.3326432597333333D-10*t504*t506
      t512 = t129*t142
      t515 = 1/t136
      t516 = t126*t515
      t519 = t138**2
      t520 = 1/t519
      t521 = t130*t520
      t522 = t131**2
      t523 = t522**2
      t524 = t523*t131
      t525 = 1/t524
      t526 = 1/t86
      t531 = 1/t134
      t534 = 1/t127
      t537 = -0.1853395810515781D1*t525*t526-0.128158207914907D1*t515
     &*t526-0.8223668877838045D0*t531*t526-0.1603914194192128D0*t534
     &*t526
      t538 = 1/t141
      t539 = t537*t538
      t540 = t539*t160
      t552 = 1/t156/t144
      t555 = -0.9143253333333333D-2*t480*t145+0.280518784D0*t486*t149
     &-0.1234161066666667D0*t491*t153-0.15757056D-2*t497*t157
     &+0.302226432D-2*t504*t552
      t556 = t142*t555
      t559 = -t400-t396
      t562 = t165+t395
      t565 = 0.1333333333333333D1*t199*t559+0.1333333333333333D1*t203
     &*t562
      t567 = t194*t565*t213
      t568 = 0.3799574853701528D-1*t567
      t569 = t410+t414
      t571 = t194*t205*t569
      t572 = 0.3799574853701528D-1*t571
      t573 = t230*t565
      t574 = t573*t211
      t575 = 0.1923661050931536D1*t574
      t583 = t520*t537*t538
      t586 = -t182+t216+t233+t164*(t355+t376-t380-t394+t568+t572+t438
     &+t575-0.7694644203726145D1*t442-t445)+0.3109D-1*t512
     &-0.1321010150222857D-2*t516*t142-0.1D1*t130*t583
      t598 = -0.5611712D-1*t480*t247+0.306139392D-2*t459*t480
     &-0.466165728D-4*t462*t480+0.3228116544D-6*t465*t480
     &-0.8472066048D-9*t470*t480
      vrhob(i) = -0.12407009817988D1*t84*t123-0.9305257363491D0*t85
     &*t509-0.3109D-1*t512*t160+0.1321010150222857D-2*t516*t161+0.1D1
     &*t521*t540-0.3109D-1*t130*t556+t586*t265+t240*t598
      t602 = sigmaaa*t20
      t605 = t16*t28
      t608 = t26*t37
      t613 = 1/t4/t27/t18
      t614 = t34*t613
      t617 = -0.3196776D-2*t9*t13+0.191094944D-3*t602*t23
     &-0.183981056D-5*t605*t31+0.762484736D-8*t608*t40
     &-0.1247412224D-10*t614*t298
      t630 = 0.342872D-2*t9*t65-0.105194544D0*t602*t69+0.4628104D-1
     &*t605*t73+0.5908896D-3*t608*t77-0.113334912D-2*t614*t344
      t631 = t62*t630
      t644 = 0.2104392D-1*t9*t247-0.114802272D-2*t459*t9
     &+0.174812148D-4*t462*t9-0.1210543704D-6*t465*t9+0.3177024768D-9
     &*t470*t9
      vsigmaaa(i) = -0.9305257363491D0*t5*t617-0.3109D-1*t50*t631+t240
     &*t644
      vsigmaab(i) = 0.D0
      t648 = sigmabb*t100
      t651 = t96*t108
      t654 = t106*t117
      t659 = 1/t84/t107/t98
      t660 = t114*t659
      t663 = -0.3196776D-2*t89*t93+0.191094944D-3*t648*t103
     &-0.183981056D-5*t651*t111+0.762484736D-8*t654*t120
     &-0.1247412224D-10*t660*t506
      t676 = 0.342872D-2*t89*t145-0.105194544D0*t648*t149+0.4628104D-1
     &*t651*t153+0.5908896D-3*t654*t157-0.113334912D-2*t660*t552
      t677 = t142*t676
      t690 = 0.2104392D-1*t89*t247-0.114802272D-2*t459*t89
     &+0.174812148D-4*t462*t89-0.1210543704D-6*t465*t89
     &+0.3177024768D-9*t470*t89
      vsigmabb(i) = -0.9305257363491D0*t85*t663-0.3109D-1*t130*t677
     &+t240*t690
      t696 = sigmaaa/t7/t17
      t699 = t17*t269
      t702 = t16/t4/t699
      t705 = t243*t257
      t710 = t250*t262
      t715 = t255*t469
      t722 = t260/t261/t251
      t739 = t26/t35
      t745 = t34/t7/t27/t17
      t751 = t292/t4/t27/t699
      t755 = t27**2
      t758 = t34*t16/t755/t6
      t760 = 1/t39/t22
      t768 = t49*t312
      t771 = 1/t269
      t773 = 1/t56/t46
      t774 = t771*t773
      t780 = 1/t311/t58
      t782 = t329**2
      t792 = 1/t17
      t813 = -0.1544496508763151D1/t316/t46*t792+0.3706791621031562D1
     &*t317*t771-0.854388052766047D0*t773*t792+0.2563164158298141D1
     &*t307*t771-0.4111834438919023D0/t54/t46*t792
     &+0.1644733775567609D1*t323*t771-0.5346380647307093D-1/t47/t46
     &*t792+0.3207828388384256D0*t326*t771
      t821 = t311**2
      t822 = 1/t821
      t824 = t61**2
      t825 = 1/t824
      t841 = 1/t76/t68
      t848 = 0.2D1*t375
      t850 = 0.5495599555936838D-2*t354
      t852 = 0.1748158859896213D-2*t379
      t853 = 0.2249999913366216D1*t393
      t854 = 0.3847322101863073D1*t437
      t875 = 0.1538928840745229D2*t444
      t877 = 0.1538928840745229D2*t436*t413
      t880 = t207/t209/t208
      t882 = 0.3847322101863073D2*t231*t880
      t885 = 1/t174/t165*t210
      t889 = 1/t208/t164
      t890 = t351*t889
      t900 = t428**2
      t906 = 1/t361/t165*t210
      t908 = t362*t889
      t914 = 1/t172/t165*t210
      t916 = t366*t889
      t920 = 1/t166/t165*t210
      t922 = t369*t889
      t928 = t421**2
      t931 = t226**2
      t936 = t885*t180
      t938 = t890*t180
      t942 = t353*t357*t372*t373
      t947 = t372**2
      t949 = t168/t356/t176*t947*t373
      t961 = t358*(-0.8309097827459833D0*t906+0.199418347859036D1*t908
     &-0.4945709824779306D0*t885+0.1483712947433792D1*t890
     &-0.2001071587498409D0*t914+0.8004286349993634D0*t916
     &-0.4215565168327908D-1*t920+0.2529339100996745D0*t922)*t373
      t963 = t356**2
      t966 = t179**2
      t969 = t168/t963*t947/t966
      t971 = 0.8806734334819047D-3*t885*t227-0.2642020300445714D-2
     &*t890*t227-0.8497974591333914D-1*t353*t422*t428*t429-0.2D1*t218
     &/t421/t223*t900*t429+0.1D1*t423*(-0.1544496508763151D1*t906
     &+0.3706791621031562D1*t908-0.854388052766047D0*t885
     &+0.2563164158298141D1*t890-0.4111834438919023D0*t914
     &+0.1644733775567609D1*t916-0.5346380647307093D-1*t920
     &+0.3207828388384256D0*t922)*t429+0.321646831778707D2*t218/t928
     &*t900/t931-0.1831866518645613D-2*t936+0.5495599555936838D-2*t938
     &+0.8837926660346786D-1*t942+0.2D1*t949-0.1D1*t961
     &-0.160818243221511D2*t969
      t974 = 0.1923661050931536D1*t971*t205*t211
      t975 = t439*t409
      t977 = 0.1831866518645613D-2*t936
      t979 = t353*t377*t415
      t981 = 0.5495599555936838D-2*t938
      t984 = t353*t193*t404*t213
      t987 = 0.1748158859896213D-2*t890*t378
      t988 = t206*t210
      t989 = t231*t988
      t990 = 0.2308393261117844D2*t989
      t994 = t388**2
      t997 = 0.2249999913366216D1*t184/t381/t189*t994*t392
      t999 = t435*t404*t211
      t1008 = 0.5176049209143758D-1*t353*t382*t388*t390*t214
      t1009 = -t877+t882+t974+0.1538928840745229D2*t975+t977
     &-0.1748158859896213D-2*t979-t981-0.1748158859896213D-2*t984+t987
     &+t990+t997+0.3847322101863073D1*t999+0.7599149707403056D-1*t194
     &*t404*t415+t1008
      t1010 = t408*t412
      t1011 = t231*t1010
      t1014 = 0.5827196199654043D-3*t885*t378
      t1015 = t199**2
      t1016 = 1/t1015
      t1017 = t397**2
      t1020 = 2.D0*t352
      t1022 = 2.D0*t196*t889
      t1023 = -t1020+t1022
      t1026 = t203**2
      t1027 = 1/t1026
      t1028 = t401**2
      t1034 = 0.4444444444444444D0*t1016*t1017+0.1333333333333333D1
     &*t199*t1023+0.4444444444444444D0*t1027*t1028
     &-0.1333333333333333D1*t203*t1023
      t1038 = 12.D0*t988
      t1039 = 32.D0*t1010
      t1040 = 20.D0*t880
      t1048 = t439*t413
      t1050 = 0.2D1*t949
      t1052 = t389*t391*t415
      t1054 = t381**2
      t1058 = t192**2
      t1063 = 0.3330964519106732D2*t184/t1054*t994/t1058*t205*t213
      t1066 = t389*t390*t404*t213
      t1068 = 0.1D1*t961
      t1069 = 0.160818243221511D2*t969
      t1081 = 0.1124999956683108D1*t383*(-0.1132974264373283D1*t906
     &+0.271913823449588D1*t908-0.4994648585728036D0*t885
     &+0.1498394575718411D1*t890-0.1075243117819161D0*t914
     &+0.4300972471276643D0*t916-0.4247805766949639D-1*t920
     &+0.2548683460169784D0*t922)*t392
      t1082 = 0.8837926660346786D-1*t942
      t1083 = t436*t409
      t1085 = -0.6155715362980916D2*t1011-t1014+0.3799574853701528D-1
     &*t194*t1034*t213+0.3799574853701528D-1*t194*t205*(-t1038+t1039
     &-t1040)+0.1923661050931536D1*t230*t1034*t211
     &-0.1538928840745229D2*t1048-t1050-0.2249999913366216D1*t1052
     &-t1063-0.2249999913366216D1*t1066+t1068+t1069-t1081-t1082
     &+0.1538928840745229D2*t1083
      t1088 = t848+0.7599149707403056D-1*t406+t850
     &+0.7599149707403056D-1*t417-t852-t853+t854-0.2D1*t768*t331
     &-0.8806734334819047D-3*t774*t62+0.8497974591333914D-1*t308*t452
     &+0.2D1*t50*t780*t782*t330-0.321646831778707D2*t50*t822*t782*t825
     &-0.1D1*t50*t312*t813*t330+0.3847322101863073D1*t440
     &+0.1538928840745229D2*t442-t875+t164*(t1009+t1085)
      s1 = 2.D0*t455*t473+t240*(0.2057627733333333D0*t696*t247
     &-0.453079552D-2*t702*t252+0.17329316352D-3*t705*t702
     &-0.1122511104D-1*t459*t696-0.24100443648D-5*t710*t702
     &+0.1709274336D-3*t462*t696+0.148484081664D-7*t715*t702
     &-0.11836427328D-5*t465*t696-0.33888264192D-10*t722*t702
     &+0.31064242176D-8*t470*t696)-0.4135669939329333D0/t7*t43
     &-0.24814019635976D1*t4*t301-0.9305257363491D0*t5*(
     &-0.3125736533333333D-1*t696*t13+0.3318311793777778D-2*t702*t23
     &-0.5502663247644444D-4*t739*t31+0.3942146412088889D-6*t745*t40
     &-0.13443268608D-8*t751*t298+0.1774097385244444D-11*t758*t760)
     &-0.6218D-1*t304*t347+0.2D1*t768*t332+0.8806734334819047D-3*t774
     &*t81
      v2rhoa2(i) = s1+0.2642020300445714D-2*t308*t348-0.2D1*t50*t780
     &*t782*t330*t80-0.8497974591333914D-1*t308*t312*t332+0.1D1*t313
     &*t813*t330*t80+0.2D1*t313*t331*t347+0.321646831778707D2*t50*t822
     &*t782*t825*t80-0.3109D-1*t50*t62*(0.3352526222222222D-1*t696*t65
     &-0.1781495367111111D1*t702*t69+0.1409964996266667D1*t739*t73
     &-0.1790825386666667D0*t745*t77-0.466806272D-1*t751*t344
     &+0.805937152D-2*t758*t841)+t1088*t265
      t1095 = t129*t520
      t1100 = sigmabb/t87/t97
      t1103 = t97*t477
      t1106 = t96/t84/t1103
      t1110 = t106/t115
      t1116 = t114/t87/t107/t97
      t1122 = t500/t84/t107/t1103
      t1126 = t107**2
      t1129 = t114*t96/t1126/t86
      t1131 = 1/t119/t102
      t1150 = 1/t156/t148
      t1159 = 1/t97
      t1162 = 1/t477
      t1166 = 1/t136/t126
      t1183 = -0.1544496508763151D1/t524/t126*t1159
     &+0.3706791621031562D1*t525*t1162-0.854388052766047D0*t1166*t1159
     &+0.2563164158298141D1*t515*t1162-0.4111834438919023D0/t134/t126
     &*t1159+0.1644733775567609D1*t531*t1162-0.5346380647307093D-1
     &/t127/t126*t1159+0.3207828388384256D0*t534*t1162
      t1189 = 1/t519/t138
      t1191 = t537**2
      t1196 = t1162*t1166
      t1204 = t519**2
      t1205 = 1/t1204
      t1207 = t141**2
      t1208 = 1/t1207
      t1222 = t353*t377*t569
      t1224 = -t877+t882+t974+t977-t981+t987+t990+t997+t1008
     &+0.6155715362980916D2*t1011-t1014-t1050-t1063
     &-0.1748158859896213D-2*t1222
      t1227 = t353*t193*t565*t213
      t1229 = t559**2
      t1232 = t1020+t1022
      t1235 = t562**2
      t1241 = 0.4444444444444444D0*t1016*t1229+0.1333333333333333D1
     &*t199*t1232+0.4444444444444444D0*t1027*t1235
     &-0.1333333333333333D1*t203*t1232
      t1246 = t435*t565*t211
      t1250 = t389*t390*t565*t213
      t1256 = t389*t391*t569
      t1261 = t573*t413
      t1263 = t573*t409
      t1270 = -0.1748158859896213D-2*t1227+0.3799574853701528D-1*t194
     &*t1241*t213+0.3847322101863073D1*t1246+t1068
     &-0.2249999913366216D1*t1250+0.7599149707403056D-1*t194*t565*t569
     &-0.2249999913366216D1*t1256+t1069-t1081+0.1923661050931536D1
     &*t230*t1241*t211-0.1538928840745229D2*t1261-0.1538928840745229D2
     &*t1263+0.3799574853701528D-1*t194*t205*(-t1038-t1039-t1040)
     &-t1082-0.1538928840745229D2*t1083
      t1291 = t848+t850-t852-t853+t854-0.1538928840745229D2*t442-t875
     &+0.7599149707403056D-1*t571+0.7599149707403056D-1*t567
     &+0.3847322101863073D1*t574+t164*(t1224+t1270)-0.2D1*t1095*t539
     &-0.8806734334819047D-3*t1196*t142+0.8497974591333914D-1*t516
     &*t583+0.2D1*t130*t1189*t1191*t538-0.1D1*t130*t520*t1183*t538
     &-0.321646831778707D2*t130*t1205*t1191*t1208
      s1 = -0.4135669939329333D0/t87*t123-0.24814019635976D1*t84*t509
     &+0.2D1*t1095*t540-0.9305257363491D0*t85*(-0.3125736533333333D-1
     &*t1100*t93+0.3318311793777778D-2*t1106*t103
     &-0.5502663247644444D-4*t1110*t111+0.3942146412088889D-6*t1116
     &*t120-0.13443268608D-8*t1122*t506+0.1774097385244444D-11*t1129
     &*t1131)-0.6218D-1*t512*t555-0.3109D-1*t130*t142*
     &(0.3352526222222222D-1*t1100*t145-0.1781495367111111D1*t1106
     &*t149+0.1409964996266667D1*t1110*t153-0.1790825386666667D0*t1116
     &*t157-0.466806272D-1*t1122*t552+0.805937152D-2*t1129*t1150)
     &+0.1D1*t521*t1183*t538*t160-0.2D1*t130*t1189*t1191*t538*t160
      v2rhob2(i) = s1+0.8806734334819047D-3*t1196*t161
     &-0.8497974591333914D-1*t516*t520*t540+0.2642020300445714D-2*t516
     &*t556+0.321646831778707D2*t130*t1205*t1191*t1208*t160+0.2D1*t521
     &*t539*t555+t1291*t265+2.D0*t586*t598+t240*(0.2057627733333333D0
     &*t1100*t247-0.453079552D-2*t1106*t252+0.17329316352D-3*t705
     &*t1106-0.1122511104D-1*t459*t1100-0.24100443648D-5*t710*t1106
     &+0.1709274336D-3*t462*t1100+0.148484081664D-7*t715*t1106
     &-0.11836427328D-5*t465*t1100-0.33888264192D-10*t722*t1106
     &+0.31064242176D-8*t470*t1100)
      t1329 = 0.4444444444444444D0*t1016*t397*t559
     &+0.2666666666666667D1*t199*t196*t889+0.4444444444444444D0*t1027
     &*t401*t562-0.2666666666666667D1*t203*t196*t889
      t1339 = -t877+0.1923661050931536D1*t230*t1329*t211+t882+t974
     &-0.7694644203726145D1*t975+t977-0.8740794299481065D-3*t979-t981
     &-0.8740794299481065D-3*t984+t987-0.2308393261117844D2*t989+t997
     &+0.1923661050931536D1*t999+t1008-t1014-0.7694644203726145D1
     &*t1048-t1050
      t1362 = -0.1124999956683108D1*t1052-t1063-0.8740794299481065D-3
     &*t1222-0.8740794299481065D-3*t1227-0.1124999956683108D1*t1066
     &+0.1923661050931536D1*t1246+t1068-0.1124999956683108D1*t1250
     &-0.1124999956683108D1*t1256+t1069+0.3799574853701528D-1*t194
     &*t404*t569-t1081-0.7694644203726145D1*t1261+0.7694644203726145D1
     &*t1263-t1082+0.3799574853701528D-1*t194*t565*t415
     &+0.3799574853701528D-1*t194*t1329*t213+0.3799574853701528D-1
     &*t194*t205*(t1038-t1040)
      t1365 = t850+t848-t852-t853+t568+t572+t854+t575-t875+t407+t418
     &+t441+t164*(t1339+t1362)
      t1375 = t271*sigmabb*t479
      v2rhoab(i) = t1365*t265+t455*t598+t586*t473+t240*(
     &-0.453079552D-2*t272*t252*sigmabb*t479+0.17329316352D-3*t705
     &*sigmaaa*t1375-0.24100443648D-5*t710*sigmaaa*t1375
     &+0.148484081664D-7*t715*sigmaaa*t1375-0.33888264192D-10*t722
     &*sigmaaa*t1375)
      t1393 = sigmaaa*t277
      t1396 = t16*t282
      t1399 = t26*t288
      t1402 = t34*t295
      t1407 = t292/t755/rhoa
      s1 = -0.12407009817988D1*t4*t617-0.9305257363491D0*t5*
     &(0.8524736D-2*t271*t13-0.1053271978666667D-2*t1393*t23
     &+0.1879517661866667D-4*t1396*t31-0.1402056430933333D-6*t1399*t40
     &+0.49164845056D-9*t1402*t298-0.6652865194666667D-12*t1407*t760)
     &-0.3109D-1*t304*t630+0.1321010150222857D-2*t308*t631
      v2rhoasigmaaa(i) = s1+0.1D1*t313*t331*t630-0.3109D-1*t50*t62*(
     &-0.9143253333333333D-2*t271*t65+0.5628662186666667D0*t1393*t69
     &-0.4824558336D0*t1396*t73+0.677468416D-1*t1399*t77
     &+0.1637188608D-1*t1402*t344-0.302226432D-2*t1407*t841)+t455*t644
     &+t240*(-0.5611712D-1*t271*t247+0.169904832D-2*t1393*t252
     &-0.6498493632D-4*t705*t1393+0.306139392D-2*t459*t271
     &+0.9037666368D-6*t710*t1393-0.466165728D-4*t462*t271
     &-0.55681530624D-8*t715*t1393+0.3228116544D-6*t465*t271
     &+0.12708099072D-10*t722*t1393-0.8472066048D-9*t470*t271)
      v2rhoasigmaab(i) = 0.D0
      t1463 = t272*t89
      v2rhoasigmabb(i) = t455*t690+t240*(0.169904832D-2*t272*t252*t89
     &-0.6498493632D-4*t705*t1463+0.9037666368D-6*t710*t1463
     &-0.55681530624D-8*t715*t1463+0.12708099072D-10*t722*t1463)
      t1475 = t252*t9
      t1478 = t480*t9
      v2rhobsigmaaa(i) = t586*t644+t240*(0.169904832D-2*t480*t1475
     &-0.6498493632D-4*t705*t1478+0.9037666368D-6*t710*t1478
     &-0.55681530624D-8*t715*t1478+0.12708099072D-10*t722*t1478)
      v2rhobsigmaab(i) = 0.D0
      t1493 = sigmabb*t485
      t1496 = t96*t490
      t1499 = t106*t496
      t1502 = t114*t503
      t1507 = t500/t1126/rhob
      s1 = -0.12407009817988D1*t84*t663-0.9305257363491D0*t85*
     &(0.8524736D-2*t479*t93-0.1053271978666667D-2*t1493*t103
     &+0.1879517661866667D-4*t1496*t111-0.1402056430933333D-6*t1499
     &*t120+0.49164845056D-9*t1502*t506-0.6652865194666667D-12*t1507
     &*t1131)-0.3109D-1*t512*t676+0.1321010150222857D-2*t516*t677
      v2rhobsigmabb(i) = s1+0.1D1*t521*t539*t676-0.3109D-1*t130*t142*(
     &-0.9143253333333333D-2*t479*t145+0.5628662186666667D0*t1493*t149
     &-0.4824558336D0*t1496*t153+0.677468416D-1*t1499*t157
     &+0.1637188608D-1*t1502*t552-0.302226432D-2*t1507*t1150)+t586
     &*t690+t240*(-0.5611712D-1*t479*t247+0.169904832D-2*t1493*t252
     &-0.6498493632D-4*t705*t1493+0.306139392D-2*t459*t479
     &+0.9037666368D-6*t710*t1493-0.466165728D-4*t462*t479
     &-0.55681530624D-8*t715*t1493+0.3228116544D-6*t465*t479
     &+0.12708099072D-10*t722*t1493-0.8472066048D-9*t470*t479)
      t1561 = sigmaaa*t28
      t1564 = t16*t37
      t1567 = t26*t613
      t1571 = t34/t755
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(0.203882048D-3*t20*t23
     &-0.5208380672D-5*t1561*t31+0.449522688D-7*t1564*t40
     &-0.17189404672D-9*t1567*t298+0.2494824448D-12*t1571*t760)
     &-0.3109D-1*t50*t62*(-0.105880288D0*t20*t69+0.1346398976D0*t1561
     &*t73-0.259959552D-1*t1564*t77-0.500610816D-2*t1567*t344
     &+0.113334912D-2*t1571*t841)+t240*(-0.63714312D-3*t20*t252
     &+0.2436935112D-4*t705*t20-0.3389124888D-6*t710*t20
     &+0.20880573984D-8*t715*t20-0.4765537152D-11*t722*t20)
      v2sigmaaaab(i) = 0.D0
      t1605 = t9*t89
      v2sigmaaabb(i) = t240*(-0.63714312D-3*t1475*t89+0.2436935112D-4
     &*t705*t1605-0.3389124888D-6*t710*t1605+0.20880573984D-8*t715
     &*t1605-0.4765537152D-11*t722*t1605)
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1617 = sigmabb*t108
      t1620 = t96*t117
      t1623 = t106*t659
      t1627 = t114/t1126
      v2sigmabb2(i) = -0.9305257363491D0*t85*(0.203882048D-3*t100*t103
     &-0.5208380672D-5*t1617*t111+0.449522688D-7*t1620*t120
     &-0.17189404672D-9*t1623*t506+0.2494824448D-12*t1627*t1131)
     &-0.3109D-1*t130*t142*(-0.105880288D0*t100*t149+0.1346398976D0
     &*t1617*t153-0.259959552D-1*t1620*t157-0.500610816D-2*t1623*t552
     &+0.113334912D-2*t1627*t1150)+t240*(-0.63714312D-3*t100*t252
     &+0.2436935112D-4*t705*t100-0.3389124888D-6*t710*t100
     &+0.20880573984D-8*t715*t100-0.4765537152D-11*t722*t100)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_hcth147
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     A.D. Boese, N.L. Doltsinis, N.C. Handy, M. Sprik
c     New generalized gradient approximation functionals
c     J. Chem. Phys. 112 (2000) 1670-1678.
c
c
c     CITATION:
c
c     Functionals were obtained from the Density Functional Repository 
c     as developed and distributed by the Quantum Chemistry Group, 
c     CCLRC Daresbury Laboratory, Daresbury, Cheshire, WA4 4AD 
c     United Kingdom. Contact Huub van Dam (h.j.j.vandam@dl.ac.uk) or 
c     Paul Sherwood for further information.
c
c     COPYRIGHT:
c
c     Users may incorporate the source code into software packages and
c     redistribute the source code provided the source code is not
c     changed in anyway and is properly cited in any documentation or
c     publication related to its use.
c
c     ACKNOWLEDGEMENT:
c
c     The source code was generated using Maple 8 through a modified
c     version of the dfauto script published in:
c
c        R. Strange, F.R. Manby, P.J. Knowles
c        Automatic code generation in density functional theory
c        Comp. Phys. Comm. 136 (2001) 310-318.
c
      implicit real*8 (a-h,o-z)
      integer ideriv,npt
      real*8 rhoa1(npt)
      real*8 sigmaaa1(npt)
      real*8 zk(npt),vrhoa(npt),vsigmaaa(npt)
      real*8 v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t8 = sigma/t5/t4
      t10 = 1.D0+0.6349604207872798D-2*t8
      t14 = sigma**2
      t15 = t4**2
      t19 = t14/t2/t15/rho
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigma/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t48 = rho*(1.D0+0.1606016560364007D0*t45)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1248219874679732D2*t49
     &+0.4844076716063854D1*t45+0.2326004811900819D1*t52
     &+0.3819082618690966D0*t54))
      t62 = 1.D0+0.3174802103936399D0*t8
      t66 = t62**2
      t74 = t66**2
      t93 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t49
     &+0.2225569421150687D1*t45+0.8004286349993634D0*t52
     &+0.1897004325747559D0*t54))
      t100 = 1.D0+0.9524406311809197D-2*t8
      t104 = t100**2
      t112 = t104**2
      zk(i) = -0.7385587663820224D0*t2*rho*(0.109025D1
     &-0.5074565585306693D-2*t8/t10+0.2246538009772871D-3*t19/t20
     &-0.15021056D-5*t27/t20/t10+0.4950358691538978D-8*t36/t37)
     &-0.3109D-1*t48*t60*(0.562576D0+0.5442753734904405D-2*t8/t62
     &-0.1316728370192533D0*t19/t66+0.3383904D-1*t27/t66/t62
     &+0.8995397926676166D-2*t36/t74)+(-0.62182D-1*rho*(1.D0
     &+0.1325688999052018D0*t45)*t93+0.3109D-1*t48*t60)*(0.542352D0
     &+0.6681028149106926D-1*t8/t100-0.2574671848007491D-2*t19/t104
     &+0.302684256D-4*t27/t104/t100-0.1681070819617408D-6*t36/t112)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t16 = t15*rho
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigma
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109025D1-0.5074565585306693D-2*t8*t11
     &+0.2246538009772871D-3*t19*t21-0.15021056D-5*t27*t29
     &+0.4950358691538978D-8*t36*t38
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1606016560364007D0*t45
      t48 = rho*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1248219874679732D2*t49+0.4844076716063854D1*t45
     &+0.2326004811900819D1*t52+0.3819082618690966D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.3174802103936399D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.562576D0+0.5442753734904405D-2*t8*t63
     &-0.1316728370192533D0*t19*t67+0.3383904D-1*t27*t71
     &+0.8995397926676166D-2*t36*t75
      t79 = t60*t78
      t83 = 1.D0+0.1325688999052018D0*t45
      t89 = 0.598255043577108D1*t49+0.2225569421150687D1*t45
     &+0.8004286349993634D0*t52+0.1897004325747559D0*t54
      t92 = 1.D0+0.160818243221511D2/t89
      t93 = dlog(t92)
      t98 = -0.62182D-1*rho*t83*t93+0.3109D-1*t48*t60
      t100 = 1.D0+0.9524406311809197D-2*t8
      t101 = 1/t100
      t104 = t100**2
      t105 = 1/t104
      t109 = 1/t104/t100
      t112 = t104**2
      t113 = 1/t112
      t116 = 0.542352D0+0.6681028149106926D-1*t8*t101
     &-0.2574671848007491D-2*t19*t105+0.302684256D-4*t27*t109
     &-0.1681070819617408D-6*t36*t113
      zk(i) = -0.7385587663820224D0*t3*t41-0.3109D-1*t48*t79+t98*t116
      t120 = t4*rho
      t123 = sigma/t5/t120
      t126 = t15*t4
      t129 = t14/t2/t126
      t134 = t24/t25/rho
      t140 = t32/t5/t25/t120
      t147 = t32*sigma/t2/t25/t126
      t149 = 1/t37/t10
      t155 = t47*t60
      t158 = 1/t54
      t159 = t44*t158
      t162 = t56**2
      t163 = 1/t162
      t165 = t49**2
      t166 = t165**2
      t169 = 1/t4
      t170 = 1/t166/t49*t169
      t172 = t158*t169
      t175 = 1/t52*t169
      t178 = 1/t45*t169
      t180 = -0.4160732915599108D1*t170-0.3229384477375903D1*t172
     &-0.2326004811900819D1*t175-0.5092110158254621D0*t178
      t181 = 1/t59
      t195 = 1/t74/t62
      t206 = t89**2
      t238 = 1/t112/t100
      s1 = -0.9847450218426965D0*t2*t41-0.3692793831910112D0*t3*
     &(0.2706434978830236D-1*t123*t11-0.2568155119723541D-2*t129*t21
     &+0.3924929194666667D-4*t134*t29-0.2582120687010336D-6*t140*t38
     &+0.6705667920698789D-9*t147*t149)-0.3109D-1*t155*t78
     &+0.1664368495390566D-2*t159*t79
      vrhoa(i) = s1+0.5D0*t48*t163*t180*t181*t78-0.15545D-1*t48*t60*(
     &-0.2902801991949016D-1*t123*t63+0.1413726083410053D1*t129*t67
     &-0.9873288533333333D0*t134*t71-0.2001021381625746D-1*t140*t75
     &+0.6092503096182744D-1*t147*t195)+(-0.62182D-1*t83*t93+rho*
     &(0.2747799777968419D-2*t172*t93+0.1D1*t83/t206*(
     &-0.99709173929518D0*t170-0.7418564737168958D0*t172
     &-0.4002143174996817D0*t175-0.1264669550498372D0*t178)/t92)
     &+0.3109D-1*t155-0.1664368495390566D-2*t159*t60-0.5D0*t48*t163
     &*t180*t181)*t116+t98*(-0.1781607506428514D0*t123*t101
     &+0.1542845856731273D-1*t129*t105-0.3729325824D-3*t134*t109
     &+0.4099452478257239D-5*t140*t113-0.1707861495995979D-7*t147*t238)
      t245 = sigma*t18
      t248 = t14*t26
      t251 = t24*t35
      t257 = t32/t2/t25/t16
      vsigmaaa(i) = -0.7385587663820224D0*t3*(-0.2029826234122677D-1
     &*t7*t11+0.1926116339792656D-2*t245*t21-0.2943696896D-4*t248*t29
     &+0.1936590515257752D-6*t251*t38-0.5029250940524092D-9*t257*t149)
     &-0.3109D-1*t48*t60*(0.2177101493961762D-1*t7*t63
     &-0.1060294562557539D1*t245*t67+0.74049664D0*t248*t71
     &+0.150076603621931D-1*t251*t75-0.4569377322137058D-1*t257*t195)
     &+2.D0*t98*(0.1336205629821385D0*t7*t101-0.1157134392548454D-1
     &*t245*t105+0.2796994368D-3*t248*t109-0.3074589358692929D-5*t251
     &*t113+0.1280896121996984D-7*t257*t238)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t16 = t15*rho
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigma
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.109025D1-0.5074565585306693D-2*t8*t11
     &+0.2246538009772871D-3*t19*t21-0.15021056D-5*t27*t29
     &+0.4950358691538978D-8*t36*t38
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1606016560364007D0*t45
      t48 = rho*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1248219874679732D2*t49+0.4844076716063854D1*t45
     &+0.2326004811900819D1*t52+0.3819082618690966D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.3174802103936399D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.562576D0+0.5442753734904405D-2*t8*t63
     &-0.1316728370192533D0*t19*t67+0.3383904D-1*t27*t71
     &+0.8995397926676166D-2*t36*t75
      t79 = t60*t78
      t83 = 1.D0+0.1325688999052018D0*t45
      t89 = 0.598255043577108D1*t49+0.2225569421150687D1*t45
     &+0.8004286349993634D0*t52+0.1897004325747559D0*t54
      t92 = 1.D0+0.160818243221511D2/t89
      t93 = dlog(t92)
      t98 = -0.62182D-1*rho*t83*t93+0.3109D-1*t48*t60
      t100 = 1.D0+0.9524406311809197D-2*t8
      t101 = 1/t100
      t104 = t100**2
      t105 = 1/t104
      t109 = 1/t104/t100
      t112 = t104**2
      t113 = 1/t112
      t116 = 0.542352D0+0.6681028149106926D-1*t8*t101
     &-0.2574671848007491D-2*t19*t105+0.302684256D-4*t27*t109
     &-0.1681070819617408D-6*t36*t113
      zk(i) = -0.7385587663820224D0*t3*t41-0.3109D-1*t48*t79+t98*t116
      t120 = t4*rho
      t122 = 1/t5/t120
      t123 = sigma*t122
      t126 = t15*t4
      t128 = 1/t2/t126
      t129 = t14*t128
      t133 = 1/t25/rho
      t134 = t24*t133
      t139 = 1/t5/t25/t120
      t140 = t32*t139
      t143 = t32*sigma
      t146 = 1/t2/t25/t126
      t147 = t143*t146
      t149 = 1/t37/t10
      t152 = 0.2706434978830236D-1*t123*t11-0.2568155119723541D-2*t129
     &*t21+0.3924929194666667D-4*t134*t29-0.2582120687010336D-6*t140
     &*t38+0.6705667920698789D-9*t147*t149
      t155 = t47*t60
      t158 = 1/t54
      t159 = t44*t158
      t162 = t56**2
      t163 = 1/t162
      t164 = t48*t163
      t165 = t49**2
      t166 = t165**2
      t167 = t166*t49
      t168 = 1/t167
      t169 = 1/t4
      t170 = t168*t169
      t172 = t158*t169
      t174 = 1/t52
      t175 = t174*t169
      t177 = 1/t45
      t178 = t177*t169
      t180 = -0.4160732915599108D1*t170-0.3229384477375903D1*t172
     &-0.2326004811900819D1*t175-0.5092110158254621D0*t178
      t181 = 1/t59
      t182 = t180*t181
      t183 = t182*t78
      t195 = 1/t74/t62
      t198 = -0.2902801991949016D-1*t123*t63+0.1413726083410053D1*t129
     &*t67-0.9873288533333333D0*t134*t71-0.2001021381625746D-1*t140
     &*t75+0.6092503096182744D-1*t147*t195
      t199 = t60*t198
      t204 = t172*t93
      t206 = t89**2
      t207 = 1/t206
      t208 = t83*t207
      t213 = -0.99709173929518D0*t170-0.7418564737168958D0*t172
     &-0.4002143174996817D0*t175-0.1264669550498372D0*t178
      t214 = 1/t92
      t216 = t208*t213*t214
      t224 = t163*t180*t181
      t227 = -0.62182D-1*t83*t93+rho*(0.2747799777968419D-2*t204+0.1D1
     &*t216)+0.3109D-1*t155-0.1664368495390566D-2*t159*t60-0.5D0*t48
     &*t224
      t238 = 1/t112/t100
      t241 = -0.1781607506428514D0*t123*t101+0.1542845856731273D-1
     &*t129*t105-0.3729325824D-3*t134*t109+0.4099452478257239D-5*t140
     &*t113-0.1707861495995979D-7*t147*t238
      vrhoa(i) = -0.9847450218426965D0*t2*t41-0.3692793831910112D0*t3
     &*t152-0.3109D-1*t155*t78+0.1664368495390566D-2*t159*t79+0.5D0
     &*t164*t183-0.15545D-1*t48*t199+t227*t116+t98*t241
      t245 = sigma*t18
      t248 = t14*t26
      t251 = t24*t35
      t256 = 1/t2/t25/t16
      t257 = t32*t256
      t260 = -0.2029826234122677D-1*t7*t11+0.1926116339792656D-2*t245
     &*t21-0.2943696896D-4*t248*t29+0.1936590515257752D-6*t251*t38
     &-0.5029250940524092D-9*t257*t149
      t273 = 0.2177101493961762D-1*t7*t63-0.1060294562557539D1*t245
     &*t67+0.74049664D0*t248*t71+0.150076603621931D-1*t251*t75
     &-0.4569377322137058D-1*t257*t195
      t274 = t60*t273
      t287 = 0.1336205629821385D0*t7*t101-0.1157134392548454D-1*t245
     &*t105+0.2796994368D-3*t248*t109-0.3074589358692929D-5*t251*t113
     &+0.1280896121996984D-7*t257*t238
      vsigmaaa(i) = -0.7385587663820224D0*t3*t260-0.3109D-1*t48*t274
     &+2.D0*t98*t287
      t294 = sigma/t5/t15
      t297 = t15*t120
      t300 = t14/t2/t297
      t301 = t300*t105
      t304 = t24/t33
      t305 = t304*t109
      t310 = t32/t5/t25/t15
      t311 = t310*t113
      t316 = t143/t2/t25/t297
      t317 = t316*t238
      t320 = t25**2
      t323 = t32*t14/t320/t4
      t325 = 1/t112/t104
      t327 = 0.2168848908288D-8*t323*t325
      t337 = t47*t163
      t351 = 1/t37/t20
      t360 = t162**2
      t361 = 1/t360
      t363 = t180**2
      t364 = t59**2
      t365 = 1/t364
      t372 = 1/t15
      t373 = 1/t167/t44*t372
      t375 = 1/t120
      t376 = t168*t375
      t379 = 1/t54/t44
      t380 = t379*t372
      t382 = t158*t375
      t386 = 1/t52/t44*t372
      t388 = t174*t375
      t392 = 1/t45/t44*t372
      t394 = t177*t375
      t396 = -0.6934554859331846D1*t373+0.1664293166239643D2*t376
     &-0.4305845969834537D1*t380+0.1291753790950361D2*t382
     &-0.2326004811900819D1*t386+0.9304019247603276D1*t388
     &-0.3394740105503081D0*t392+0.2036844063301848D1*t394
      t402 = 1/t162/t56
      t408 = t375*t379
      t424 = 0.5495599555936838D-2*t204
      t425 = 0.2D1*t216
      t431 = t213**2
      t434 = 0.2D1*t83/t206/t89*t431*t214
      t446 = 0.1D1*t208*(-0.8309097827459833D0*t373
     &+0.199418347859036D1*t376-0.4945709824779306D0*t380
     &+0.1483712947433792D1*t382-0.2001071587498409D0*t386
     &+0.8004286349993634D0*t388-0.4215565168327908D-1*t392
     &+0.2529339100996745D0*t394)*t214
      t447 = t206**2
      t450 = t92**2
      t454 = 0.160818243221511D2*t83/t447*t431/t450
      t456 = 0.1831866518645613D-2*t380*t93
      t458 = 0.5495599555936838D-2*t382*t93
      t469 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t49
     &+0.2247591863577616D1*t45+0.4300972471276643D0*t52
     &+0.1911512595127338D0*t54))
      t471 = (1.D0+0.6901399211255825D-1*t45)*t469*t169
      t476 = 0.8837926660346786D-1*t172*t207*t213*t214
      t500 = 1/t74/t66
      s1 = 4.D0*t227*t241+t98*(0.130651217138091D1*t294*t101
     &-0.1588095866809658D0*t301+0.550752955392D-2*t305
     &-0.9127396286679657D-4*t311+0.723893480573944D-6*t317-t327)
     &-0.6564966812284644D0/t5*t41-0.1969490043685393D1*t2*t152
     &-0.6218D-1*t155*t198+0.2D1*t337*t183-0.3692793831910112D0*t3*(
     &-0.1984718984475507D0*t294*t11+0.334464870327603D-1*t300*t21
     &-0.8804261196231111D-3*t304*t29+0.100124277785001D-4*t310*t38
     &-0.5419986271555248D-7*t316*t149+0.1135422326556444D-9*t323*t351
     &)+0.1D1*t164*t182*t198+0.1608234158893535D2*t48*t361*t363*t365*t78
      s2 = s1+0.5D0*t164*t396*t181*t78-0.1D1*t48*t402*t363*t181*t78
     &+0.2219157993854088D-2*t408*t79-0.1070677706909338D0*t159*t163
     &*t183
      v2rhoa2(i) = s2+0.3328736990781132D-2*t159*t199+(-0.5D0*t48*t163
     &*t396*t181-0.1608234158893535D2*t48*t361*t363*t365+t424+t425
     &-0.2D1*t337*t182+rho*(-t434+t446+t454+t456-t458
     &+0.3377399869956914D-1*t471-t476)+0.1070677706909338D0*t159*t224
     &+0.1D1*t48*t402*t363*t181-0.2219157993854088D-2*t408*t60)*t116
     &-0.15545D-1*t48*t60*(0.2128721460762612D0*t294*t63
     &-0.1795634810650787D2*t300*t67+0.2255943994026667D2*t304*t71
     &-0.4548412964297639D1*t310*t75-0.1882044954610406D1*t316*t195
     &+0.51579977728D0*t323*t500)+(t424+t425+rho*(-t434+t446+t454+t456
     &-t458-0.3377399869956914D-1*t471-t476))*t116+t98*(
     &-0.456675571873391D-1*t301+0.277269061632D-2*t305
     &-0.6121131135957682D-4*t311+0.5986503042009055D-6*t317-t327)
      t522 = sigma*t128
      t525 = t14*t133
      t528 = t24*t139
      t531 = t32*t146
      t536 = t143/t320/rho
      t569 = t522*t105
      t571 = t525*t109
      t573 = t528*t113
      t575 = t531*t238
      t578 = 0.1626636681216D-8*t536*t325
      s1 = -0.9847450218426965D0*t2*t260-0.3692793831910112D0*t3*
     &(0.1082573991532094D0*t122*t11-0.2123263259498491D-1*t522*t21
     &+0.6014456517973333D-3*t525*t29-0.7122002730823528D-5*t528*t38
     &+0.3964404684855954D-7*t531*t149-0.8515667449173333D-10*t536
     &*t351)-0.3109D-1*t155*t273+0.1664368495390566D-2*t159*t274
      v2rhoasigmaaa(i) = s1+0.5D0*t164*t182*t273-0.15545D-1*t48*t60*(
     &-0.1161120796779606D0*t122*t63+0.1134667195476582D2*t522*t67
     &-0.154385866752D2*t525*t71+0.3441325043947615D1*t528*t75
     &+0.1320146169515063D1*t531*t195-0.38684983296D0*t536*t500)+2.D0
     &*t227*t287+t98*(-0.7126430025714055D0*t122*t101
     &+0.9596450215975523D-1*t569-0.357124829184D-2*t571
     &+0.6230629343271157D-4*t573-0.5173021879905183D-6*t575+t578)+t98
     &*(0.3425066789050433D-1*t569-0.207951796224D-2*t571
     &+0.4590848351968261D-4*t573-0.4489877281506791D-6*t575+t578)
      t589 = sigma*t26
      t592 = t14*t35
      t595 = t24*t256
      t599 = t32/t320
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(0.8220009087068062D-2
     &*t18*t21-0.333336363008D-3*t589*t29+0.4566865842014545D-5*t592
     &*t38-0.2772133476021002D-7*t595*t149+0.638675058688D-10*t599
     &*t351)-0.3109D-1*t48*t60*(-0.4268825715844209D1*t18*t67
     &+0.86169534464D1*t589*t71-0.2641024424409484D1*t592*t75
     &-0.8073345342508149D0*t595*t195+0.29013737472D0*t599*t500)+4.D0
     &*t98*(-0.2568800091787825D-1*t18*t105+0.155963847168D-2*t589
     &*t109-0.3443136263976196D-4*t592*t113+0.3367407961130093D-6*t595
     &*t238-0.1219977510912D-8*t599*t325)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_HCTH147subrend
