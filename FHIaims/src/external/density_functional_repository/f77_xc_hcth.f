c:XC_HCTHsubrstart

c    Generated: Fri Feb 14 10:46:20 GMT 2003

      subroutine uks_xc_hcth
     & (ideriv,npt,rhoa1,rhob1,sigmaaa1,sigmabb1,sigmaab1,
     &  zk,vrhoa,vrhob,vsigmaaa,vsigmabb,vsigmaab,
     &  v2rhoa2,v2rhob2,v2rhoab,
     &  v2rhoasigmaaa,v2rhoasigmaab,v2rhoasigmabb,
     &  v2rhobsigmabb,v2rhobsigmaab,v2rhobsigmaaa,
     &  v2sigmaaa2,v2sigmaaaab,v2sigmaaabb,
     &  v2sigmaab2,v2sigmaabbb,v2sigmabb2)
c
c     F.A. Hamprecht, A.J. Cohen, D.J. Tozer, and N.C. Handy
c     Development and assessment of new exchange-correlation functionals
c     J. Chem. Phys. 109 (1998) 6264-6271
c
c
c     CITATION:
c
c     Functionals were obtained from the Density Functional Repository 
c     as developed and distributed by the Quantum Chemistry Group, 
c     CCLRC Daresbury Laboratory, Daresbury, Cheshire, WA4 4AD 
c     United Kingdom. Contact Huub van Dam (h.j.j.vandam@dl.ac.uk) or 
c     Paul Sherwood for further information.
c
c     COPYRIGHT:
c
c     Users may incorporate the source code into software packages and
c     redistribute the source code provided the source code is not
c     changed in anyway and is properly cited in any documentation or
c     publication related to its use.
c
c     ACKNOWLEDGEMENT:
c
c     The source code was generated using Maple 8 through a modified
c     version of the dfauto script published in:
c
c        R. Strange, F.R. Manby, P.J. Knowles
c        Automatic code generation in density functional theory
c        Comp. Phys. Comm. 136 (2001) 310-318.
c
      implicit real*8 (a-h,o-z)
      integer ideriv,npt
      real*8 rhoa1(npt),rhob1(npt)
      real*8 sigmaaa1(npt),sigmabb1(npt),sigmaab1(npt)
      real*8 zk(npt),vrhoa(npt),vrhob(npt)
      real*8 vsigmaaa(npt),vsigmabb(npt),vsigmaab(npt)
      real*8 v2rhoa2(npt),v2rhob2(npt),v2rhoab(npt)
      real*8 v2rhoasigmaaa(npt),v2rhoasigmaab(npt)
      real*8 v2rhoasigmabb(npt),v2rhobsigmabb(npt)
      real*8 v2rhobsigmaab(npt),v2rhobsigmaaa(npt)
      real*8 v2sigmaaa2(npt),v2sigmaaaab(npt),v2sigmaaabb(npt)
      real*8 v2sigmaab2(npt),v2sigmaabbb(npt),v2sigmabb2(npt)
      parameter(tol=1.0d-20)
      
      if (ideriv.eq.0) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t4 = rhob**2
      t5 = t2**2
      t8 = sigmabb/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmabb**2
      t15 = t4**2
      t19 = t14/t2/t15/rhob
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigmabb/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t49
     &+0.3844746237447211D1*t45+0.1644733775567609D1*t52
     &+0.2405871291288192D0*t54))
      t62 = 1.D0+0.2D0*t8
      t66 = t62**2
      t74 = t66**2
      zk(i) = -0.9305257363491D0*t2*rhob*(0.10932D1-0.2976224D-2*t8
     &/t10+0.895872D-4*t19/t20-0.43427136D-6*t27/t20/t10
     &+0.115035392D-8*t36/t37)-0.3109D-1*rhob*(1.D0
     &+0.1274696188700087D0*t45)*t60*(0.222601D0-0.677244D-2*t8/t62
     &-0.50068D-3*t19/t66-0.6419968D-2*t27/t66/t62+0.2486336D-2*t36/t74)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t4 = rhoa**2
      t5 = t2**2
      t8 = sigmaaa/t5/t4
      t10 = 1.D0+0.4D-2*t8
      t14 = sigmaaa**2
      t15 = t4**2
      t19 = t14/t2/t15/rhoa
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigmaaa/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t49
     &+0.3844746237447211D1*t45+0.1644733775567609D1*t52
     &+0.2405871291288192D0*t54))
      t62 = 1.D0+0.2D0*t8
      t66 = t62**2
      t74 = t66**2
      zk(i) = -0.9305257363491D0*t2*rhoa*(0.10932D1-0.2976224D-2*t8
     &/t10+0.895872D-4*t19/t20-0.43427136D-6*t27/t20/t10
     &+0.115035392D-8*t36/t37)-0.3109D-1*rhoa*(1.D0
     &+0.1274696188700087D0*t45)*t60*(0.222601D0-0.677244D-2*t8/t62
     &-0.50068D-3*t19/t66-0.6419968D-2*t27/t66/t62+0.2486336D-2*t36/t74)
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t6 = rhoa**2
      t7 = t4**2
      t10 = sigmaaa/t7/t6
      t12 = 1.D0+0.4D-2*t10
      t16 = sigmaaa**2
      t17 = t6**2
      t21 = t16/t4/t17/rhoa
      t22 = t12**2
      t27 = t17**2
      t29 = t16*sigmaaa/t27
      t34 = t16**2
      t38 = t34/t7/t27/t6
      t39 = t22**2
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t50 = rhoa*(1.D0+0.1274696188700087D0*t47)
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t62 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t51
     &+0.3844746237447211D1*t47+0.1644733775567609D1*t54
     &+0.2405871291288192D0*t56))
      t64 = 1.D0+0.2D0*t10
      t68 = t64**2
      t76 = t68**2
      t84 = rhob**(1.D0/3.D0)
      t86 = rhob**2
      t87 = t84**2
      t90 = sigmabb/t87/t86
      t92 = 1.D0+0.4D-2*t90
      t96 = sigmabb**2
      t97 = t86**2
      t101 = t96/t84/t97/rhob
      t102 = t92**2
      t107 = t97**2
      t109 = t96*sigmabb/t107
      t114 = t96**2
      t118 = t114/t87/t107/t86
      t119 = t102**2
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t130 = rhob*(1.D0+0.1274696188700087D0*t127)
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t142 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t131
     &+0.3844746237447211D1*t127+0.1644733775567609D1*t134
     &+0.2405871291288192D0*t136))
      t144 = 1.D0+0.2D0*t90
      t148 = t144**2
      t156 = t148**2
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t180 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t169
     &+0.2225569421150687D1*t166+0.8004286349993634D0*t172
     &+0.1897004325747559D0*t174))
      t182 = 0.62182D-1*(1.D0+0.1325688999052018D0*t166)*t180
      t193 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t169
     &+0.2247591863577616D1*t166+0.4300972471276643D0*t172
     &+0.1911512595127338D0*t174))
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t211 = t207/t209
      t227 = dlog(1.D0+0.321646831778707D2/(0.1112037486309468D2*t169
     &+0.3844746237447211D1*t166+0.1644733775567609D1*t172
     &+0.2405871291288192D0*t174))
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t250 = t243**2
      t251 = t246**2
      t260 = t250**2
      t261 = t251**2
      s1 = -0.9305257363491D0*t4*rhoa*(0.10932D1-0.2976224D-2*t10/t12
     &+0.895872D-4*t21/t22-0.43427136D-6*t29/t22/t12+0.115035392D-8
     &*t38/t39)-0.3109D-1*t50*t62*(0.222601D0-0.677244D-2*t10/t64
     &-0.50068D-3*t21/t68-0.6419968D-2*t29/t68/t64+0.2486336D-2*t38/t76)
      zk(i) = s1-0.9305257363491D0*t84*rhob*(0.10932D1-0.2976224D-2
     &*t90/t92+0.895872D-4*t101/t102-0.43427136D-6*t109/t102/t92
     &+0.115035392D-8*t118/t119)-0.3109D-1*t130*t142*(0.222601D0
     &-0.677244D-2*t90/t144-0.50068D-3*t101/t148-0.6419968D-2*t109
     &/t148/t144+0.2486336D-2*t118/t156)+(t164*(-t182
     &+0.3799574853701528D-1*(1.D0+0.6901399211255825D-1*t166)*t193
     &*t205*(1.D0-1.D0*t211)+0.1923661050931536D1*(-0.3109D-1*(1.D0
     &+0.1274696188700087D0*t166)*t227+t182)*t205*t211)+0.3109D-1*t50
     &*t62+0.3109D-1*t130*t142)*(0.729974D0+0.2011722D-1*t243/t246
     &-0.415548D-3*t250/t251+0.174649824D-5*t250*t243/t251/t246
     &-0.580422672D-8*t260/t261)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t16 = t15*rhob
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmabb
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.10932D1-0.2976224D-2*t8*t11+0.895872D-4*t19*t21
     &-0.43427136D-6*t27*t29+0.115035392D-8*t36*t38
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhob*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     &+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.222601D0-0.677244D-2*t8*t63-0.50068D-3*t19*t67
     &-0.6419968D-2*t27*t71+0.2486336D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      vrhoa(i) = 0.D0
      t84 = t4*rhob
      t87 = sigmabb/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhob
      t104 = t32/t5/t25/t84
      t111 = t32*sigmabb/t2/t25/t90
      t113 = 1/t37/t10
      t122 = 1/t54
      t126 = t56**2
      t129 = t49**2
      t130 = t129**2
      t133 = 1/t4
      t159 = 1/t74/t62
      vrhob(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*
     &(0.7936597333333333D-2*t87*t11-0.5095447893333333D-3*t93*t21
     &+0.538536448D-5*t98*t29-0.2616712533333333D-7*t104*t38
     &+0.4908176725333333D-10*t111*t113)-0.3109D-1*t47*t60*t78
     &+0.1321010150222857D-2*t44*t122*t79+0.1D1*t48/t126*(
     &-0.1853395810515781D1/t130/t49*t133-0.128158207914907D1*t122
     &*t133-0.8223668877838045D0/t52*t133-0.1603914194192128D0/t45
     &*t133)/t59*t78-0.3109D-1*t48*t60*(0.1805984D-1*t87*t63
     &-0.9416746666666667D-3*t93*t67+0.5082568533333333D-1*t98*t71
     &-0.3679286613333333D-1*t104*t75+0.5304183466666667D-2*t111*t159)
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t168 = sigmabb*t18
      t171 = t14*t26
      t174 = t24*t35
      t180 = t32/t2/t25/t16
      vsigmabb(i) = -0.9305257363491D0*t3*(-0.2976224D-2*t7*t11
     &+0.191079296D-3*t168*t21-0.201951168D-5*t171*t29+0.9812672D-8
     &*t174*t38-0.1840566272D-10*t180*t113)-0.3109D-1*t48*t60*(
     &-0.677244D-2*t7*t63+0.353128D-3*t168*t67-0.19059632D-1*t171*t71
     &+0.137973248D-1*t174*t75-0.19890688D-2*t180*t159)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t16 = t15*rhoa
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmaaa
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.10932D1-0.2976224D-2*t8*t11+0.895872D-4*t19*t21
     &-0.43427136D-6*t27*t29+0.115035392D-8*t36*t38
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhoa*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     &+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.222601D0-0.677244D-2*t8*t63-0.50068D-3*t19*t67
     &-0.6419968D-2*t27*t71+0.2486336D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      t84 = t4*rhoa
      t87 = sigmaaa/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhoa
      t104 = t32/t5/t25/t84
      t111 = t32*sigmaaa/t2/t25/t90
      t113 = 1/t37/t10
      t122 = 1/t54
      t126 = t56**2
      t129 = t49**2
      t130 = t129**2
      t133 = 1/t4
      t159 = 1/t74/t62
      vrhoa(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*
     &(0.7936597333333333D-2*t87*t11-0.5095447893333333D-3*t93*t21
     &+0.538536448D-5*t98*t29-0.2616712533333333D-7*t104*t38
     &+0.4908176725333333D-10*t111*t113)-0.3109D-1*t47*t60*t78
     &+0.1321010150222857D-2*t44*t122*t79+0.1D1*t48/t126*(
     &-0.1853395810515781D1/t130/t49*t133-0.128158207914907D1*t122
     &*t133-0.8223668877838045D0/t52*t133-0.1603914194192128D0/t45
     &*t133)/t59*t78-0.3109D-1*t48*t60*(0.1805984D-1*t87*t63
     &-0.9416746666666667D-3*t93*t67+0.5082568533333333D-1*t98*t71
     &-0.3679286613333333D-1*t104*t75+0.5304183466666667D-2*t111*t159)
      vrhob(i) = 0.D0
      t168 = sigmaaa*t18
      t171 = t14*t26
      t174 = t24*t35
      t180 = t32/t2/t25/t16
      vsigmaaa(i) = -0.9305257363491D0*t3*(-0.2976224D-2*t7*t11
     &+0.191079296D-3*t168*t21-0.201951168D-5*t171*t29+0.9812672D-8
     &*t174*t38-0.1840566272D-10*t180*t113)-0.3109D-1*t48*t60*(
     &-0.677244D-2*t7*t63+0.353128D-3*t168*t67-0.19059632D-1*t171*t71
     &+0.137973248D-1*t174*t75-0.19890688D-2*t180*t159)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t18 = t17*rhoa
      t20 = 1/t4/t18
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = t16*sigmaaa
      t27 = t17**2
      t28 = 1/t27
      t29 = t26*t28
      t31 = 1/t22/t12
      t34 = t16**2
      t37 = 1/t7/t27/t6
      t38 = t34*t37
      t39 = t22**2
      t40 = 1/t39
      t43 = 0.10932D1-0.2976224D-2*t10*t13+0.895872D-4*t21*t23
     &-0.43427136D-6*t29*t31+0.115035392D-8*t38*t40
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t49 = 1.D0+0.1274696188700087D0*t47
      t50 = rhoa*t49
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t58 = 0.1112037486309468D2*t51+0.3844746237447211D1*t47
     &+0.1644733775567609D1*t54+0.2405871291288192D0*t56
      t61 = 1.D0+0.321646831778707D2/t58
      t62 = dlog(t61)
      t64 = 1.D0+0.2D0*t10
      t65 = 1/t64
      t68 = t64**2
      t69 = 1/t68
      t73 = 1/t68/t64
      t76 = t68**2
      t77 = 1/t76
      t80 = 0.222601D0-0.677244D-2*t10*t65-0.50068D-3*t21*t69
     &-0.6419968D-2*t29*t73+0.2486336D-2*t38*t77
      t81 = t62*t80
      t84 = rhob**(1.D0/3.D0)
      t85 = t84*rhob
      t86 = rhob**2
      t87 = t84**2
      t89 = 1/t87/t86
      t90 = sigmabb*t89
      t92 = 1.D0+0.4D-2*t90
      t93 = 1/t92
      t96 = sigmabb**2
      t97 = t86**2
      t98 = t97*rhob
      t100 = 1/t84/t98
      t101 = t96*t100
      t102 = t92**2
      t103 = 1/t102
      t106 = t96*sigmabb
      t107 = t97**2
      t108 = 1/t107
      t109 = t106*t108
      t111 = 1/t102/t92
      t114 = t96**2
      t117 = 1/t87/t107/t86
      t118 = t114*t117
      t119 = t102**2
      t120 = 1/t119
      t123 = 0.10932D1-0.2976224D-2*t90*t93+0.895872D-4*t101*t103
     &-0.43427136D-6*t109*t111+0.115035392D-8*t118*t120
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t129 = 1.D0+0.1274696188700087D0*t127
      t130 = rhob*t129
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t138 = 0.1112037486309468D2*t131+0.3844746237447211D1*t127
     &+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t141 = 1.D0+0.321646831778707D2/t138
      t142 = dlog(t141)
      t144 = 1.D0+0.2D0*t90
      t145 = 1/t144
      t148 = t144**2
      t149 = 1/t148
      t153 = 1/t148/t144
      t156 = t148**2
      t157 = 1/t156
      t160 = 0.222601D0-0.677244D-2*t90*t145-0.50068D-3*t101*t149
     &-0.6419968D-2*t109*t153+0.2486336D-2*t118*t157
      t161 = t142*t160
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t168 = 1.D0+0.1325688999052018D0*t166
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t176 = 0.598255043577108D1*t169+0.2225569421150687D1*t166
     &+0.8004286349993634D0*t172+0.1897004325747559D0*t174
      t179 = 1.D0+0.160818243221511D2/t176
      t180 = dlog(t179)
      t182 = 0.62182D-1*t168*t180
      t184 = 1.D0+0.6901399211255825D-1*t166
      t189 = 0.8157414703487641D1*t169+0.2247591863577616D1*t166
     &+0.4300972471276643D0*t172+0.1911512595127338D0*t174
      t192 = 1.D0+0.2960857464321668D2/t189
      t193 = dlog(t192)
      t194 = t184*t193
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t210 = 1/t209
      t211 = t207*t210
      t213 = 1.D0-1.D0*t211
      t216 = 0.3799574853701528D-1*t194*t205*t213
      t218 = 1.D0+0.1274696188700087D0*t166
      t223 = 0.1112037486309468D2*t169+0.3844746237447211D1*t166
     &+0.1644733775567609D1*t172+0.2405871291288192D0*t174
      t226 = 1.D0+0.321646831778707D2/t223
      t227 = dlog(t226)
      t230 = -0.3109D-1*t218*t227+t182
      t231 = t230*t205
      t233 = 0.1923661050931536D1*t231*t211
      t240 = t164*(-t182+t216+t233)+0.3109D-1*t50*t62+0.3109D-1*t130
     &*t142
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t247 = 1/t246
      t250 = t243**2
      t251 = t246**2
      t252 = 1/t251
      t255 = t250*t243
      t257 = 1/t251/t246
      t260 = t250**2
      t261 = t251**2
      t262 = 1/t261
      t265 = 0.729974D0+0.2011722D-1*t243*t247-0.415548D-3*t250*t252
     &+0.174649824D-5*t255*t257-0.580422672D-8*t260*t262
      zk(i) = -0.9305257363491D0*t5*t43-0.3109D-1*t50*t81
     &-0.9305257363491D0*t85*t123-0.3109D-1*t130*t161+t240*t265
      t269 = t6*rhoa
      t272 = sigmaaa/t7/t269
      t275 = t17*t6
      t278 = t16/t4/t275
      t283 = t26/t27/rhoa
      t289 = t34/t7/t27/t269
      t296 = t34*sigmaaa/t4/t27/t275
      t298 = 1/t39/t12
      t304 = t49*t62
      t307 = 1/t56
      t308 = t46*t307
      t311 = t58**2
      t312 = 1/t311
      t314 = t51**2
      t315 = t314**2
      t318 = 1/t6
      t329 = -0.1853395810515781D1/t315/t51*t318-0.128158207914907D1
     &*t307*t318-0.8223668877838045D0/t54*t318-0.1603914194192128D0
     &/t47*t318
      t330 = 1/t61
      t344 = 1/t76/t64
      t352 = 1/t208
      t353 = 1/t174*t352
      t354 = t353*t180
      t355 = 0.2747799777968419D-2*t354
      t356 = t176**2
      t359 = t169**2
      t360 = t359**2
      t363 = 1/t360/t169*t352
      t367 = 1/t172*t352
      t370 = 1/t166*t352
      t375 = t168/t356*(-0.99709173929518D0*t363-0.7418564737168958D0
     &*t353-0.4002143174996817D0*t367-0.1264669550498372D0*t370)/t179
      t376 = 0.1D1*t375
      t380 = 0.8740794299481065D-3*t353*t193*t205*t213
      t381 = t189**2
      t394 = 0.1124999956683108D1*t184/t381*(-0.135956911724794D1*t363
     &-0.7491972878592054D0*t353-0.2150486235638321D0*t367
     &-0.1274341730084892D0*t370)/t192*t205*t213
      t395 = t196*t352
      t396 = 1.D0*t395
      t400 = 1.D0*t165
      t404 = 0.1333333333333333D1*t199*(t165-t396)
     &+0.1333333333333333D1*t203*(-t400+t395)
      t409 = t206*t196*t210
      t410 = 4.D0*t409
      t413 = t207/t209/t164
      t414 = 4.D0*t413
      t421 = t223**2
      t438 = 0.1923661050931536D1*(0.1321010150222857D-2*t353*t227
     &+0.1D1*t218/t421*(-0.1853395810515781D1*t363-0.128158207914907D1
     &*t353-0.8223668877838045D0*t367-0.1603914194192128D0*t370)/t226
     &-0.2747799777968419D-2*t354-0.1D1*t375)*t205*t211
      t442 = t231*t409
      t445 = 0.7694644203726145D1*t231*t413
      t459 = t243*t252
      t462 = t250*t257
      t465 = t255*t262
      t470 = t260/t261/t246
      s1 = -0.12407009817988D1*t4*t43-0.9305257363491D0*t5*
     &(0.7936597333333333D-2*t272*t13-0.5095447893333333D-3*t278*t23
     &+0.538536448D-5*t283*t31-0.2616712533333333D-7*t289*t40
     &+0.4908176725333333D-10*t296*t298)-0.3109D-1*t304*t80
     &+0.1321010150222857D-2*t308*t81
      vrhoa(i) = s1+0.1D1*t50*t312*t329*t330*t80-0.3109D-1*t50*t62*
     &(0.1805984D-1*t272*t65-0.9416746666666667D-3*t278*t69
     &+0.5082568533333333D-1*t283*t73-0.3679286613333333D-1*t289*t77
     &+0.5304183466666667D-2*t296*t344)+(-t182+t216+t233+t164*(t355
     &+t376-t380-t394+0.3799574853701528D-1*t194*t404*t213
     &+0.3799574853701528D-1*t194*t205*(-t410+t414)+t438
     &+0.1923661050931536D1*t230*t404*t211+0.7694644203726145D1*t442
     &-t445)+0.3109D-1*t304-0.1321010150222857D-2*t308*t62-0.1D1*t50
     &*t312*t329*t330)*t265+t240*(-0.2682296D-1*t272*t247
     &+0.126906576D-2*t459*t272-0.1363476096D-4*t462*t272
     &+0.728718336D-7*t465*t272-0.18573525504D-9*t470*t272)
      t477 = t86*rhob
      t480 = sigmabb/t87/t477
      t483 = t97*t86
      t486 = t96/t84/t483
      t491 = t106/t107/rhob
      t497 = t114/t87/t107/t477
      t504 = t114*sigmabb/t84/t107/t483
      t506 = 1/t119/t92
      t512 = t129*t142
      t515 = 1/t136
      t516 = t126*t515
      t519 = t138**2
      t520 = 1/t519
      t522 = t131**2
      t523 = t522**2
      t526 = 1/t86
      t537 = -0.1853395810515781D1/t523/t131*t526-0.128158207914907D1
     &*t515*t526-0.8223668877838045D0/t134*t526-0.1603914194192128D0
     &/t127*t526
      t538 = 1/t141
      t552 = 1/t156/t144
      t565 = 0.1333333333333333D1*t199*(-t400-t396)
     &+0.1333333333333333D1*t203*(t165+t395)
      s1 = -0.12407009817988D1*t84*t123-0.9305257363491D0*t85*
     &(0.7936597333333333D-2*t480*t93-0.5095447893333333D-3*t486*t103
     &+0.538536448D-5*t491*t111-0.2616712533333333D-7*t497*t120
     &+0.4908176725333333D-10*t504*t506)-0.3109D-1*t512*t160
     &+0.1321010150222857D-2*t516*t161
      vrhob(i) = s1+0.1D1*t130*t520*t537*t538*t160-0.3109D-1*t130*t142
     &*(0.1805984D-1*t480*t145-0.9416746666666667D-3*t486*t149
     &+0.5082568533333333D-1*t491*t153-0.3679286613333333D-1*t497*t157
     &+0.5304183466666667D-2*t504*t552)+(-t182+t216+t233+t164*(t355
     &+t376-t380-t394+0.3799574853701528D-1*t194*t565*t213
     &+0.3799574853701528D-1*t194*t205*(t410+t414)+t438
     &+0.1923661050931536D1*t230*t565*t211-0.7694644203726145D1*t442
     &-t445)+0.3109D-1*t512-0.1321010150222857D-2*t516*t142-0.1D1*t130
     &*t520*t537*t538)*t265+t240*(-0.2682296D-1*t480*t247
     &+0.126906576D-2*t459*t480-0.1363476096D-4*t462*t480
     &+0.728718336D-7*t465*t480-0.18573525504D-9*t470*t480)
      t602 = sigmaaa*t20
      t605 = t16*t28
      t608 = t26*t37
      t614 = t34/t4/t27/t18
      vsigmaaa(i) = -0.9305257363491D0*t5*(-0.2976224D-2*t9*t13
     &+0.191079296D-3*t602*t23-0.201951168D-5*t605*t31+0.9812672D-8
     &*t608*t40-0.1840566272D-10*t614*t298)-0.3109D-1*t50*t62*(
     &-0.677244D-2*t9*t65+0.353128D-3*t602*t69-0.19059632D-1*t605*t73
     &+0.137973248D-1*t608*t77-0.19890688D-2*t614*t344)+t240*
     &(0.1005861D-1*t9*t247-0.47589966D-3*t459*t9+0.511303536D-5*t462
     &*t9-0.273269376D-7*t465*t9+0.6965072064D-10*t470*t9)
      vsigmaab(i) = 0.D0
      t648 = sigmabb*t100
      t651 = t96*t108
      t654 = t106*t117
      t660 = t114/t84/t107/t98
      vsigmabb(i) = -0.9305257363491D0*t85*(-0.2976224D-2*t89*t93
     &+0.191079296D-3*t648*t103-0.201951168D-5*t651*t111+0.9812672D-8
     &*t654*t120-0.1840566272D-10*t660*t506)-0.3109D-1*t130*t142*(
     &-0.677244D-2*t89*t145+0.353128D-3*t648*t149-0.19059632D-1*t651
     &*t153+0.137973248D-1*t654*t157-0.19890688D-2*t660*t552)+t240*
     &(0.1005861D-1*t89*t247-0.47589966D-3*t459*t89+0.511303536D-5
     &*t462*t89-0.273269376D-7*t465*t89+0.6965072064D-10*t470*t89)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rhoa = dmax1(0.D0,rhoa1(i))
      rhob = dmax1(0.D0,rhob1(i))
      rho = rhoa+rhob
      if(rho.gt.tol) then
      if(rhoa.lt.tol) then
      rho = rhob
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmabb
      t2 = rhob**(1.D0/3.D0)
      t3 = t2*rhob
      t4 = rhob**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmabb*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmabb**2
      t15 = t4**2
      t16 = t15*rhob
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmabb
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.10932D1-0.2976224D-2*t8*t11+0.895872D-4*t19*t21
     &-0.43427136D-6*t27*t29+0.115035392D-8*t36*t38
      t44 = 1/rhob
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhob*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     &+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.222601D0-0.677244D-2*t8*t63-0.50068D-3*t19*t67
     &-0.6419968D-2*t27*t71+0.2486336D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      vrhoa(i) = 0.D0
      t84 = t4*rhob
      t87 = sigmabb/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhob
      t104 = t32/t5/t25/t84
      t107 = t32*sigmabb
      t111 = t107/t2/t25/t90
      t113 = 1/t37/t10
      t116 = 0.7936597333333333D-2*t87*t11-0.5095447893333333D-3*t93
     &*t21+0.538536448D-5*t98*t29-0.2616712533333333D-7*t104*t38
     &+0.4908176725333333D-10*t111*t113
      t119 = t47*t60
      t122 = 1/t54
      t123 = t44*t122
      t126 = t56**2
      t127 = 1/t126
      t128 = t48*t127
      t129 = t49**2
      t130 = t129**2
      t131 = t130*t49
      t132 = 1/t131
      t133 = 1/t4
      t138 = 1/t52
      t141 = 1/t45
      t144 = -0.1853395810515781D1*t132*t133-0.128158207914907D1*t122
     &*t133-0.8223668877838045D0*t138*t133-0.1603914194192128D0*t141
     &*t133
      t145 = 1/t59
      t146 = t144*t145
      t147 = t146*t78
      t159 = 1/t74/t62
      t162 = 0.1805984D-1*t87*t63-0.9416746666666667D-3*t93*t67
     &+0.5082568533333333D-1*t98*t71-0.3679286613333333D-1*t104*t75
     &+0.5304183466666667D-2*t111*t159
      t163 = t60*t162
      vrhob(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*t116
     &-0.3109D-1*t119*t78+0.1321010150222857D-2*t123*t79+0.1D1*t128
     &*t147-0.3109D-1*t48*t163
      vsigmaaa(i) = 0.D0
      vsigmaab(i) = 0.D0
      t168 = sigmabb*t18
      t171 = t14*t26
      t174 = t24*t35
      t179 = 1/t2/t25/t16
      t180 = t32*t179
      vsigmabb(i) = -0.9305257363491D0*t3*(-0.2976224D-2*t7*t11
     &+0.191079296D-3*t168*t21-0.201951168D-5*t171*t29+0.9812672D-8
     &*t174*t38-0.1840566272D-10*t180*t113)-0.3109D-1*t48*t60*(
     &-0.677244D-2*t7*t63+0.353128D-3*t168*t67-0.19059632D-1*t171*t71
     &+0.137973248D-1*t174*t75-0.19890688D-2*t180*t159)
      v2rhoa2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t207 = sigmabb/t5/t15
      t210 = t15*t84
      t213 = t14/t2/t210
      t217 = t24/t33
      t223 = t32/t5/t25/t15
      t229 = t107/t2/t25/t210
      t233 = t25**2
      t236 = t32*t14/t233/t4
      t238 = 1/t37/t20
      t249 = 1/t84
      t251 = 1/t54/t44
      t263 = t144**2
      t270 = 1/t15
      t296 = t126**2
      t299 = t59**2
      t319 = 1/t74/t66
      s1 = -0.4135669939329333D0/t5*t41-0.24814019635976D1*t2*t116
     &-0.9305257363491D0*t3*(-0.2910085688888889D-1*t207*t11
     &+0.3311774037333333D-2*t213*t21-0.5933856915911111D-4*t217*t29
     &+0.4776147922488889D-6*t223*t38-0.1819969344853333D-8*t229*t113
     &+0.2617694253511111D-11*t236*t238)+0.2D1*t47*t127*t147-0.6218D-1
     &*t119*t162+0.8806734334819047D-3*t249*t251*t79
      v2rhob2(i) = s1-0.8497974591333914D-1*t123*t127*t147
     &+0.2642020300445714D-2*t123*t163-0.2D1*t48/t126/t56*t263*t145
     &*t78+0.1D1*t128*(-0.1544496508763151D1/t131/t44*t270
     &+0.3706791621031562D1*t132*t249-0.854388052766047D0*t251*t270
     &+0.2563164158298141D1*t122*t249-0.4111834438919023D0/t52/t44
     &*t270+0.1644733775567609D1*t138*t249-0.5346380647307093D-1/t45
     &/t44*t270+0.3207828388384256D0*t141*t249)*t145*t78
     &+0.321646831778707D2*t48/t296*t263/t299*t78+0.2D1*t128*t146*t162
     &-0.3109D-1*t48*t60*(-0.6621941333333333D-1*t207*t63
     &+0.1559585422222222D-1*t213*t67-0.4584356209777778D0*t217*t71
     &+0.5105712014222222D0*t223*t75-0.15451807744D0*t229*t159
     &+0.1414448924444444D-1*t236*t319)
      v2sigmaaa2(i) = 0.D0
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t328 = sigmabb*t26
      t331 = t14*t35
      t334 = t24*t179
      t338 = t32/t233
      v2sigmabb2(i) = -0.9305257363491D0*t3*(0.202984192D-3*t18*t21
     &-0.5567657728D-5*t328*t29+0.5367215616D-7*t331*t38
     &-0.23062540288D-9*t334*t113+0.3681132544D-12*t338*t238)
     &-0.3109D-1*t48*t60*(0.1707616D-2*t18*t67-0.382605152D-1*t328*t71
     &+0.528277536D-1*t331*t75-0.1899413504D-1*t334*t159+0.19890688D-2
     &*t338*t319)
      elseif(rhob.lt.tol) then
      rho = rhoa
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigma = sigmaaa
      t2 = rhoa**(1.D0/3.D0)
      t3 = t2*rhoa
      t4 = rhoa**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigmaaa*t7
      t10 = 1.D0+0.4D-2*t8
      t11 = 1/t10
      t14 = sigmaaa**2
      t15 = t4**2
      t16 = t15*rhoa
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigmaaa
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.10932D1-0.2976224D-2*t8*t11+0.895872D-4*t19*t21
     &-0.43427136D-6*t27*t29+0.115035392D-8*t36*t38
      t44 = 1/rhoa
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1274696188700087D0*t45
      t48 = rhoa*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1112037486309468D2*t49+0.3844746237447211D1*t45
     &+0.1644733775567609D1*t52+0.2405871291288192D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.2D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.222601D0-0.677244D-2*t8*t63-0.50068D-3*t19*t67
     &-0.6419968D-2*t27*t71+0.2486336D-2*t36*t75
      t79 = t60*t78
      zk(i) = -0.9305257363491D0*t3*t41-0.3109D-1*t48*t79
      t84 = t4*rhoa
      t87 = sigmaaa/t5/t84
      t90 = t15*t4
      t93 = t14/t2/t90
      t98 = t24/t25/rhoa
      t104 = t32/t5/t25/t84
      t107 = t32*sigmaaa
      t111 = t107/t2/t25/t90
      t113 = 1/t37/t10
      t116 = 0.7936597333333333D-2*t87*t11-0.5095447893333333D-3*t93
     &*t21+0.538536448D-5*t98*t29-0.2616712533333333D-7*t104*t38
     &+0.4908176725333333D-10*t111*t113
      t119 = t47*t60
      t122 = 1/t54
      t123 = t44*t122
      t126 = t56**2
      t127 = 1/t126
      t128 = t48*t127
      t129 = t49**2
      t130 = t129**2
      t131 = t130*t49
      t132 = 1/t131
      t133 = 1/t4
      t138 = 1/t52
      t141 = 1/t45
      t144 = -0.1853395810515781D1*t132*t133-0.128158207914907D1*t122
     &*t133-0.8223668877838045D0*t138*t133-0.1603914194192128D0*t141
     &*t133
      t145 = 1/t59
      t146 = t144*t145
      t147 = t146*t78
      t159 = 1/t74/t62
      t162 = 0.1805984D-1*t87*t63-0.9416746666666667D-3*t93*t67
     &+0.5082568533333333D-1*t98*t71-0.3679286613333333D-1*t104*t75
     &+0.5304183466666667D-2*t111*t159
      t163 = t60*t162
      vrhoa(i) = -0.12407009817988D1*t2*t41-0.9305257363491D0*t3*t116
     &-0.3109D-1*t119*t78+0.1321010150222857D-2*t123*t79+0.1D1*t128
     &*t147-0.3109D-1*t48*t163
      vrhob(i) = 0.D0
      t168 = sigmaaa*t18
      t171 = t14*t26
      t174 = t24*t35
      t179 = 1/t2/t25/t16
      t180 = t32*t179
      vsigmaaa(i) = -0.9305257363491D0*t3*(-0.2976224D-2*t7*t11
     &+0.191079296D-3*t168*t21-0.201951168D-5*t171*t29+0.9812672D-8
     &*t174*t38-0.1840566272D-10*t180*t113)-0.3109D-1*t48*t60*(
     &-0.677244D-2*t7*t63+0.353128D-3*t168*t67-0.19059632D-1*t171*t71
     &+0.137973248D-1*t174*t75-0.19890688D-2*t180*t159)
      vsigmaab(i) = 0.D0
      vsigmabb(i) = 0.D0
      t207 = sigmaaa/t5/t15
      t210 = t15*t84
      t213 = t14/t2/t210
      t217 = t24/t33
      t223 = t32/t5/t25/t15
      t229 = t107/t2/t25/t210
      t233 = t25**2
      t236 = t32*t14/t233/t4
      t238 = 1/t37/t20
      t249 = 1/t84
      t251 = 1/t54/t44
      t263 = t144**2
      t270 = 1/t15
      t296 = t126**2
      t299 = t59**2
      t319 = 1/t74/t66
      s1 = -0.4135669939329333D0/t5*t41-0.24814019635976D1*t2*t116
     &-0.9305257363491D0*t3*(-0.2910085688888889D-1*t207*t11
     &+0.3311774037333333D-2*t213*t21-0.5933856915911111D-4*t217*t29
     &+0.4776147922488889D-6*t223*t38-0.1819969344853333D-8*t229*t113
     &+0.2617694253511111D-11*t236*t238)+0.2D1*t47*t127*t147-0.6218D-1
     &*t119*t162+0.8806734334819047D-3*t249*t251*t79
      v2rhoa2(i) = s1-0.8497974591333914D-1*t123*t127*t147
     &+0.2642020300445714D-2*t123*t163-0.2D1*t48/t126/t56*t263*t145
     &*t78+0.1D1*t128*(-0.1544496508763151D1/t131/t44*t270
     &+0.3706791621031562D1*t132*t249-0.854388052766047D0*t251*t270
     &+0.2563164158298141D1*t122*t249-0.4111834438919023D0/t52/t44
     &*t270+0.1644733775567609D1*t138*t249-0.5346380647307093D-1/t45
     &/t44*t270+0.3207828388384256D0*t141*t249)*t145*t78
     &+0.321646831778707D2*t48/t296*t263/t299*t78+0.2D1*t128*t146*t162
     &-0.3109D-1*t48*t60*(-0.6621941333333333D-1*t207*t63
     &+0.1559585422222222D-1*t213*t67-0.4584356209777778D0*t217*t71
     &+0.5105712014222222D0*t223*t75-0.15451807744D0*t229*t159
     &+0.1414448924444444D-1*t236*t319)
      v2rhob2(i) = 0.D0
      v2rhoab(i) = 0.D0
      t328 = sigmaaa*t26
      t331 = t14*t35
      t334 = t24*t179
      t338 = t32/t233
      v2sigmaaa2(i) = -0.9305257363491D0*t3*(0.202984192D-3*t18*t21
     &-0.5567657728D-5*t328*t29+0.5367215616D-7*t331*t38
     &-0.23062540288D-9*t334*t113+0.3681132544D-12*t338*t238)
     &-0.3109D-1*t48*t60*(0.1707616D-2*t18*t67-0.382605152D-1*t328*t71
     &+0.528277536D-1*t331*t75-0.1899413504D-1*t334*t159+0.19890688D-2
     &*t338*t319)
      v2sigmaaaab(i) = 0.D0
      v2sigmaaabb(i) = 0.D0
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      v2sigmabb2(i) = 0.D0
      else ! (.not.(rhoa.lt.tol).and..not.(rhob.lt.tol))
      sigmaaa = dmax1(0.D0,sigmaaa1(i))
      sigmaab = sigmaab1(i)
      sigmabb = dmax1(0.D0,sigmabb1(i))
      sigma = sigmaaa+sigmabb+2.D0*sigmaab
      t4 = rhoa**(1.D0/3.D0)
      t5 = t4*rhoa
      t6 = rhoa**2
      t7 = t4**2
      t9 = 1/t7/t6
      t10 = sigmaaa*t9
      t12 = 1.D0+0.4D-2*t10
      t13 = 1/t12
      t16 = sigmaaa**2
      t17 = t6**2
      t18 = t17*rhoa
      t20 = 1/t4/t18
      t21 = t16*t20
      t22 = t12**2
      t23 = 1/t22
      t26 = t16*sigmaaa
      t27 = t17**2
      t28 = 1/t27
      t29 = t26*t28
      t31 = 1/t22/t12
      t34 = t16**2
      t35 = t27*t6
      t37 = 1/t7/t35
      t38 = t34*t37
      t39 = t22**2
      t40 = 1/t39
      t43 = 0.10932D1-0.2976224D-2*t10*t13+0.895872D-4*t21*t23
     &-0.43427136D-6*t29*t31+0.115035392D-8*t38*t40
      t46 = 1/rhoa
      t47 = t46**(1.D0/3.D0)
      t49 = 1.D0+0.1274696188700087D0*t47
      t50 = rhoa*t49
      t51 = t46**(1.D0/6.D0)
      t54 = dsqrt(t46)
      t56 = t47**2
      t58 = 0.1112037486309468D2*t51+0.3844746237447211D1*t47
     &+0.1644733775567609D1*t54+0.2405871291288192D0*t56
      t61 = 1.D0+0.321646831778707D2/t58
      t62 = dlog(t61)
      t64 = 1.D0+0.2D0*t10
      t65 = 1/t64
      t68 = t64**2
      t69 = 1/t68
      t73 = 1/t68/t64
      t76 = t68**2
      t77 = 1/t76
      t80 = 0.222601D0-0.677244D-2*t10*t65-0.50068D-3*t21*t69
     &-0.6419968D-2*t29*t73+0.2486336D-2*t38*t77
      t81 = t62*t80
      t84 = rhob**(1.D0/3.D0)
      t85 = t84*rhob
      t86 = rhob**2
      t87 = t84**2
      t89 = 1/t87/t86
      t90 = sigmabb*t89
      t92 = 1.D0+0.4D-2*t90
      t93 = 1/t92
      t96 = sigmabb**2
      t97 = t86**2
      t98 = t97*rhob
      t100 = 1/t84/t98
      t101 = t96*t100
      t102 = t92**2
      t103 = 1/t102
      t106 = t96*sigmabb
      t107 = t97**2
      t108 = 1/t107
      t109 = t106*t108
      t111 = 1/t102/t92
      t114 = t96**2
      t115 = t107*t86
      t117 = 1/t87/t115
      t118 = t114*t117
      t119 = t102**2
      t120 = 1/t119
      t123 = 0.10932D1-0.2976224D-2*t90*t93+0.895872D-4*t101*t103
     &-0.43427136D-6*t109*t111+0.115035392D-8*t118*t120
      t126 = 1/rhob
      t127 = t126**(1.D0/3.D0)
      t129 = 1.D0+0.1274696188700087D0*t127
      t130 = rhob*t129
      t131 = t126**(1.D0/6.D0)
      t134 = dsqrt(t126)
      t136 = t127**2
      t138 = 0.1112037486309468D2*t131+0.3844746237447211D1*t127
     &+0.1644733775567609D1*t134+0.2405871291288192D0*t136
      t141 = 1.D0+0.321646831778707D2/t138
      t142 = dlog(t141)
      t144 = 1.D0+0.2D0*t90
      t145 = 1/t144
      t148 = t144**2
      t149 = 1/t148
      t153 = 1/t148/t144
      t156 = t148**2
      t157 = 1/t156
      t160 = 0.222601D0-0.677244D-2*t90*t145-0.50068D-3*t101*t149
     &-0.6419968D-2*t109*t153+0.2486336D-2*t118*t157
      t161 = t142*t160
      t164 = rhoa+rhob
      t165 = 1/t164
      t166 = t165**(1.D0/3.D0)
      t168 = 1.D0+0.1325688999052018D0*t166
      t169 = t165**(1.D0/6.D0)
      t172 = dsqrt(t165)
      t174 = t166**2
      t176 = 0.598255043577108D1*t169+0.2225569421150687D1*t166
     &+0.8004286349993634D0*t172+0.1897004325747559D0*t174
      t179 = 1.D0+0.160818243221511D2/t176
      t180 = dlog(t179)
      t182 = 0.62182D-1*t168*t180
      t184 = 1.D0+0.6901399211255825D-1*t166
      t189 = 0.8157414703487641D1*t169+0.2247591863577616D1*t166
     &+0.4300972471276643D0*t172+0.1911512595127338D0*t174
      t192 = 1.D0+0.2960857464321668D2/t189
      t193 = dlog(t192)
      t194 = t184*t193
      t196 = rhoa-1.D0*rhob
      t197 = t196*t165
      t198 = 1.D0+t197
      t199 = t198**(1.D0/3.D0)
      t202 = 1.D0-1.D0*t197
      t203 = t202**(1.D0/3.D0)
      t205 = t199*t198+t203*t202-2.D0
      t206 = t196**2
      t207 = t206**2
      t208 = t164**2
      t209 = t208**2
      t210 = 1/t209
      t211 = t207*t210
      t213 = 1.D0-1.D0*t211
      t214 = t205*t213
      t216 = 0.3799574853701528D-1*t194*t214
      t218 = 1.D0+0.1274696188700087D0*t166
      t223 = 0.1112037486309468D2*t169+0.3844746237447211D1*t166
     &+0.1644733775567609D1*t172+0.2405871291288192D0*t174
      t226 = 1.D0+0.321646831778707D2/t223
      t227 = dlog(t226)
      t230 = -0.3109D-1*t218*t227+t182
      t231 = t230*t205
      t233 = 0.1923661050931536D1*t231*t211
      t240 = t164*(-t182+t216+t233)+0.3109D-1*t50*t62+0.3109D-1*t130
     &*t142
      t243 = 0.5D0*t10+0.5D0*t90
      t246 = 1.D0+0.3D-2*t10+0.3D-2*t90
      t247 = 1/t246
      t250 = t243**2
      t251 = t246**2
      t252 = 1/t251
      t255 = t250*t243
      t257 = 1/t251/t246
      t260 = t250**2
      t261 = t251**2
      t262 = 1/t261
      t265 = 0.729974D0+0.2011722D-1*t243*t247-0.415548D-3*t250*t252
     &+0.174649824D-5*t255*t257-0.580422672D-8*t260*t262
      zk(i) = -0.9305257363491D0*t5*t43-0.3109D-1*t50*t81
     &-0.9305257363491D0*t85*t123-0.3109D-1*t130*t161+t240*t265
      t269 = t6*rhoa
      t271 = 1/t7/t269
      t272 = sigmaaa*t271
      t275 = t17*t6
      t277 = 1/t4/t275
      t278 = t16*t277
      t282 = 1/t27/rhoa
      t283 = t26*t282
      t288 = 1/t7/t27/t269
      t289 = t34*t288
      t292 = t34*sigmaaa
      t295 = 1/t4/t27/t275
      t296 = t292*t295
      t298 = 1/t39/t12
      t301 = 0.7936597333333333D-2*t272*t13-0.5095447893333333D-3*t278
     &*t23+0.538536448D-5*t283*t31-0.2616712533333333D-7*t289*t40
     &+0.4908176725333333D-10*t296*t298
      t304 = t49*t62
      t307 = 1/t56
      t308 = t46*t307
      t311 = t58**2
      t312 = 1/t311
      t313 = t50*t312
      t314 = t51**2
      t315 = t314**2
      t316 = t315*t51
      t317 = 1/t316
      t318 = 1/t6
      t323 = 1/t54
      t326 = 1/t47
      t329 = -0.1853395810515781D1*t317*t318-0.128158207914907D1*t307
     &*t318-0.8223668877838045D0*t323*t318-0.1603914194192128D0*t326
     &*t318
      t330 = 1/t61
      t331 = t329*t330
      t332 = t331*t80
      t344 = 1/t76/t64
      t347 = 0.1805984D-1*t272*t65-0.9416746666666667D-3*t278*t69
     &+0.5082568533333333D-1*t283*t73-0.3679286613333333D-1*t289*t77
     &+0.5304183466666667D-2*t296*t344
      t348 = t62*t347
      t351 = 1/t174
      t352 = 1/t208
      t353 = t351*t352
      t354 = t353*t180
      t355 = 0.2747799777968419D-2*t354
      t356 = t176**2
      t357 = 1/t356
      t358 = t168*t357
      t359 = t169**2
      t360 = t359**2
      t361 = t360*t169
      t362 = 1/t361
      t363 = t362*t352
      t366 = 1/t172
      t367 = t366*t352
      t369 = 1/t166
      t370 = t369*t352
      t372 = -0.99709173929518D0*t363-0.7418564737168958D0*t353
     &-0.4002143174996817D0*t367-0.1264669550498372D0*t370
      t373 = 1/t179
      t375 = t358*t372*t373
      t376 = 0.1D1*t375
      t377 = t193*t205
      t378 = t377*t213
      t379 = t353*t378
      t380 = 0.8740794299481065D-3*t379
      t381 = t189**2
      t382 = 1/t381
      t383 = t184*t382
      t388 = -0.135956911724794D1*t363-0.7491972878592054D0*t353
     &-0.2150486235638321D0*t367-0.1274341730084892D0*t370
      t389 = t383*t388
      t390 = 1/t192
      t391 = t390*t205
      t392 = t391*t213
      t393 = t389*t392
      t394 = 0.1124999956683108D1*t393
      t395 = t196*t352
      t396 = 1.D0*t395
      t397 = t165-t396
      t400 = 1.D0*t165
      t401 = -t400+t395
      t404 = 0.1333333333333333D1*t199*t397+0.1333333333333333D1*t203
     &*t401
      t406 = t194*t404*t213
      t407 = 0.3799574853701528D-1*t406
      t408 = t206*t196
      t409 = t408*t210
      t410 = 4.D0*t409
      t412 = 1/t209/t164
      t413 = t207*t412
      t414 = 4.D0*t413
      t415 = -t410+t414
      t417 = t194*t205*t415
      t418 = 0.3799574853701528D-1*t417
      t421 = t223**2
      t422 = 1/t421
      t423 = t218*t422
      t428 = -0.1853395810515781D1*t363-0.128158207914907D1*t353
     &-0.8223668877838045D0*t367-0.1603914194192128D0*t370
      t429 = 1/t226
      t435 = 0.1321010150222857D-2*t353*t227+0.1D1*t423*t428*t429
     &-0.2747799777968419D-2*t354-0.1D1*t375
      t436 = t435*t205
      t437 = t436*t211
      t438 = 0.1923661050931536D1*t437
      t439 = t230*t404
      t440 = t439*t211
      t441 = 0.1923661050931536D1*t440
      t442 = t231*t409
      t444 = t231*t413
      t445 = 0.7694644203726145D1*t444
      t452 = t312*t329*t330
      t455 = -t182+t216+t233+t164*(t355+t376-t380-t394+t407+t418+t438
     &+t441+0.7694644203726145D1*t442-t445)+0.3109D-1*t304
     &-0.1321010150222857D-2*t308*t62-0.1D1*t50*t452
      t459 = t243*t252
      t462 = t250*t257
      t465 = t255*t262
      t469 = 1/t261/t246
      t470 = t260*t469
      t473 = -0.2682296D-1*t272*t247+0.126906576D-2*t459*t272
     &-0.1363476096D-4*t462*t272+0.728718336D-7*t465*t272
     &-0.18573525504D-9*t470*t272
      vrhoa(i) = -0.12407009817988D1*t4*t43-0.9305257363491D0*t5*t301
     &-0.3109D-1*t304*t80+0.1321010150222857D-2*t308*t81+0.1D1*t313
     &*t332-0.3109D-1*t50*t348+t455*t265+t240*t473
      t477 = t86*rhob
      t479 = 1/t87/t477
      t480 = sigmabb*t479
      t483 = t97*t86
      t485 = 1/t84/t483
      t486 = t96*t485
      t490 = 1/t107/rhob
      t491 = t106*t490
      t496 = 1/t87/t107/t477
      t497 = t114*t496
      t500 = t114*sigmabb
      t503 = 1/t84/t107/t483
      t504 = t500*t503
      t506 = 1/t119/t92
      t509 = 0.7936597333333333D-2*t480*t93-0.5095447893333333D-3*t486
     &*t103+0.538536448D-5*t491*t111-0.2616712533333333D-7*t497*t120
     &+0.4908176725333333D-10*t504*t506
      t512 = t129*t142
      t515 = 1/t136
      t516 = t126*t515
      t519 = t138**2
      t520 = 1/t519
      t521 = t130*t520
      t522 = t131**2
      t523 = t522**2
      t524 = t523*t131
      t525 = 1/t524
      t526 = 1/t86
      t531 = 1/t134
      t534 = 1/t127
      t537 = -0.1853395810515781D1*t525*t526-0.128158207914907D1*t515
     &*t526-0.8223668877838045D0*t531*t526-0.1603914194192128D0*t534
     &*t526
      t538 = 1/t141
      t539 = t537*t538
      t540 = t539*t160
      t552 = 1/t156/t144
      t555 = 0.1805984D-1*t480*t145-0.9416746666666667D-3*t486*t149
     &+0.5082568533333333D-1*t491*t153-0.3679286613333333D-1*t497*t157
     &+0.5304183466666667D-2*t504*t552
      t556 = t142*t555
      t559 = -t400-t396
      t562 = t165+t395
      t565 = 0.1333333333333333D1*t199*t559+0.1333333333333333D1*t203
     &*t562
      t567 = t194*t565*t213
      t568 = 0.3799574853701528D-1*t567
      t569 = t410+t414
      t571 = t194*t205*t569
      t572 = 0.3799574853701528D-1*t571
      t573 = t230*t565
      t574 = t573*t211
      t575 = 0.1923661050931536D1*t574
      t583 = t520*t537*t538
      t586 = -t182+t216+t233+t164*(t355+t376-t380-t394+t568+t572+t438
     &+t575-0.7694644203726145D1*t442-t445)+0.3109D-1*t512
     &-0.1321010150222857D-2*t516*t142-0.1D1*t130*t583
      t598 = -0.2682296D-1*t480*t247+0.126906576D-2*t459*t480
     &-0.1363476096D-4*t462*t480+0.728718336D-7*t465*t480
     &-0.18573525504D-9*t470*t480
      vrhob(i) = -0.12407009817988D1*t84*t123-0.9305257363491D0*t85
     &*t509-0.3109D-1*t512*t160+0.1321010150222857D-2*t516*t161+0.1D1
     &*t521*t540-0.3109D-1*t130*t556+t586*t265+t240*t598
      t602 = sigmaaa*t20
      t605 = t16*t28
      t608 = t26*t37
      t613 = 1/t4/t27/t18
      t614 = t34*t613
      t617 = -0.2976224D-2*t9*t13+0.191079296D-3*t602*t23
     &-0.201951168D-5*t605*t31+0.9812672D-8*t608*t40-0.1840566272D-10
     &*t614*t298
      t630 = -0.677244D-2*t9*t65+0.353128D-3*t602*t69-0.19059632D-1
     &*t605*t73+0.137973248D-1*t608*t77-0.19890688D-2*t614*t344
      t631 = t62*t630
      t644 = 0.1005861D-1*t9*t247-0.47589966D-3*t459*t9+0.511303536D-5
     &*t462*t9-0.273269376D-7*t465*t9+0.6965072064D-10*t470*t9
      vsigmaaa(i) = -0.9305257363491D0*t5*t617-0.3109D-1*t50*t631+t240
     &*t644
      vsigmaab(i) = 0.D0
      t648 = sigmabb*t100
      t651 = t96*t108
      t654 = t106*t117
      t659 = 1/t84/t107/t98
      t660 = t114*t659
      t663 = -0.2976224D-2*t89*t93+0.191079296D-3*t648*t103
     &-0.201951168D-5*t651*t111+0.9812672D-8*t654*t120
     &-0.1840566272D-10*t660*t506
      t676 = -0.677244D-2*t89*t145+0.353128D-3*t648*t149-0.19059632D-1
     &*t651*t153+0.137973248D-1*t654*t157-0.19890688D-2*t660*t552
      t677 = t142*t676
      t690 = 0.1005861D-1*t89*t247-0.47589966D-3*t459*t89
     &+0.511303536D-5*t462*t89-0.273269376D-7*t465*t89
     &+0.6965072064D-10*t470*t89
      vsigmabb(i) = -0.9305257363491D0*t85*t663-0.3109D-1*t130*t677
     &+t240*t690
      t694 = sigmaaa/t7/t17
      t697 = t17*t269
      t700 = t16/t4/t697
      t704 = t26/t35
      t710 = t34/t7/t27/t17
      t716 = t292/t4/t27/t697
      t720 = t27**2
      t723 = t34*t16/t720/t6
      t725 = 1/t39/t22
      t736 = 0.2D1*t375
      t739 = 0.1538928840745229D2*t444
      t740 = 0.3847322101863073D1*t437
      t741 = 0.1748158859896213D-2*t379
      t742 = 0.2249999913366216D1*t393
      t744 = 0.5495599555936838D-2*t354
      t751 = 1/t361/t165*t210
      t754 = 1/t208/t164
      t755 = t362*t754
      t759 = 1/t174/t165*t210
      t761 = t351*t754
      t765 = 1/t172/t165*t210
      t767 = t366*t754
      t771 = 1/t166/t165*t210
      t773 = t369*t754
      t777 = t358*(-0.8309097827459833D0*t751+0.199418347859036D1*t755
     &-0.4945709824779306D0*t759+0.1483712947433792D1*t761
     &-0.2001071587498409D0*t765+0.8004286349993634D0*t767
     &-0.4215565168327908D-1*t771+0.2529339100996745D0*t773)*t373
      t778 = 0.1D1*t777
      t782 = t372**2
      t784 = t168/t356/t176*t782*t373
      t785 = 0.2D1*t784
      t787 = 0.1748158859896213D-2*t761*t378
      t788 = t759*t180
      t789 = 0.1831866518645613D-2*t788
      t790 = t761*t180
      t791 = 0.5495599555936838D-2*t790
      t794 = t353*t357*t372*t373
      t795 = 0.8837926660346786D-1*t794
      t796 = t356**2
      t799 = t179**2
      t802 = t168/t796*t782/t799
      t803 = 0.160818243221511D2*t802
      t815 = t428**2
      t831 = t421**2
      t834 = t226**2
      t845 = 0.8806734334819047D-3*t759*t227-0.2642020300445714D-2
     &*t761*t227-0.8497974591333914D-1*t353*t422*t428*t429-0.2D1*t218
     &/t421/t223*t815*t429+0.1D1*t423*(-0.1544496508763151D1*t751
     &+0.3706791621031562D1*t755-0.854388052766047D0*t759
     &+0.2563164158298141D1*t761-0.4111834438919023D0*t765
     &+0.1644733775567609D1*t767-0.5346380647307093D-1*t771
     &+0.3207828388384256D0*t773)*t429+0.321646831778707D2*t218/t831
     &*t815/t834-0.1831866518645613D-2*t788+0.5495599555936838D-2*t790
     &+0.8837926660346786D-1*t794+0.2D1*t784-0.1D1*t777
     &-0.160818243221511D2*t802
      t848 = 0.1923661050931536D1*t845*t205*t211
      t849 = t199**2
      t850 = 1/t849
      t851 = t397**2
      t854 = 2.D0*t352
      t856 = 2.D0*t196*t754
      t857 = -t854+t856
      t860 = t203**2
      t861 = 1/t860
      t862 = t401**2
      t868 = 0.4444444444444444D0*t850*t851+0.1333333333333333D1*t199
     &*t857+0.4444444444444444D0*t861*t862-0.1333333333333333D1*t203
     &*t857
      t872 = t381**2
      t875 = t388**2
      t877 = t192**2
      t882 = 0.3330964519106732D2*t184/t872*t875/t877*t205*t213
      t884 = t389*t391*t415
      t888 = t389*t390*t404*t213
      t895 = 0.2249999913366216D1*t184/t381/t189*t875*t392
      t896 = 0.7599149707403056D-1*t194*t404*t415+t778-t785+t787+t789
     &-t791-t795+t803+t848+0.3799574853701528D-1*t194*t868*t213-t882
     &-0.2249999913366216D1*t884-0.2249999913366216D1*t888+t895
      t908 = 0.1124999956683108D1*t383*(-0.1132974264373283D1*t751
     &+0.271913823449588D1*t755-0.4994648585728036D0*t759
     &+0.1498394575718411D1*t761-0.1075243117819161D0*t765
     &+0.4300972471276643D0*t767-0.4247805766949639D-1*t771
     &+0.2548683460169784D0*t773)*t392
      t910 = 0.5827196199654043D-3*t759*t378
      t913 = t353*t193*t404*t213
      t916 = t353*t377*t415
      t922 = 0.5176049209143758D-1*t353*t382*t388*t390*t214
      t923 = t436*t409
      t926 = 0.1538928840745229D2*t436*t413
      t928 = t435*t404*t211
      t930 = t206*t210
      t931 = t231*t930
      t932 = 0.2308393261117844D2*t931
      t933 = t408*t412
      t934 = t231*t933
      t936 = 12.D0*t930
      t937 = 32.D0*t933
      t940 = t207/t209/t208
      t941 = 20.D0*t940
      t946 = t439*t413
      t948 = t439*t409
      t954 = 0.3847322101863073D2*t231*t940
      t955 = -t908-t910-0.1748158859896213D-2*t913
     &-0.1748158859896213D-2*t916+t922+0.1538928840745229D2*t923-t926
     &+0.3847322101863073D1*t928+t932-0.6155715362980916D2*t934
     &+0.3799574853701528D-1*t194*t205*(-t936+t937-t941)
     &-0.1538928840745229D2*t946+0.1538928840745229D2*t948
     &+0.1923661050931536D1*t230*t868*t211+t954
      t960 = 1/t17
      t963 = 1/t269
      t967 = 1/t56/t46
      t984 = -0.1544496508763151D1/t316/t46*t960+0.3706791621031562D1
     &*t317*t963-0.854388052766047D0*t967*t960+0.2563164158298141D1
     &*t307*t963-0.4111834438919023D0/t54/t46*t960
     &+0.1644733775567609D1*t323*t963-0.5346380647307093D-1/t47/t46
     &*t960+0.3207828388384256D0*t326*t963
      t990 = 1/t311/t58
      t991 = t329**2
      t996 = t963*t967
      t1001 = t49*t312
      t1004 = t311**2
      t1005 = 1/t1004
      t1007 = t61**2
      t1008 = 1/t1007
      t1012 = t736+0.3847322101863073D1*t440+0.1538928840745229D2*t442
     &-t739+t740-t741-t742+0.7599149707403056D-1*t406+t744
     &+0.7599149707403056D-1*t417+t164*(t896+t955)-0.1D1*t50*t312*t984
     &*t330+0.2D1*t50*t990*t991*t330-0.8806734334819047D-3*t996*t62
     &+0.8497974591333914D-1*t308*t452-0.2D1*t1001*t331
     &-0.321646831778707D2*t50*t1005*t991*t1008
      t1031 = 1/t76/t68
      t1066 = t243*t257
      t1071 = t250*t262
      t1076 = t255*t469
      t1083 = t260/t261/t251
      s1 = -0.9305257363491D0*t5*(-0.2910085688888889D-1*t694*t13
     &+0.3311774037333333D-2*t700*t23-0.5933856915911111D-4*t704*t31
     &+0.4776147922488889D-6*t710*t40-0.1819969344853333D-8*t716*t298
     &+0.2617694253511111D-11*t723*t725)-0.4135669939329333D0/t7*t43
     &-0.24814019635976D1*t4*t301+t1012*t265+0.2642020300445714D-2
     &*t308*t348+0.2D1*t1001*t332-0.6218D-1*t304*t347-0.3109D-1*t50
     &*t62*(-0.6621941333333333D-1*t694*t65+0.1559585422222222D-1*t700
     &*t69-0.4584356209777778D0*t704*t73+0.5105712014222222D0*t710*t77
     &-0.15451807744D0*t716*t344+0.1414448924444444D-1*t723*t1031)
      v2rhoa2(i) = s1+0.1D1*t313*t984*t330*t80-0.2D1*t50*t990*t991
     &*t330*t80-0.8497974591333914D-1*t308*t312*t332
     &+0.8806734334819047D-3*t996*t81+0.321646831778707D2*t50*t1005
     &*t991*t1008*t80+0.2D1*t313*t331*t347+2.D0*t455*t473+t240*
     &(0.9835085333333333D-1*t694*t247-0.190667136D-2*t700*t252
     &+0.5666441472D-4*t1066*t700-0.465324112D-2*t459*t694
     &-0.61872159744D-6*t1071*t700+0.4999412352D-4*t462*t694
     &+0.332248670208D-8*t1076*t700-0.2671967232D-6*t465*t694
     &-0.74294102016D-11*t1083*t700+0.68102926848D-9*t470*t694)
      t1092 = sigmabb/t87/t97
      t1095 = t97*t477
      t1098 = t96/t84/t1095
      t1102 = t106/t115
      t1108 = t114/t87/t107/t97
      t1114 = t500/t84/t107/t1095
      t1118 = t107**2
      t1121 = t114*t96/t1118/t86
      t1123 = 1/t119/t102
      t1134 = t519**2
      t1135 = 1/t1134
      t1137 = t537**2
      t1138 = t141**2
      t1139 = 1/t1138
      t1146 = 1/t97
      t1149 = 1/t477
      t1153 = 1/t136/t126
      t1170 = -0.1544496508763151D1/t524/t126*t1146
     &+0.3706791621031562D1*t525*t1149-0.854388052766047D0*t1153*t1146
     &+0.2563164158298141D1*t515*t1149-0.4111834438919023D0/t134/t126
     &*t1146+0.1644733775567609D1*t531*t1149-0.5346380647307093D-1
     &/t127/t126*t1146+0.3207828388384256D0*t534*t1149
      t1176 = 1/t519/t138
      t1184 = t1149*t1153
      t1190 = t129*t520
      t1206 = t559**2
      t1209 = t854+t856
      t1212 = t562**2
      t1218 = 0.4444444444444444D0*t850*t1206+0.1333333333333333D1
     &*t199*t1209+0.4444444444444444D0*t861*t1212-0.1333333333333333D1
     &*t203*t1209
      t1227 = t353*t193*t565*t213
      t1230 = t353*t377*t569
      t1232 = t573*t409
      t1234 = t573*t413
      t1240 = t435*t565*t211
      t1242 = 0.3799574853701528D-1*t194*t205*(-t936-t937-t941)
     &+0.3799574853701528D-1*t194*t1218*t213+0.7599149707403056D-1
     &*t194*t565*t569-0.1748158859896213D-2*t1227
     &-0.1748158859896213D-2*t1230-0.1538928840745229D2*t1232
     &-0.1538928840745229D2*t1234+0.1923661050931536D1*t230*t1218*t211
     &+0.3847322101863073D1*t1240+t778-t785+t787+t789-t791
      t1245 = t389*t390*t565*t213
      t1248 = t389*t391*t569
      t1252 = -t795+t803+t848-0.2249999913366216D1*t1245-t882+t895
     &-t908-t910-0.2249999913366216D1*t1248+t922-0.1538928840745229D2
     &*t923-t926+t932+0.6155715362980916D2*t934+t954
      t1273 = t736-0.1538928840745229D2*t442-t739+t740-t741-t742+t744
     &+0.3847322101863073D1*t574+0.7599149707403056D-1*t571
     &+0.7599149707403056D-1*t567+t164*(t1242+t1252)-0.2D1*t1190*t539
     &-0.321646831778707D2*t130*t1135*t1137*t1139-0.1D1*t130*t520
     &*t1170*t538+0.2D1*t130*t1176*t1137*t538-0.8806734334819047D-3
     &*t1184*t142+0.8497974591333914D-1*t516*t583
      t1286 = 1/t156/t148
      s1 = -0.9305257363491D0*t85*(-0.2910085688888889D-1*t1092*t93
     &+0.3311774037333333D-2*t1098*t103-0.5933856915911111D-4*t1102
     &*t111+0.4776147922488889D-6*t1108*t120-0.1819969344853333D-8
     &*t1114*t506+0.2617694253511111D-11*t1121*t1123)
     &-0.4135669939329333D0/t87*t123-0.24814019635976D1*t84*t509
     &+0.321646831778707D2*t130*t1135*t1137*t1139*t160+0.1D1*t521
     &*t1170*t538*t160-0.2D1*t130*t1176*t1137*t538*t160
     &+0.2642020300445714D-2*t516*t556+0.8806734334819047D-3*t1184*t161
      v2rhob2(i) = s1-0.8497974591333914D-1*t516*t520*t540+0.2D1*t1190
     &*t540+0.2D1*t521*t539*t555-0.6218D-1*t512*t555+t1273*t265
     &-0.3109D-1*t130*t142*(-0.6621941333333333D-1*t1092*t145
     &+0.1559585422222222D-1*t1098*t149-0.4584356209777778D0*t1102
     &*t153+0.5105712014222222D0*t1108*t157-0.15451807744D0*t1114*t552
     &+0.1414448924444444D-1*t1121*t1286)+t240*(0.9835085333333333D-1
     &*t1092*t247-0.190667136D-2*t1098*t252+0.5666441472D-4*t1066
     &*t1098-0.465324112D-2*t459*t1092-0.61872159744D-6*t1071*t1098
     &+0.4999412352D-4*t462*t1092+0.332248670208D-8*t1076*t1098
     &-0.2671967232D-6*t465*t1092-0.74294102016D-11*t1083*t1098
     &+0.68102926848D-9*t470*t1092)+2.D0*t586*t598
      t1325 = -0.8740794299481065D-3*t1227-0.8740794299481065D-3*t1230
     &+0.7694644203726145D1*t1232-0.7694644203726145D1*t1234
     &+0.1923661050931536D1*t1240+t778-t785+t787+t789-t791-t795+t803
     &+t848-0.1124999956683108D1*t1245-t882-0.1124999956683108D1*t884
     &-0.1124999956683108D1*t888
      t1355 = 0.4444444444444444D0*t850*t397*t559+0.2666666666666667D1
     &*t199*t196*t754+0.4444444444444444D0*t861*t401*t562
     &-0.2666666666666667D1*t203*t196*t754
      t1362 = t895-t908-t910-0.1124999956683108D1*t1248
     &-0.8740794299481065D-3*t913-0.8740794299481065D-3*t916+t922-t926
     &+0.1923661050931536D1*t928-0.2308393261117844D2*t931
     &-0.7694644203726145D1*t946-0.7694644203726145D1*t948+t954
     &+0.3799574853701528D-1*t194*t404*t569+0.3799574853701528D-1*t194
     &*t205*(t936-t941)+0.3799574853701528D-1*t194*t565*t415
     &+0.3799574853701528D-1*t194*t1355*t213+0.1923661050931536D1*t230
     &*t1355*t211
      t1365 = t744+t736-t741-t742+t568+t572+t740+t575-t739+t407+t418
     &+t441+t164*(t1325+t1362)
      t1378 = t271*sigmabb*t479
      v2rhoab(i) = 0.1D1*t1365*t265+0.1D1*t455*t598+0.1D1*t586*t473
     &+0.1D1*t240*(-0.190667136D-2*t272*t252*sigmabb*t479
     &+0.5666441472D-4*t1066*sigmaaa*t1378-0.61872159744D-6*t1071
     &*sigmaaa*t1378+0.332248670208D-8*t1076*sigmaaa*t1378
     &-0.74294102016D-11*t1083*sigmaaa*t1378)
      t1397 = sigmaaa*t277
      t1400 = t16*t282
      t1403 = t26*t288
      t1406 = t34*t295
      t1411 = t292/t720/rhoa
      s1 = -0.12407009817988D1*t4*t617-0.9305257363491D0*t5*
     &(0.7936597333333333D-2*t271*t13-0.1050835968D-2*t1397*t23
     &+0.2023245175466667D-4*t1400*t31-0.1692928750933333D-6*t1403*t40
     &+0.6640828416D-9*t1406*t298-0.9816353450666667D-12*t1411*t725)
     &-0.3109D-1*t304*t630+0.1321010150222857D-2*t308*t631
      v2rhoasigmaaa(i) = s1+0.1D1*t313*t331*t630-0.3109D-1*t50*t62*
     &(0.1805984D-1*t271*t65-0.5495317333333333D-2*t1397*t69
     &+0.1528537258666667D0*t1400*t73-0.1776668757333333D0*t1403*t77
     &+0.5595521024D-1*t1406*t344-0.5304183466666667D-2*t1411*t1031)
     &+t455*t644+t240*(-0.2682296D-1*t271*t247+0.71500176D-3*t1397
     &*t252-0.2124915552D-4*t1066*t1397+0.126906576D-2*t459*t271
     &+0.23202059904D-6*t1071*t1397-0.1363476096D-4*t462*t271
     &-0.124593251328D-8*t1076*t1397+0.728718336D-7*t465*t271
     &+0.27860288256D-11*t1083*t1397-0.18573525504D-9*t470*t271)
      v2rhoasigmaab(i) = 0.D0
      t1467 = t272*t89
      v2rhoasigmabb(i) = t455*t690+t240*(0.71500176D-3*t272*t252*t89
     &-0.2124915552D-4*t1066*t1467+0.23202059904D-6*t1071*t1467
     &-0.124593251328D-8*t1076*t1467+0.27860288256D-11*t1083*t1467)
      t1479 = t252*t9
      t1482 = t480*t9
      v2rhobsigmaaa(i) = t586*t644+t240*(0.71500176D-3*t480*t1479
     &-0.2124915552D-4*t1066*t1482+0.23202059904D-6*t1071*t1482
     &-0.124593251328D-8*t1076*t1482+0.27860288256D-11*t1083*t1482)
      v2rhobsigmaab(i) = 0.D0
      t1497 = sigmabb*t485
      t1500 = t96*t490
      t1503 = t106*t496
      t1506 = t114*t503
      t1511 = t500/t1118/rhob
      s1 = -0.12407009817988D1*t84*t663-0.9305257363491D0*t85*
     &(0.7936597333333333D-2*t479*t93-0.1050835968D-2*t1497*t103
     &+0.2023245175466667D-4*t1500*t111-0.1692928750933333D-6*t1503
     &*t120+0.6640828416D-9*t1506*t506-0.9816353450666667D-12*t1511
     &*t1123)-0.3109D-1*t512*t676+0.1321010150222857D-2*t516*t677
      v2rhobsigmabb(i) = s1+0.1D1*t521*t539*t676-0.3109D-1*t130*t142*
     &(0.1805984D-1*t479*t145-0.5495317333333333D-2*t1497*t149
     &+0.1528537258666667D0*t1500*t153-0.1776668757333333D0*t1503*t157
     &+0.5595521024D-1*t1506*t552-0.5304183466666667D-2*t1511*t1286)
     &+t586*t690+t240*(-0.2682296D-1*t479*t247+0.71500176D-3*t1497
     &*t252-0.2124915552D-4*t1066*t1497+0.126906576D-2*t459*t479
     &+0.23202059904D-6*t1071*t1497-0.1363476096D-4*t462*t479
     &-0.124593251328D-8*t1076*t1497+0.728718336D-7*t465*t479
     &+0.27860288256D-11*t1083*t1497-0.18573525504D-9*t470*t479)
      t1565 = sigmaaa*t28
      t1568 = t16*t37
      t1571 = t26*t613
      t1575 = t34/t720
      v2sigmaaa2(i) = -0.9305257363491D0*t5*(0.202984192D-3*t20*t23
     &-0.5567657728D-5*t1565*t31+0.5367215616D-7*t1568*t40
     &-0.23062540288D-9*t1571*t298+0.3681132544D-12*t1575*t725)
     &-0.3109D-1*t50*t62*(0.1707616D-2*t20*t69-0.382605152D-1*t1565
     &*t73+0.528277536D-1*t1568*t77-0.1899413504D-1*t1571*t344
     &+0.19890688D-2*t1575*t1031)+t240*(-0.26812566D-3*t20*t252
     &+0.796843332D-5*t1066*t20-0.8700772464D-7*t1071*t20
     &+0.46722469248D-9*t1076*t20-0.10447608096D-11*t1083*t20)
      v2sigmaaaab(i) = 0.D0
      t1609 = t9*t89
      v2sigmaaabb(i) = t240*(-0.26812566D-3*t1479*t89+0.796843332D-5
     &*t1066*t1609-0.8700772464D-7*t1071*t1609+0.46722469248D-9*t1076
     &*t1609-0.10447608096D-11*t1083*t1609)
      v2sigmaab2(i) = 0.D0
      v2sigmaabbb(i) = 0.D0
      t1621 = sigmabb*t108
      t1624 = t96*t117
      t1627 = t106*t659
      t1631 = t114/t1118
      v2sigmabb2(i) = -0.9305257363491D0*t85*(0.202984192D-3*t100*t103
     &-0.5567657728D-5*t1621*t111+0.5367215616D-7*t1624*t120
     &-0.23062540288D-9*t1627*t506+0.3681132544D-12*t1631*t1123)
     &-0.3109D-1*t130*t142*(0.1707616D-2*t100*t149-0.382605152D-1
     &*t1621*t153+0.528277536D-1*t1624*t157-0.1899413504D-1*t1627*t552
     &+0.19890688D-2*t1631*t1286)+t240*(-0.26812566D-3*t100*t252
     &+0.796843332D-5*t1066*t100-0.8700772464D-7*t1071*t100
     &+0.46722469248D-9*t1076*t100-0.10447608096D-11*t1083*t100)
      endif ! rhoa,rhob
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vrhob(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      v2rhob2(i) = 0.0d0
      v2rhoab(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      vsigmaab(i) = 0.0d0
      vsigmabb(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2rhoasigmaab(i) = 0.0d0
      v2rhoasigmabb(i) = 0.0d0
      v2rhobsigmaaa(i) = 0.0d0
      v2rhobsigmaab(i) = 0.0d0
      v2rhobsigmabb(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      v2sigmaab2(i) = 0.0d0
      v2sigmabb2(i) = 0.0d0
      v2sigmaaaab(i) = 0.0d0
      v2sigmaaabb(i) = 0.0d0
      v2sigmaabbb(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end
      
      
      subroutine rks_xc_hcth
     & (ideriv,npt,rhoa1,sigmaaa1,
     &  zk,vrhoa,vsigmaaa,
     &  v2rhoa2,v2rhoasigmaaa,v2sigmaaa2)
c
c     F.A. Hamprecht, A.J. Cohen, D.J. Tozer, and N.C. Handy
c     Development and assessment of new exchange-correlation functionals
c     J. Chem. Phys. 109 (1998) 6264-6271
c
c
c     CITATION:
c
c     Functionals were obtained from the Density Functional Repository 
c     as developed and distributed by the Quantum Chemistry Group, 
c     CCLRC Daresbury Laboratory, Daresbury, Cheshire, WA4 4AD 
c     United Kingdom. Contact Huub van Dam (h.j.j.vandam@dl.ac.uk) or 
c     Paul Sherwood for further information.
c
c     COPYRIGHT:
c
c     Users may incorporate the source code into software packages and
c     redistribute the source code provided the source code is not
c     changed in anyway and is properly cited in any documentation or
c     publication related to its use.
c
c     ACKNOWLEDGEMENT:
c
c     The source code was generated using Maple 8 through a modified
c     version of the dfauto script published in:
c
c        R. Strange, F.R. Manby, P.J. Knowles
c        Automatic code generation in density functional theory
c        Comp. Phys. Comm. 136 (2001) 310-318.
c
      implicit real*8 (a-h,o-z)
      integer ideriv,npt
      real*8 rhoa1(npt)
      real*8 sigmaaa1(npt)
      real*8 zk(npt),vrhoa(npt),vsigmaaa(npt)
      real*8 v2rhoa2(npt),v2rhoasigmaaa(npt),v2sigmaaa2(npt)
      parameter(tol=1.0d-20)
      
      if(ideriv.eq.0) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t4 = rho**2
      t5 = t2**2
      t8 = sigma/t5/t4
      t10 = 1.D0+0.6349604207872798D-2*t8
      t14 = sigma**2
      t15 = t4**2
      t19 = t14/t2/t15/rho
      t20 = t10**2
      t25 = t15**2
      t27 = t14*sigma/t25
      t32 = t14**2
      t36 = t32/t5/t25/t4
      t37 = t20**2
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t48 = rho*(1.D0+0.1606016560364007D0*t45)
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t60 = dlog(1.D0+0.321646831778707D2/(0.1248219874679732D2*t49
     &+0.4844076716063854D1*t45+0.2326004811900819D1*t52
     &+0.3819082618690966D0*t54))
      t62 = 1.D0+0.3174802103936399D0*t8
      t66 = t62**2
      t74 = t66**2
      t93 = dlog(1.D0+0.160818243221511D2/(0.598255043577108D1*t49
     &+0.2225569421150687D1*t45+0.8004286349993634D0*t52
     &+0.1897004325747559D0*t54))
      t100 = 1.D0+0.9524406311809197D-2*t8
      t104 = t100**2
      t112 = t104**2
      zk(i) = -0.7385587663820224D0*t2*rho*(0.10932D1
     &-0.4724461108493003D-2*t8/t10+0.225745598162284D-3*t19/t20
     &-0.173708544D-5*t27/t20/t10+0.7304292090974968D-8*t36/t37)
     &-0.3109D-1*t48*t60*(0.222601D0-0.1075057838039151D-1*t8/t62
     &-0.126163454252273D-2*t19/t66-0.25679872D-1*t27/t66/t62
     &+0.1578724952778562D-1*t36/t74)+(-0.62182D-1*rho*(1.D0
     &+0.1325688999052018D0*t45)*t93+0.3109D-1*t48*t60)*(0.729974D0
     &+0.319340961906757D-1*t8/t100-0.104711534488343D-2*t19/t104
     &+0.698599296D-5*t27/t104/t100-0.3685454240475973D-7*t36/t112)
      else ! rho
      zk(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.1) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t16 = t15*rho
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigma
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t35 = 1/t5/t25/t4
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.10932D1-0.4724461108493003D-2*t8*t11
     &+0.225745598162284D-3*t19*t21-0.173708544D-5*t27*t29
     &+0.7304292090974968D-8*t36*t38
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1606016560364007D0*t45
      t48 = rho*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1248219874679732D2*t49+0.4844076716063854D1*t45
     &+0.2326004811900819D1*t52+0.3819082618690966D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.3174802103936399D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.222601D0-0.1075057838039151D-1*t8*t63
     &-0.126163454252273D-2*t19*t67-0.25679872D-1*t27*t71
     &+0.1578724952778562D-1*t36*t75
      t79 = t60*t78
      t83 = 1.D0+0.1325688999052018D0*t45
      t89 = 0.598255043577108D1*t49+0.2225569421150687D1*t45
     &+0.8004286349993634D0*t52+0.1897004325747559D0*t54
      t92 = 1.D0+0.160818243221511D2/t89
      t93 = dlog(t92)
      t98 = -0.62182D-1*rho*t83*t93+0.3109D-1*t48*t60
      t100 = 1.D0+0.9524406311809197D-2*t8
      t101 = 1/t100
      t104 = t100**2
      t105 = 1/t104
      t109 = 1/t104/t100
      t112 = t104**2
      t113 = 1/t112
      t116 = 0.729974D0+0.319340961906757D-1*t8*t101
     &-0.104711534488343D-2*t19*t105+0.698599296D-5*t27*t109
     &-0.3685454240475973D-7*t36*t113
      zk(i) = -0.7385587663820224D0*t3*t41-0.3109D-1*t48*t79+t98*t116
      t120 = t4*rho
      t123 = sigma/t5/t120
      t126 = t15*t4
      t129 = t14/t2/t126
      t134 = t24/t25/rho
      t140 = t32/t5/t25/t120
      t147 = t32*sigma/t2/t25/t126
      t149 = 1/t37/t10
      t155 = t47*t60
      t158 = 1/t54
      t159 = t44*t158
      t162 = t56**2
      t163 = 1/t162
      t165 = t49**2
      t166 = t165**2
      t169 = 1/t4
      t170 = 1/t166/t49*t169
      t172 = t158*t169
      t175 = 1/t52*t169
      t178 = 1/t45*t169
      t180 = -0.4160732915599108D1*t170-0.3229384477375903D1*t172
     &-0.2326004811900819D1*t175-0.5092110158254621D0*t178
      t181 = 1/t59
      t195 = 1/t74/t62
      t206 = t89**2
      t238 = 1/t112/t100
      s1 = -0.9847450218426965D0*t2*t41-0.3692793831910112D0*t3*
     &(0.2519712591196268D-1*t123*t11-0.2567944823781261D-2*t129*t21
     &+0.4308291584D-4*t134*t29-0.3323017782489364D-6*t140*t38
     &+0.9894264276562486D-9*t147*t149)-0.3109D-1*t155*t78
     &+0.1664368495390566D-2*t159*t79
      vrhoa(i) = s1+0.5D0*t48*t163*t180*t181*t78-0.15545D-1*t48*t60*
     &(0.5733641802875474D-1*t123*t63-0.4745742938744286D-2*t129*t67
     &+0.4066054826666667D0*t134*t71-0.4672402752398278D0*t140*t75
     &+0.1069256384345231D0*t147*t195)+(-0.62182D-1*t83*t93+rho*
     &(0.2747799777968419D-2*t172*t93+0.1D1*t83/t206*(
     &-0.99709173929518D0*t170-0.7418564737168958D0*t172
     &-0.4002143174996817D0*t175-0.1264669550498372D0*t178)/t92)
     &+0.3109D-1*t155-0.1664368495390566D-2*t159*t60-0.5D0*t48*t163
     &*t180*t181)*t116+t98*(-0.8515758984180187D-1*t123*t101
     &+0.6395690658899341D-2*t129*t105-0.10907808768D-3*t134*t109
     &+0.9254146025239327D-6*t140*t113-0.3744188120519821D-8*t147*t238)
      t245 = sigma*t18
      t248 = t14*t26
      t251 = t24*t35
      t257 = t32/t2/t25/t16
      vsigmaaa(i) = -0.7385587663820224D0*t3*(-0.1889784443397201D-1
     &*t7*t11+0.1925958617835946D-2*t245*t21-0.3231218688D-4*t248*t29
     &+0.2492263336867023D-6*t251*t38-0.7420698207421865D-9*t257*t149)
     &-0.3109D-1*t48*t60*(-0.4300231352156605D-1*t7*t63
     &+0.3559307204058214D-2*t245*t67-0.304954112D0*t248*t71
     &+0.3504302064298708D0*t251*t75-0.8019422882589234D-1*t257*t195)
     &+2.D0*t98*(0.638681923813514D-1*t7*t101-0.4796767994174505D-2
     &*t245*t105+0.8180856576D-4*t248*t109-0.6940609518929495D-6*t251
     &*t113+0.2808141090389866D-8*t257*t238)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      endif ! rho
      enddo
      
      else if(ideriv.eq.2) then
      
      do i=1,npt
      rho = dmax1(0.D0,rhoa1(i))
      if(rho.gt.tol) then
      sigma = dmax1(0.D0,sigmaaa1(i))
      t2 = rho**(1.D0/3.D0)
      t3 = t2*rho
      t4 = rho**2
      t5 = t2**2
      t7 = 1/t5/t4
      t8 = sigma*t7
      t10 = 1.D0+0.6349604207872798D-2*t8
      t11 = 1/t10
      t14 = sigma**2
      t15 = t4**2
      t16 = t15*rho
      t18 = 1/t2/t16
      t19 = t14*t18
      t20 = t10**2
      t21 = 1/t20
      t24 = t14*sigma
      t25 = t15**2
      t26 = 1/t25
      t27 = t24*t26
      t29 = 1/t20/t10
      t32 = t14**2
      t33 = t25*t4
      t35 = 1/t5/t33
      t36 = t32*t35
      t37 = t20**2
      t38 = 1/t37
      t41 = 0.10932D1-0.4724461108493003D-2*t8*t11
     &+0.225745598162284D-3*t19*t21-0.173708544D-5*t27*t29
     &+0.7304292090974968D-8*t36*t38
      t44 = 1/rho
      t45 = t44**(1.D0/3.D0)
      t47 = 1.D0+0.1606016560364007D0*t45
      t48 = rho*t47
      t49 = t44**(1.D0/6.D0)
      t52 = dsqrt(t44)
      t54 = t45**2
      t56 = 0.1248219874679732D2*t49+0.4844076716063854D1*t45
     &+0.2326004811900819D1*t52+0.3819082618690966D0*t54
      t59 = 1.D0+0.321646831778707D2/t56
      t60 = dlog(t59)
      t62 = 1.D0+0.3174802103936399D0*t8
      t63 = 1/t62
      t66 = t62**2
      t67 = 1/t66
      t71 = 1/t66/t62
      t74 = t66**2
      t75 = 1/t74
      t78 = 0.222601D0-0.1075057838039151D-1*t8*t63
     &-0.126163454252273D-2*t19*t67-0.25679872D-1*t27*t71
     &+0.1578724952778562D-1*t36*t75
      t79 = t60*t78
      t83 = 1.D0+0.1325688999052018D0*t45
      t89 = 0.598255043577108D1*t49+0.2225569421150687D1*t45
     &+0.8004286349993634D0*t52+0.1897004325747559D0*t54
      t92 = 1.D0+0.160818243221511D2/t89
      t93 = dlog(t92)
      t98 = -0.62182D-1*rho*t83*t93+0.3109D-1*t48*t60
      t100 = 1.D0+0.9524406311809197D-2*t8
      t101 = 1/t100
      t104 = t100**2
      t105 = 1/t104
      t109 = 1/t104/t100
      t112 = t104**2
      t113 = 1/t112
      t116 = 0.729974D0+0.319340961906757D-1*t8*t101
     &-0.104711534488343D-2*t19*t105+0.698599296D-5*t27*t109
     &-0.3685454240475973D-7*t36*t113
      zk(i) = -0.7385587663820224D0*t3*t41-0.3109D-1*t48*t79+t98*t116
      t120 = t4*rho
      t122 = 1/t5/t120
      t123 = sigma*t122
      t126 = t15*t4
      t128 = 1/t2/t126
      t129 = t14*t128
      t133 = 1/t25/rho
      t134 = t24*t133
      t139 = 1/t5/t25/t120
      t140 = t32*t139
      t143 = t32*sigma
      t146 = 1/t2/t25/t126
      t147 = t143*t146
      t149 = 1/t37/t10
      t152 = 0.2519712591196268D-1*t123*t11-0.2567944823781261D-2*t129
     &*t21+0.4308291584D-4*t134*t29-0.3323017782489364D-6*t140*t38
     &+0.9894264276562486D-9*t147*t149
      t155 = t47*t60
      t158 = 1/t54
      t159 = t44*t158
      t162 = t56**2
      t163 = 1/t162
      t164 = t48*t163
      t165 = t49**2
      t166 = t165**2
      t167 = t166*t49
      t168 = 1/t167
      t169 = 1/t4
      t170 = t168*t169
      t172 = t158*t169
      t174 = 1/t52
      t175 = t174*t169
      t177 = 1/t45
      t178 = t177*t169
      t180 = -0.4160732915599108D1*t170-0.3229384477375903D1*t172
     &-0.2326004811900819D1*t175-0.5092110158254621D0*t178
      t181 = 1/t59
      t182 = t180*t181
      t183 = t182*t78
      t195 = 1/t74/t62
      t198 = 0.5733641802875474D-1*t123*t63-0.4745742938744286D-2*t129
     &*t67+0.4066054826666667D0*t134*t71-0.4672402752398278D0*t140*t75
     &+0.1069256384345231D0*t147*t195
      t199 = t60*t198
      t204 = t172*t93
      t206 = t89**2
      t207 = 1/t206
      t208 = t83*t207
      t213 = -0.99709173929518D0*t170-0.7418564737168958D0*t172
     &-0.4002143174996817D0*t175-0.1264669550498372D0*t178
      t214 = 1/t92
      t216 = t208*t213*t214
      t224 = t163*t180*t181
      t227 = -0.62182D-1*t83*t93+rho*(0.2747799777968419D-2*t204+0.1D1
     &*t216)+0.3109D-1*t155-0.1664368495390566D-2*t159*t60-0.5D0*t48
     &*t224
      t230 = 0.8515758984180187D-1*t123*t101
      t232 = 0.6395690658899341D-2*t129*t105
      t234 = 0.10907808768D-3*t134*t109
      t235 = t140*t113
      t238 = 1/t112/t100
      t240 = 0.3744188120519821D-8*t147*t238
      t241 = -t230+t232-t234+0.9254146025239327D-6*t235-t240
      vrhoa(i) = -0.9847450218426965D0*t2*t41-0.3692793831910112D0*t3
     &*t152-0.3109D-1*t155*t78+0.1664368495390566D-2*t159*t79+0.5D0
     &*t164*t183-0.15545D-1*t48*t199+t227*t116+t98*t241
      t245 = sigma*t18
      t248 = t14*t26
      t251 = t24*t35
      t256 = 1/t2/t25/t16
      t257 = t32*t256
      t260 = -0.1889784443397201D-1*t7*t11+0.1925958617835946D-2*t245
     &*t21-0.3231218688D-4*t248*t29+0.2492263336867023D-6*t251*t38
     &-0.7420698207421865D-9*t257*t149
      t273 = -0.4300231352156605D-1*t7*t63+0.3559307204058214D-2*t245
     &*t67-0.304954112D0*t248*t71+0.3504302064298708D0*t251*t75
     &-0.8019422882589234D-1*t257*t195
      t274 = t60*t273
      t287 = 0.638681923813514D-1*t7*t101-0.4796767994174505D-2*t245
     &*t105+0.8180856576D-4*t248*t109-0.6940609518929495D-6*t251*t113
     &+0.2808141090389866D-8*t257*t238
      vsigmaaa(i) = -0.7385587663820224D0*t3*t260-0.3109D-1*t48*t274
     &+2.D0*t98*t287
      t292 = sigma/t5/t15
      t295 = t15*t120
      t298 = t14/t2/t295
      t299 = t298*t105
      t302 = t24/t33
      t303 = t302*t109
      t308 = t32/t5/t25/t15
      t309 = t308*t113
      t314 = t143/t2/t25/t295
      t315 = t314*t238
      t318 = t25**2
      t321 = t32*t14/t318/t4
      t323 = 1/t112/t104
      t325 = 0.4754822529024D-9*t321*t323
      t348 = 1/t37/t20
      t356 = t47*t163
      t370 = 1/t74/t66
      t377 = t162**2
      t378 = 1/t377
      t380 = t180**2
      t381 = t59**2
      t382 = 1/t381
      t389 = 1/t15
      t390 = 1/t167/t44*t389
      t392 = 1/t120
      t393 = t168*t392
      t396 = 1/t54/t44
      t397 = t396*t389
      t399 = t158*t392
      t403 = 1/t52/t44*t389
      t405 = t174*t392
      t409 = 1/t45/t44*t389
      t411 = t177*t392
      t413 = -0.6934554859331846D1*t390+0.1664293166239643D2*t393
     &-0.4305845969834537D1*t397+0.1291753790950361D2*t399
     &-0.2326004811900819D1*t403+0.9304019247603276D1*t405
     &-0.3394740105503081D0*t409+0.2036844063301848D1*t411
      t423 = 0.1831866518645613D-2*t397*t93
      t425 = 0.5495599555936838D-2*t399*t93
      t429 = 0.8837926660346786D-1*t172*t207*t213*t214
      t433 = t213**2
      t436 = 0.2D1*t83/t206/t89*t433*t214
      t448 = 0.1D1*t208*(-0.8309097827459833D0*t390
     &+0.199418347859036D1*t393-0.4945709824779306D0*t397
     &+0.1483712947433792D1*t399-0.2001071587498409D0*t403
     &+0.8004286349993634D0*t405-0.4215565168327908D-1*t409
     &+0.2529339100996745D0*t411)*t214
      t449 = t206**2
      t452 = t92**2
      t456 = 0.160818243221511D2*t83/t449*t433/t452
      t467 = dlog(1.D0+0.2960857464321668D2/(0.8157414703487641D1*t49
     &+0.2247591863577616D1*t45+0.4300972471276643D0*t52
     &+0.1911512595127338D0*t54))
      t469 = (1.D0+0.6901399211255825D-1*t45)*t467*t169
      t473 = 0.2D1*t216
      t474 = 0.5495599555936838D-2*t204
      t477 = t392*t396
      t481 = 1/t162/t56
      s1 = t98*(0.6244889921732137D0*t292*t101-0.6611977455216065D-1
     &*t299+0.170653661184D-2*t303-0.2250092278626939D-4*t309
     &+0.1614116494367631D-6*t315-t325)+3.D0*t227*t241
     &+0.3328736990781132D-2*t159*t199-0.6564966812284644D0/t5*t41
     &-0.1969490043685393D1*t2*t152-0.3692793831910112D0*t3*(
     &-0.184778923354393D0*t292*t11+0.3338059057705277D-1*t298*t21
     &-0.9494171065457778D-3*t302*t29+0.1213065957842335D-4*t308*t38
     &-0.7337656600781108D-7*t314*t149+0.1675324322247111D-9*t321*t348
     &)-0.6218D-1*t155*t198+0.2D1*t356*t183-0.15545D-1*t48*t60*(
     &-0.4204670655442014D0*t292*t63+0.1571963602053569D0*t298*t67
     &-0.7334969935644444D1*t302*t71+0.1296770019587685D2*t308*t75
     &-0.6229778507390148D1*t314*t195+0.9052473116444444D0*t321*t370)
      s2 = s1+0.1608234158893535D2*t48*t378*t380*t382*t78+(-0.5D0*t48
     &*t163*t413*t181-0.1608234158893535D2*t48*t378*t380*t382+rho*
     &(t423-t425-t429-t436+t448+t456+0.3377399869956914D-1*t469)+t473
     &+t474-0.2D1*t356*t182-0.2219157993854088D-2*t477*t60+0.1D1*t48
     &*t481*t380*t181+0.1070677706909338D0*t159*t224)*t116+0.1D1*t164
     &*t182*t198+0.2219157993854088D-2*t477*t79
      v2rhoa2(i) = s2-0.1070677706909338D0*t159*t163*t183-0.1D1*t48
     &*t481*t380*t181*t78+0.5D0*t164*t413*t181*t78+(t474+t473+rho*
     &(t423-t425-t429-t436+t448+t456-0.3377399869956914D-1*t469))*t116
     &+t227*(-t230+t232-t234+0.9254146025239327D-6*t235-t240)+t98*(
     &-0.1921804305356549D-1*t299+0.90663063552D-3*t303
     &-0.1571454903442721D-4*t309+0.1339542698862844D-6*t315-t325)
      t525 = sigma*t128
      t528 = t14*t133
      t531 = t24*t139
      t534 = t32*t146
      t539 = t143/t318/rho
      t572 = t525*t105
      t574 = t528*t109
      t576 = t531*t113
      t578 = t534*t238
      t581 = 0.3566116896768D-9*t539*t323
      s1 = -0.9847450218426965D0*t2*t260-0.3692793831910112D0*t3*
     &(0.1007885036478507D0*t122*t11-0.2118352569711769D-1*t525*t21
     &+0.6474384561493333D-3*t528*t29-0.8599542016444107D-5*t531*t38
     &+0.5354828486437394D-7*t534*t149-0.1256493241685333D-9*t539*t348
     &)-0.3109D-1*t155*t273+0.1664368495390566D-2*t159*t274
      v2rhoasigmaaa(i) = s1+0.5D0*t164*t182*t273-0.15545D-1*t48*t60*
     &(0.2293456721150189D0*t122*t63-0.1107786557459012D0*t525*t67
     &+0.4891319227733333D1*t528*t71-0.9024914734047895D1*t531*t75
     &+0.4511945422890826D1*t534*t195-0.6789354837333333D0*t539*t370)
     &+2.D0*t227*t287+t98*(-0.3406303593672075D0*t122*t101
     &+0.3999629492577148D-1*t572-0.111628532736D-2*t574
     &+0.1548757018591614D-4*t576-0.1154424548967926D-6*t578+t581)+t98
     &*(0.1441353229017411D-1*t572-0.67997297664D-3*t574
     &+0.1178591177582041D-4*t576-0.1004657024147133D-6*t578+t581)
      t592 = sigma*t26
      t595 = t14*t35
      t598 = t24*t256
      t602 = t32/t318
      v2sigmaaa2(i) = -0.7385587663820224D0*t3*(0.818380980149448D-2
     &*t18*t21-0.356330094592D-3*t592*t29+0.5452751177586271D-5*t595
     &*t38-0.3719293436531171D-7*t598*t149+0.942369931264D-10*t602
     &*t348)-0.3109D-1*t48*t60*(0.6884676299319308D-1*t18*t67
     &-0.24486729728D1*t592*t71+0.5366965224816438D1*t595*t75
     &-0.306318215186455D1*t598*t195+0.5092016128D0*t602*t370)+4.D0
     &*t98*(-0.1081014921763059D-1*t18*t105+0.50997973248D-3*t592*t109
     &-0.8839433831865308D-5*t595*t113+0.7534927681103499D-7*t598*t238
     &-0.2674587672576D-9*t602*t323)
      else ! rho
      zk(i) = 0.0d0
      vrhoa(i) = 0.0d0
      v2rhoa2(i) = 0.0d0
      vsigmaaa(i) = 0.0d0
      v2rhoasigmaaa(i) = 0.0d0
      v2sigmaaa2(i) = 0.0d0
      endif ! rho
      enddo
      
      endif ! ideriv
      return
      end

c:XC_HCTHsubrend
